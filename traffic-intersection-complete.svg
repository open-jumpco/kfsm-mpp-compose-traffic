<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1753px" preserveAspectRatio="none" style="width:1199px;height:1753px;background:#FFFFFF;" version="1.1" viewBox="0 0 1199 1753" width="1199px" zoomAndPan="magnify"><defs><filter height="300%" id="fchuy1plwdxfm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="9.5" y="1613.5"/><ellipse cx="24.5" cy="1633.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M23,1634.5938 L23,1636.5938 L27,1636.5938 L27,1635.5938 L27,1635.1094 L27.625,1634.5938 L28,1634.5938 L28.375,1634.5938 L29,1635.1094 L29,1635.5938 L29,1638.5938 L21,1638.5938 L20.5156,1638.5938 L20,1637.9688 L20,1637.5938 L20,1637.2188 L20.5156,1636.5938 L21,1636.5938 L21,1636.5938 L21,1630.5938 L21,1630.5938 L20.5156,1630.5938 L20,1629.9688 L20,1629.5938 L20,1629.2188 L20.5156,1628.5938 L21,1628.5938 L29,1628.5938 L29,1631.5938 L29,1632.0781 L28.375,1632.5938 L28,1632.5938 L27.625,1632.5938 L27,1632.0781 L27,1631.5938 L27,1630.5938 L23,1630.5938 L23,1632.5938 L24,1632.5938 L24,1632.1094 L24,1632.1094 L24.625,1631.5938 L25,1631.5938 L25.375,1631.5938 L26,1632.1094 L26,1632.5938 L26,1634.5938 L26,1635.0781 L25.375,1635.5938 L25.375,1635.5938 L25,1635.5938 L24.625,1635.5938 L24,1635.0781 L24,1635.0781 L24,1634.5938 L23,1634.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="54" y="1630.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="38.5" y="1646.0508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="10.5" x2="135.5" y1="1653.6875" y2="1653.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="15.5" y="1669.1064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="15.5" y="1682.9424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="15.5" y="1696.7783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="10.5" x2="135.5" y1="1703.1953" y2="1703.1953"/><!--MD5=[082ea4b1b4c949e9e678c41ae71c099b]
class TrafficLightEvents--><rect codeLine="8" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="83.8594" id="TrafficLightEvents" style="stroke:#A80036;stroke-width:1.5;" width="129" x="171.5" y="1620.5"/><ellipse cx="186.5" cy="1640.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M185,1641.5938 L185,1643.5938 L189,1643.5938 L189,1642.5938 L189,1642.1094 L189.625,1641.5938 L190,1641.5938 L190.375,1641.5938 L191,1642.1094 L191,1642.5938 L191,1645.5938 L183,1645.5938 L182.5156,1645.5938 L182,1644.9688 L182,1644.5938 L182,1644.2188 L182.5156,1643.5938 L183,1643.5938 L183,1643.5938 L183,1637.5938 L183,1637.5938 L182.5156,1637.5938 L182,1636.9688 L182,1636.5938 L182,1636.2188 L182.5156,1635.5938 L183,1635.5938 L191,1635.5938 L191,1638.5938 L191,1639.0781 L190.375,1639.5938 L190,1639.5938 L189.625,1639.5938 L189,1639.0781 L189,1638.5938 L189,1637.5938 L185,1637.5938 L185,1639.5938 L186,1639.5938 L186,1639.1094 L186,1639.1094 L186.625,1638.5938 L187,1638.5938 L187.375,1638.5938 L188,1639.1094 L188,1639.5938 L188,1641.5938 L188,1642.0781 L187.375,1642.5938 L187.375,1642.5938 L187,1642.5938 L186.625,1642.5938 L186,1642.0781 L186,1642.0781 L186,1641.5938 L185,1641.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="215" y="1637.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="200.5" y="1653.0508">TrafficLightEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="172.5" x2="299.5" y1="1660.6875" y2="1660.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27" x="177.5" y="1676.1064">STOP</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="16" x="177.5" y="1689.9424">GO</text><line style="stroke:#A80036;stroke-width:1.5;" x1="172.5" x2="299.5" y1="1696.3594" y2="1696.3594"/><!--MD5=[a261c3b0f6dc39c3323e9647de972898]
class TrafficLightContext--><rect codeLine="12" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="153.0391" id="TrafficLightContext" style="stroke:#A80036;stroke-width:1.5;" width="270" x="336" y="1586"/><ellipse cx="415.75" cy="1606.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M416.75,1603.0938 L416.75,1609.0938 L418.75,1609.0938 L419.2344,1609.0938 L419.75,1609.7188 L419.75,1610.0938 L419.75,1610.4688 L419.2344,1611.0938 L418.75,1611.0938 L412.75,1611.0938 L412.2656,1611.0938 L411.75,1610.4688 L411.75,1610.0938 L411.75,1609.7188 L412.2656,1609.0938 L412.75,1609.0938 L414.75,1609.0938 L414.75,1603.0938 L412.75,1603.0938 L412.2656,1603.0938 L411.75,1602.4688 L411.75,1602.0938 L411.75,1601.7188 L412.2656,1601.0938 L412.75,1601.0938 L418.75,1601.0938 L419.2344,1601.0938 L419.75,1601.7188 L419.75,1602.0938 L419.75,1602.4688 L419.2344,1603.0938 L418.75,1603.0938 L416.75,1603.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="448.75" y="1603.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="102" x="436.25" y="1618.5508">TrafficLightContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="337" x2="605" y1="1626.1875" y2="1626.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="342" y="1641.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="342" y="1655.4424">amberTimeout: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="337" x2="605" y1="1661.8594" y2="1661.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="342" y="1677.2783">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="342" y="1691.1143">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="342" y="1704.9502">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="342" y="1718.7861">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="342" y="1732.6221">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[d85e1abf3caa9c226551ac440a773ac6]
class TrafficLightController--><rect codeLine="22" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="144.8516" id="TrafficLightController" style="stroke:#A80036;stroke-width:1.5;" width="218" x="320" y="1200"/><ellipse cx="367.75" cy="1216" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M368.75,1213 L368.75,1219 L370.75,1219 L371.2344,1219 L371.75,1219.625 L371.75,1220 L371.75,1220.375 L371.2344,1221 L370.75,1221 L364.75,1221 L364.2656,1221 L363.75,1220.375 L363.75,1220 L363.75,1219.625 L364.2656,1219 L364.75,1219 L366.75,1219 L366.75,1213 L364.75,1213 L364.2656,1213 L363.75,1212.375 L363.75,1212 L363.75,1211.625 L364.2656,1211 L364.75,1211 L370.75,1211 L371.2344,1211 L371.75,1211.625 L371.75,1212 L371.75,1212.375 L371.2344,1213 L370.75,1213 L368.75,1213 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="114" x="388.25" y="1220.9102">TrafficLightController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="321" x2="537" y1="1232" y2="1232"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="326" y="1247.4189">currentState: TrafficLightStates</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="326" y="1261.2549">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="326" y="1275.0908">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="326" y="1288.9268">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="326" y="1302.7627">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206" x="326" y="1316.5986">state: ReceiveChannel&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="321" x2="537" y1="1323.0156" y2="1323.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="326" y="1338.4346">changeAmberTimeout(value: Long)</text><!--MD5=[8f5d905706df63f012d7d74357fff60c]
class TrafficLightFSM--><rect codeLine="33" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="97.6953" id="TrafficLightFSM" style="stroke:#A80036;stroke-width:1.5;" width="164" x="162" y="1410"/><ellipse cx="198.6" cy="1430.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M200.6,1426.5938 Q200.8031,1426.0938 201.0375,1425.8438 Q201.2719,1425.5938 201.5375,1425.5938 Q202.0063,1425.5938 202.3031,1425.875 Q202.6,1426.1563 202.6,1426.8125 L202.6,1428.375 Q202.6,1429.0313 202.3188,1429.3125 Q202.0375,1429.5938 201.6,1429.5938 Q201.2094,1429.5938 200.9594,1429.4219 Q200.7094,1429.25 200.6,1428.7969 Q200.5531,1428.4844 200.3813,1428.3125 Q200.0688,1427.9844 199.5063,1427.7969 Q198.9438,1427.5938 198.3813,1427.5938 Q197.6781,1427.5938 197.0844,1427.875 Q196.5063,1428.1563 196.0531,1428.7813 Q195.6,1429.4063 195.6,1430.2656 L195.6,1431.1875 Q195.6,1432.2188 196.4438,1432.9063 Q197.2875,1433.5938 198.7875,1433.5938 Q199.6781,1433.5938 200.3031,1433.3906 Q200.6625,1433.2813 201.0688,1432.9219 Q201.3344,1432.7188 201.475,1432.6563 Q201.6156,1432.5938 201.7875,1432.5938 Q202.1156,1432.5938 202.35,1432.8594 Q202.6,1433.1094 202.6,1433.4688 Q202.6,1433.8125 202.2563,1434.2188 Q201.7563,1434.8125 200.9594,1435.1406 Q199.9125,1435.5938 198.6313,1435.5938 Q197.1313,1435.5938 195.9281,1435 Q194.9594,1434.5313 194.2719,1433.5156 Q193.6,1432.5 193.6,1431.2969 L193.6,1430.2031 Q193.6,1428.9531 194.1938,1427.8594 Q194.8031,1426.7656 195.85,1426.1875 Q196.9125,1425.5938 198.1,1425.5938 Q198.8188,1425.5938 199.4438,1425.8438 Q200.0688,1426.0938 200.6,1426.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="242.4" y="1427.457">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="217.4" y="1442.5508">TrafficLightFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="163" x2="325" y1="1450.1875" y2="1450.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="168" y="1465.6064">currentState: TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="163" x2="325" y1="1472.0234" y2="1472.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="168" y="1487.4424">fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="168" y="1501.2783">fun stop() «suspend»</text><!--MD5=[24d80c7a7824efcf0b8bd16fe5b50cae]
class TrafficLightService--><rect codeLine="43" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="249.8906" id="TrafficLightService" style="stroke:#A80036;stroke-width:1.5;" width="270" x="127" y="868"/><ellipse cx="188.25" cy="888.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M190.25,884.5938 Q190.4531,884.0938 190.6875,883.8438 Q190.9219,883.5938 191.1875,883.5938 Q191.6563,883.5938 191.9531,883.875 Q192.25,884.1563 192.25,884.8125 L192.25,886.375 Q192.25,887.0313 191.9688,887.3125 Q191.6875,887.5938 191.25,887.5938 Q190.8594,887.5938 190.6094,887.4219 Q190.3594,887.25 190.25,886.7969 Q190.2031,886.4844 190.0313,886.3125 Q189.7188,885.9844 189.1563,885.7969 Q188.5938,885.5938 188.0313,885.5938 Q187.3281,885.5938 186.7344,885.875 Q186.1563,886.1563 185.7031,886.7813 Q185.25,887.4063 185.25,888.2656 L185.25,889.1875 Q185.25,890.2188 186.0938,890.9063 Q186.9375,891.5938 188.4375,891.5938 Q189.3281,891.5938 189.9531,891.3906 Q190.3125,891.2813 190.7188,890.9219 Q190.9844,890.7188 191.125,890.6563 Q191.2656,890.5938 191.4375,890.5938 Q191.7656,890.5938 192,890.8594 Q192.25,891.1094 192.25,891.4688 Q192.25,891.8125 191.9063,892.2188 Q191.4063,892.8125 190.6094,893.1406 Q189.5625,893.5938 188.2813,893.5938 Q186.7813,893.5938 185.5781,893 Q184.6094,892.5313 183.9219,891.5156 Q183.25,890.5 183.25,889.2969 L183.25,888.2031 Q183.25,886.9531 183.8438,885.8594 Q184.4531,884.7656 185.5,884.1875 Q186.5625,883.5938 187.75,883.5938 Q188.4688,883.5938 189.0938,883.8438 Q189.7188,884.0938 190.25,884.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="143" x="206.75" y="885.457">«context-implementation»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="228.25" y="900.5508">TrafficLightService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="396" y1="908.1875" y2="908.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="133" y="923.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="133" y="937.4424">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="133" y="951.2783">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="133" y="965.1143">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="133" y="978.9502">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="133" y="992.7861">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206" x="133" y="1006.6221">state: ReceiveChannel&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="396" y1="1013.0391" y2="1013.0391"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="133" y="1028.458">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="136" y="1042.2939"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="133" y="1056.1299">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="133" y="1069.9658">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="133" y="1083.8018">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="133" y="1097.6377">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="133" y="1111.4736">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="64" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="111.5313" id="IntersectionStates" style="stroke:#A80036;stroke-width:1.5;" width="131" x="886.5" y="1216.5"/><ellipse cx="901.5" cy="1236.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M900,1237.5938 L900,1239.5938 L904,1239.5938 L904,1238.5938 L904,1238.1094 L904.625,1237.5938 L905,1237.5938 L905.375,1237.5938 L906,1238.1094 L906,1238.5938 L906,1241.5938 L898,1241.5938 L897.5156,1241.5938 L897,1240.9688 L897,1240.5938 L897,1240.2188 L897.5156,1239.5938 L898,1239.5938 L898,1239.5938 L898,1233.5938 L898,1233.5938 L897.5156,1233.5938 L897,1232.9688 L897,1232.5938 L897,1232.2188 L897.5156,1231.5938 L898,1231.5938 L906,1231.5938 L906,1234.5938 L906,1235.0781 L905.375,1235.5938 L905,1235.5938 L904.625,1235.5938 L904,1235.0781 L904,1234.5938 L904,1233.5938 L900,1233.5938 L900,1235.5938 L901,1235.5938 L901,1235.1094 L901,1235.1094 L901.625,1234.5938 L902,1234.5938 L902.375,1234.5938 L903,1235.1094 L903,1235.5938 L903,1237.5938 L903,1238.0781 L902.375,1238.5938 L902.375,1238.5938 L902,1238.5938 L901.625,1238.5938 L901,1238.0781 L901,1238.0781 L901,1237.5938 L900,1237.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="933" y="1233.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="915.5" y="1249.0508">IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="887.5" x2="1016.5" y1="1256.6875" y2="1256.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="892.5" y="1272.1064">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="892.5" y="1285.9424">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="33" x="892.5" y="1299.7783">GOING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="892.5" y="1313.6143">STOPPED</text><line style="stroke:#A80036;stroke-width:1.5;" x1="887.5" x2="1016.5" y1="1320.0313" y2="1320.0313"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="71" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="111.5313" id="IntersectionEvents" style="stroke:#A80036;stroke-width:1.5;" width="133" x="1052.5" y="1216.5"/><ellipse cx="1067.5" cy="1236.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1066,1237.5938 L1066,1239.5938 L1070,1239.5938 L1070,1238.5938 L1070,1238.1094 L1070.625,1237.5938 L1071,1237.5938 L1071.375,1237.5938 L1072,1238.1094 L1072,1238.5938 L1072,1241.5938 L1064,1241.5938 L1063.5156,1241.5938 L1063,1240.9688 L1063,1240.5938 L1063,1240.2188 L1063.5156,1239.5938 L1064,1239.5938 L1064,1239.5938 L1064,1233.5938 L1064,1233.5938 L1063.5156,1233.5938 L1063,1232.9688 L1063,1232.5938 L1063,1232.2188 L1063.5156,1231.5938 L1064,1231.5938 L1072,1231.5938 L1072,1234.5938 L1072,1235.0781 L1071.375,1235.5938 L1071,1235.5938 L1070.625,1235.5938 L1070,1235.0781 L1070,1234.5938 L1070,1233.5938 L1066,1233.5938 L1066,1235.5938 L1067,1235.5938 L1067,1235.1094 L1067,1235.1094 L1067.625,1234.5938 L1068,1234.5938 L1068.375,1234.5938 L1069,1235.1094 L1069,1235.5938 L1069,1237.5938 L1069,1238.0781 L1068.375,1238.5938 L1068.375,1238.5938 L1068,1238.5938 L1067.625,1238.5938 L1067,1238.0781 L1067,1238.0781 L1067,1237.5938 L1066,1237.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="1098" y="1233.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="1081.5" y="1249.0508">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1053.5" x2="1184.5" y1="1256.6875" y2="1256.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="1058.5" y="1272.1064">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49" x="1058.5" y="1285.9424">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="1058.5" y="1299.7783">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="1058.5" y="1313.6143">START</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1053.5" x2="1184.5" y1="1320.0313" y2="1320.0313"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="78" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="153.0391" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.5;" width="278" x="573" y="1196"/><ellipse cx="638.25" cy="1216.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M639.25,1213.0938 L639.25,1219.0938 L641.25,1219.0938 L641.7344,1219.0938 L642.25,1219.7188 L642.25,1220.0938 L642.25,1220.4688 L641.7344,1221.0938 L641.25,1221.0938 L635.25,1221.0938 L634.7656,1221.0938 L634.25,1220.4688 L634.25,1220.0938 L634.25,1219.7188 L634.7656,1219.0938 L635.25,1219.0938 L637.25,1219.0938 L637.25,1213.0938 L635.25,1213.0938 L634.7656,1213.0938 L634.25,1212.4688 L634.25,1212.0938 L634.25,1211.7188 L634.7656,1211.0938 L635.25,1211.0938 L641.25,1211.0938 L641.7344,1211.0938 L642.25,1211.7188 L642.25,1212.0938 L642.25,1212.4688 L641.7344,1213.0938 L641.25,1213.0938 L639.25,1213.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="689.75" y="1213.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="139" x="658.75" y="1228.5508">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="574" x2="850" y1="1236.1875" y2="1236.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="579" y="1251.6064">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="579" y="1265.4424">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="574" x2="850" y1="1271.8594" y2="1271.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="266" x="579" y="1287.2783">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="579" y="1301.1143">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="579" y="1314.9502">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="579" y="1328.7861">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="579" y="1342.6221">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="88" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="139.2031" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.5;" width="214" x="816" y="923.5"/><ellipse cx="858.45" cy="943.5938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M860.45,940.0938 Q860.6531,939.5938 860.8875,939.3438 Q861.1219,939.0938 861.3875,939.0938 Q861.8563,939.0938 862.1531,939.375 Q862.45,939.6563 862.45,940.3125 L862.45,941.875 Q862.45,942.5313 862.1688,942.8125 Q861.8875,943.0938 861.45,943.0938 Q861.0594,943.0938 860.8094,942.9219 Q860.5594,942.75 860.45,942.2969 Q860.4031,941.9844 860.2313,941.8125 Q859.9188,941.4844 859.3563,941.2969 Q858.7938,941.0938 858.2313,941.0938 Q857.5281,941.0938 856.9344,941.375 Q856.3563,941.6563 855.9031,942.2813 Q855.45,942.9063 855.45,943.7656 L855.45,944.6875 Q855.45,945.7188 856.2938,946.4063 Q857.1375,947.0938 858.6375,947.0938 Q859.5281,947.0938 860.1531,946.8906 Q860.5125,946.7813 860.9188,946.4219 Q861.1844,946.2188 861.325,946.1563 Q861.4656,946.0938 861.6375,946.0938 Q861.9656,946.0938 862.2,946.3594 Q862.45,946.6094 862.45,946.9688 Q862.45,947.3125 862.1063,947.7188 Q861.6063,948.3125 860.8094,948.6406 Q859.7625,949.0938 858.4813,949.0938 Q856.9813,949.0938 855.7781,948.5 Q854.8094,948.0313 854.1219,947.0156 Q853.45,946 853.45,944.7969 L853.45,943.7031 Q853.45,942.4531 854.0438,941.3594 Q854.6531,940.2656 855.7,939.6875 Q856.7625,939.0938 857.95,939.0938 Q858.6688,939.0938 859.2938,939.3438 Q859.9188,939.5938 860.45,940.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="922.05" y="940.957">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="878.55" y="956.0508">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="817" x2="1029" y1="963.6875" y2="963.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="822" y="979.1064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="817" x2="1029" y1="985.5234" y2="985.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="822" y="1000.9424">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="822" y="1014.7783">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="822" y="1028.6143">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="822" y="1042.4502">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="822" y="1056.2861">stopped() «suspend»</text><!--MD5=[67a963a920e61d5a3e163bee231ae3ae]
class TrafficIntersectionController--><rect codeLine="101" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="297.0469" id="TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.5;" width="318" x="315" y="493"/><ellipse cx="394.25" cy="509" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M395.25,506 L395.25,512 L397.25,512 L397.7344,512 L398.25,512.625 L398.25,513 L398.25,513.375 L397.7344,514 L397.25,514 L391.25,514 L390.7656,514 L390.25,513.375 L390.25,513 L390.25,512.625 L390.7656,512 L391.25,512 L393.25,512 L393.25,506 L391.25,506 L390.7656,506 L390.25,505.375 L390.25,505 L390.25,504.625 L390.7656,504 L391.25,504 L397.25,504 L397.7344,504 L398.25,504.625 L398.25,505 L398.25,505.375 L397.7344,506 L397.25,506 L395.25,506 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="151" x="414.75" y="513.9102">TrafficIntersectionController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="316" x2="632" y1="525" y2="525"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="321" y="540.4189">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="207" x="321" y="554.2549">state: ReceiveChannel&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="321" y="568.0908">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="321" y="581.9268">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="321" y="595.7627">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="321" y="609.5986">listOrder: List&lt;String&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="316" x2="632" y1="616.0156" y2="616.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="321" y="631.4346">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="321" y="645.2705">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="321" y="659.1064">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="321" y="672.9424">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="321" y="686.7783">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="321" y="700.6143">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="321" y="714.4502">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="321" y="728.2861">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="321" y="742.1221">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="321" y="755.958">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="321" y="769.7939">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="321" y="783.6299">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="125" fill="#FEFECE" filter="url(#fchuy1plwdxfm)" height="407.7344" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:1.5;" width="318" x="421" y="7"/><ellipse cx="507.25" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M509.25,19.5 Q509.4531,19 509.6875,18.75 Q509.9219,18.5 510.1875,18.5 Q510.6563,18.5 510.9531,18.7813 Q511.25,19.0625 511.25,19.7188 L511.25,21.2813 Q511.25,21.9375 510.9688,22.2188 Q510.6875,22.5 510.25,22.5 Q509.8594,22.5 509.6094,22.3281 Q509.3594,22.1563 509.25,21.7031 Q509.2031,21.3906 509.0313,21.2188 Q508.7188,20.8906 508.1563,20.7031 Q507.5938,20.5 507.0313,20.5 Q506.3281,20.5 505.7344,20.7813 Q505.1563,21.0625 504.7031,21.6875 Q504.25,22.3125 504.25,23.1719 L504.25,24.0938 Q504.25,25.125 505.0938,25.8125 Q505.9375,26.5 507.4375,26.5 Q508.3281,26.5 508.9531,26.2969 Q509.3125,26.1875 509.7188,25.8281 Q509.9844,25.625 510.125,25.5625 Q510.2656,25.5 510.4375,25.5 Q510.7656,25.5 511,25.7656 Q511.25,26.0156 511.25,26.375 Q511.25,26.7188 510.9063,27.125 Q510.4063,27.7188 509.6094,28.0469 Q508.5625,28.5 507.2813,28.5 Q505.7813,28.5 504.5781,27.9063 Q503.6094,27.4375 502.9219,26.4219 Q502.25,25.4063 502.25,24.2031 L502.25,23.1094 Q502.25,21.8594 502.8438,20.7656 Q503.4531,19.6719 504.5,19.0938 Q505.5625,18.5 506.75,18.5 Q507.4688,18.5 508.0938,18.75 Q508.7188,19 509.25,19.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="527.75" y="27.9102">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="422" x2="738" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="427" y="54.4189">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="427" y="68.2549">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="427" y="82.0908">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="427" y="95.9268">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="427" y="109.7627">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="427" y="123.5986">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="427" y="137.4346">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="427" y="151.2705">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="427" y="165.1064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="422" x2="738" y1="171.5234" y2="171.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="427" y="186.9424">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="427" y="200.7783">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="427" y="214.6143">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="427" y="228.4502">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="427" y="242.2861">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="427" y="256.1221">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="427" y="269.958">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="427" y="283.7939">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="427" y="297.6299">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="427" y="311.4658">stop()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="427" y="325.3018">off()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="427" y="339.1377">next()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="427" y="352.9736">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="427" y="366.8096">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="427" y="380.6455">switch()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="427" y="394.4814">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="427" y="408.3174">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="159" fill="#90EE90" filter="url(#fchuy1plwdxfm)" height="249.8906" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:1.5;" width="264" x="7" y="86"/><ellipse cx="56.75" cy="106.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M58.75,102.5938 Q58.9531,102.0938 59.1875,101.8438 Q59.4219,101.5938 59.6875,101.5938 Q60.1563,101.5938 60.4531,101.875 Q60.75,102.1563 60.75,102.8125 L60.75,104.375 Q60.75,105.0313 60.4688,105.3125 Q60.1875,105.5938 59.75,105.5938 Q59.3594,105.5938 59.1094,105.4219 Q58.8594,105.25 58.75,104.7969 Q58.7031,104.4844 58.5313,104.3125 Q58.2188,103.9844 57.6563,103.7969 Q57.0938,103.5938 56.5313,103.5938 Q55.8281,103.5938 55.2344,103.875 Q54.6563,104.1563 54.2031,104.7813 Q53.75,105.4063 53.75,106.2656 L53.75,107.1875 Q53.75,108.2188 54.5938,108.9063 Q55.4375,109.5938 56.9375,109.5938 Q57.8281,109.5938 58.4531,109.3906 Q58.8125,109.2813 59.2188,108.9219 Q59.4844,108.7188 59.625,108.6563 Q59.7656,108.5938 59.9375,108.5938 Q60.2656,108.5938 60.5,108.8594 Q60.75,109.1094 60.75,109.4688 Q60.75,109.8125 60.4063,110.2188 Q59.9063,110.8125 59.1094,111.1406 Q58.0625,111.5938 56.7813,111.5938 Q55.2813,111.5938 54.0781,111 Q53.1094,110.5313 52.4219,109.5156 Q51.75,108.5 51.75,107.2969 L51.75,106.2031 Q51.75,104.9531 52.3438,103.8594 Q52.9531,102.7656 54,102.1875 Q55.0625,101.5938 56.25,101.5938 Q56.9688,101.5938 57.5938,101.8438 Q58.2188,102.0938 58.75,102.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="73" x="118.75" y="103.457">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="77.25" y="118.5508">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="270" y1="126.1875" y2="126.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="13" y="141.6064">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="13" y="155.4424">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="13" y="169.2783">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="13" y="183.1143">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="211" x="13" y="196.9502">val trafficLights: List&lt;TrafficLightController&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="16" y="210.7861"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="252" x="13" y="224.6221">val intersectionState: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="13" y="238.458">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="13" y="252.2939">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="13" y="266.1299">val allowStop: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="211" x="13" y="279.9658">val trafficLights: List&lt;TrafficLightController&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="270" y1="286.3828" y2="286.3828"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="13" y="301.8018">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="13" y="315.6377">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="13" y="329.4736">switch() «suspend»</text><!--MD5=[e90295f2306cf9f2d48d2dd155fc66d8]
link TrafficLightController to TrafficLightContext--><path codeLine="31" d="M436.752,1345.117 C443.479,1407.263 453.272,1497.727 460.664,1566.019 " fill="none" id="TrafficLightController-to-TrafficLightContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="467.634,1565.358,462.827,1585.995,453.715,1566.865,467.634,1565.358" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[f5a4d25a21e2db1a9bef5b5bdfa80daf]
link TrafficLightFSM to TrafficLightStates--><path codeLine="39" d="M203.258,1508.008 C177.449,1538.421 144.061,1577.764 117.55,1609.004 " fill="none" id="TrafficLightFSM-to-TrafficLightStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="114.022,1613.161,122.8943,1608.8852,117.2564,1609.348,116.7935,1603.7101,114.022,1613.161" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="175" y="1552.4951">«uses»</text><!--MD5=[ef55fa34c35daebc710b7e66915eb99f]
link TrafficLightFSM to TrafficLightEvents--><path codeLine="40" d="M242.094,1508.008 C240.804,1540.494 239.11,1583.167 237.835,1615.271 " fill="none" id="TrafficLightFSM-to-TrafficLightEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="237.635,1620.33,241.9892,1611.4959,237.8335,1615.3339,233.9955,1611.1783,237.635,1620.33" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="242" y="1552.4951">«uses»</text><!--MD5=[7d975c74983153482517d07fdba291a6]
link TrafficLightFSM to TrafficLightContext--><path codeLine="41" d="M298.084,1508.008 C323.184,1530.289 353.684,1557.362 382.037,1582.531 " fill="none" id="TrafficLightFSM-to-TrafficLightContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="385.843,1585.909,381.7676,1576.9429,382.1037,1582.5898,376.4568,1582.9258,385.843,1585.909" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="352" y="1552.4951">context</text><!--MD5=[a14a1606ab3e0ad97f005eafd1d1dbee]
link TrafficLightService to TrafficLightController--><path codeLine="60" d="M336.708,1118.14 C349.805,1139.903 363.193,1162.15 375.565,1182.708 " fill="none" id="TrafficLightService-to-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="381.6,1179.162,385.915,1199.907,369.605,1186.38,381.6,1179.162" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b02eea57f08a8734f953d301797f548e]
link TrafficLightService to TrafficLightFSM--><path codeLine="61" d="M256.7225,1130.03 C256.7225,1130.03 248.998,1329.158 246.387,1396.463 " fill="none" id="TrafficLightService-TrafficLightFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="245.872,1409.744,250.2181,1400.9059,246.0659,1404.7478,242.2241,1400.5956,245.872,1409.744" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="246.0659" x2="246.376" y1="1404.7478" y2="1396.7535"/><polygon fill="#A80036" points="257.188,1118.039,252.9583,1123.8793,256.7225,1130.03,260.9522,1124.1897,257.188,1118.039" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="256" y="1277.9951">fsm</text><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="97" d="M870.843,1062.596 C841.17,1101.619 803.859,1150.691 772.854,1191.466 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="769.491,1195.89,778.1223,1191.1466,772.5172,1191.9098,771.754,1186.3047,769.491,1195.89" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="805" y="1162.4951">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="98" d="M971.596,1062.589 C990.468,1089.244 1012.26,1120.039 1032,1148 C1046.76,1168.902 1062.9,1191.808 1077.24,1212.157 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1080.26,1216.458,1078.3463,1206.7968,1077.3802,1212.3706,1071.8065,1211.4045,1080.26,1216.458" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="1044" y="1162.4951">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="99" d="M930.169,1062.596 C934.933,1108.186 941.13,1167.489 945.704,1211.258 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="946.226,1216.247,949.2683,1206.8798,945.706,1211.2741,941.3117,1207.7118,946.226,1216.247" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="941" y="1162.4951">states «uses»</text><!--MD5=[f99ab679abda8f782610770a06d7759b]
link TrafficIntersectionController to TrafficIntersectionContext--><path codeLine="122" d="M529.951,790.37 C575.133,909.78 637.365,1074.249 676.113,1176.656 " fill="none" id="TrafficIntersectionController-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="682.77,1174.471,683.301,1195.654,669.676,1179.425,682.77,1174.471" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[623b43cb3e72afdaaab4b9f9f3b9f428]
link TrafficIntersectionController to TrafficLightController--><path codeLine="123" d="M462.5639,802.3394 C462.5639,802.3394 442.061,1088.93 435.058,1186.818 " fill="none" id="TrafficIntersectionController-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="434.123,1199.892,438.7556,1191.2007,434.4801,1194.9048,430.7761,1190.6293,434.123,1199.892" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="434.4801" x2="435.0505" y1="1194.9048" y2="1186.925"/><polygon fill="#A80036" points="463.421,790.37,459.0027,796.069,462.5639,802.3394,466.9822,796.6404,463.421,790.37" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="459" y="998.4951">trafficLights</text><!--MD5=[213e98c6e1b68eaf0278262acaf92988]
link TrafficIntersectionService to TrafficIntersectionController--><path codeLine="154" d="M529.716,415.27 C524.915,434.68 520.084,454.21 515.381,473.22 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="522.131,475.08,510.533,492.82,508.541,471.72,522.131,475.08" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="155" d="M702.6751,425.7629 C702.6751,425.7629 709.153,438.98 712,445 C788.19,606.08 858.85,802.664 895.913,910.857 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="900.156,923.285,901.0338,913.4753,898.5406,918.5531,893.4628,916.06,900.156,923.285" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="898.5406" x2="895.956" y1="918.5531" y2="910.982"/><polygon fill="#A80036" points="697.308,415.03,696.4139,422.1855,702.6751,425.7629,703.5692,418.6074,697.308,415.03" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="852" y="646.9951">intersectionFSM «private»</text><!--MD5=[5a10fe9a7b46e29ac4c7cf70982de1b2]
link TrafficIntersectionService to TrafficLightController--><path codeLine="156" d="M639.1531,426.7902 C639.1531,426.7902 647.39,471.73 650,493 C666.073,624.02 672.328,659.9 650,790 C623.845,942.398 604.019,980.136 534,1118 C521.812,1141.997 506.429,1166.642 491.223,1188.968 " fill="none" id="TrafficIntersectionService-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="483.787,1199.729,492.1942,1194.5988,486.6295,1195.6156,485.6127,1190.0508,483.787,1199.729" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="486.6295" x2="491.177" y1="1195.6156" y2="1189.0335"/><polygon fill="#A80036" points="636.766,415.03,634.0395,421.7058,639.1531,426.7902,641.8796,420.1144,636.766,415.03" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="646" y="834.4951">trafficLights «private»</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="466.3025" y="1188.9204">1..n</text><!--MD5=[0de80cd36f9e186dba893d17ca342858]
link TrafficIntersectionService to TrafficLightService--><path codeLine="157" d="M420.837,331.53 C372.614,376.52 325.038,431.78 297,493 C243.524,609.76 240.15,758.135 246.839,862.637 " fill="none" id="TrafficIntersectionService-to-TrafficLightService" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="247.186,867.892,250.586,858.6486,246.8575,862.9028,242.6033,859.1743,247.186,867.892" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a0825e187c969bcbe7623a28eff8e879]
link TrafficIntersectionViewModel to TrafficIntersectionController--><path codeLine="177" d="M236.121,336.23 C273.331,383.82 316.204,438.66 355.216,488.56 " fill="none" id="TrafficIntersectionViewModel-to-TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="358.497,492.76,356.0969,483.2081,355.4141,488.8236,349.7986,488.1407,358.497,492.76" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="328" y="459.4951">trafficIntersection</text><!--MD5=[d808bb3d0a57656b160dc9f17213e03b]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

enum TrafficLightEvents <<fsm-event>> {
    STOP
    GO
}
interface TrafficLightContext <<fsm-context>> {
    name: String
    amberTimeout: Long
    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

interface TrafficLightController {
    currentState: TrafficLightStates
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: ReceiveChannel<Long>
    state: ReceiveChannel<TrafficLightStates>
    changeAmberTimeout(value: Long)
}
TrafficLightController -|> TrafficLightContext

class TrafficLightFSM <<fsm>> {
    currentState: TrafficLightStates
    fun start() <<suspend>>
    fun stop() <<suspend>>
}

TrafficLightFSM ..> TrafficLightStates: <<uses>>
TrafficLightFSM ..> TrafficLightEvents: <<uses>>
TrafficLightFSM - -> TrafficLightContext: context

class TrafficLightService <<context-implementation>> {
    name: String
    amberTimeout: Long
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: ReceiveChannel<Long>
    state: ReceiveChannel<TrafficLightStates>
    changeAmberTimeout(value: Long)

    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

TrafficLightService - -|> TrafficLightController
TrafficLightService *- - -> TrafficLightFSM: fsm


enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM ..> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionController {
    amberTimeout: Long
    state: ReceiveChannel<IntersectionStates>
    stopped: ReceiveChannel<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    get(name: String): TrafficLightController
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionController - -|> TrafficIntersectionContext
TrafficIntersectionController *- - -> TrafficLightController: trafficLights

class TrafficIntersectionService {
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightController
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionController
TrafficIntersectionService *- - -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService *- - -> "1..n" TrafficLightController: trafficLights <<private>>
TrafficIntersectionService ...> TrafficLightService

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String
    val trafficLights: List<TrafficLightController>

    val intersectionState: StateFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>
    val trafficLights: List<TrafficLightController>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel - -> TrafficIntersectionController: trafficIntersection

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>