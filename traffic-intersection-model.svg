<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="715.8px" preserveAspectRatio="none" style="width:751px;height:715px;background:#FFFFFF;" version="1.1" viewBox="0 0 751 715" width="751.2px" zoomAndPan="magnify"><defs><filter height="300%" id="f17ebaknjlbfkj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.4" dy="2.4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="58.6172" id="TrafficLightStates" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="76.2" x="242.7" y="4.2"/><ellipse cx="251.7" cy="16.2562" fill="#EB937F" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M250.8,16.8563 L250.8,18.0563 L253.2,18.0563 L253.2,17.4563 L253.2,17.1656 L253.575,16.8563 L253.8,16.8563 L254.025,16.8563 L254.4,17.1656 L254.4,17.4563 L254.4,19.2562 L249.6,19.2562 L249.3094,19.2562 L249,18.8812 L249,18.6563 L249,18.4313 L249.3094,18.0563 L249.6,18.0563 L249.6,18.0563 L249.6,14.4562 L249.6,14.4562 L249.3094,14.4562 L249,14.0812 L249,13.8563 L249,13.6313 L249.3094,13.2563 L249.6,13.2563 L254.4,13.2563 L254.4,15.0562 L254.4,15.3469 L254.025,15.6563 L253.8,15.6563 L253.575,15.6563 L253.2,15.3469 L253.2,15.0562 L253.2,14.4562 L250.8,14.4562 L250.8,15.6563 L251.4,15.6563 L251.4,15.3656 L251.4,15.3656 L251.775,15.0562 L252,15.0562 L252.225,15.0562 L252.6,15.3656 L252.6,15.6563 L252.6,16.8563 L252.6,17.1469 L252.225,17.4563 L252.225,17.4563 L252,17.4563 L251.775,17.4563 L251.4,17.1469 L251.4,17.1469 L251.4,16.8563 L250.8,16.8563 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="38.4" x="269.4" y="14.6742">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="7.2" lengthAdjust="spacing" textLength="57" x="260.1" y="23.7305">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="243.3" x2="318.3" y1="28.3125" y2="28.3125"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="12" x="246.3" y="37.5639">RED</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="21.6" x="246.3" y="45.8654">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="20.4" x="246.3" y="54.167">GREEN</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="243.3" x2="318.3" y1="58.0172" y2="58.0172"/><!--MD5=[d85e1abf3caa9c226551ac440a773ac6]
class TrafficLightController--><rect codeLine="8" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="86.9109" id="TrafficLightController" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="113.4" x="224.1" y="178.5"/><ellipse cx="244.71" cy="188.1" fill="#B4A7E5" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M245.31,186.3 L245.31,189.9 L246.51,189.9 L246.8006,189.9 L247.11,190.275 L247.11,190.5 L247.11,190.725 L246.8006,191.1 L246.51,191.1 L242.91,191.1 L242.6194,191.1 L242.31,190.725 L242.31,190.5 L242.31,190.275 L242.6194,189.9 L242.91,189.9 L244.11,189.9 L244.11,186.3 L242.91,186.3 L242.6194,186.3 L242.31,185.925 L242.31,185.7 L242.31,185.475 L242.6194,185.1 L242.91,185.1 L246.51,185.1 L246.8006,185.1 L247.11,185.475 L247.11,185.7 L247.11,185.925 L246.8006,186.3 L246.51,186.3 L245.31,186.3 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="68.4" x="255.69" y="191.0461">TrafficLightController</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="224.7" x2="336.9" y1="197.7" y2="197.7"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="36" x="227.7" y="206.9514">name: String</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="81.6" x="227.7" y="215.2529">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="73.2" x="227.7" y="223.5545">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="80.4" x="227.7" y="231.8561">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="84" x="227.7" y="240.1576">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="106.2" x="227.7" y="248.4592">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="224.7" x2="336.9" y1="252.3094" y2="252.3094"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="101.4" x="227.7" y="261.5607">changeAmberTimeout(value: Long)</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="20" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="66.9188" id="IntersectionStates" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="78.6" x="536.7" y="581.1"/><ellipse cx="545.7" cy="593.1563" fill="#EB937F" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M544.8,593.7563 L544.8,594.9563 L547.2,594.9563 L547.2,594.3562 L547.2,594.0656 L547.575,593.7563 L547.8,593.7563 L548.025,593.7563 L548.4,594.0656 L548.4,594.3562 L548.4,596.1563 L543.6,596.1563 L543.3094,596.1563 L543,595.7813 L543,595.5563 L543,595.3313 L543.3094,594.9563 L543.6,594.9563 L543.6,594.9563 L543.6,591.3562 L543.6,591.3562 L543.3094,591.3562 L543,590.9812 L543,590.7563 L543,590.5313 L543.3094,590.1563 L543.6,590.1563 L548.4,590.1563 L548.4,591.9563 L548.4,592.2469 L548.025,592.5563 L547.8,592.5563 L547.575,592.5563 L547.2,592.2469 L547.2,591.9563 L547.2,591.3562 L544.8,591.3562 L544.8,592.5563 L545.4,592.5563 L545.4,592.2656 L545.4,592.2656 L545.775,591.9563 L546,591.9563 L546.225,591.9563 L546.6,592.2656 L546.6,592.5563 L546.6,593.7563 L546.6,594.0469 L546.225,594.3562 L546.225,594.3562 L546,594.3562 L545.775,594.3562 L545.4,594.0469 L545.4,594.0469 L545.4,593.7563 L544.8,593.7563 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="38.4" x="564.6" y="591.5742">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="7.2" lengthAdjust="spacing" textLength="59.4" x="554.1" y="600.6305">IntersectionStates</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="537.3" x2="614.7" y1="605.2125" y2="605.2125"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="30" x="540.3" y="614.4639">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="25.8" x="540.3" y="622.7654">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="19.8" x="540.3" y="631.067">GOING</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="27.6" x="540.3" y="639.3686">STOPPED</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="537.3" x2="614.7" y1="643.2188" y2="643.2188"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="27" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="66.9188" id="IntersectionEvents" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="79.8" x="663.3" y="399.3"/><ellipse cx="672.3" cy="411.3563" fill="#EB937F" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M671.4,411.9563 L671.4,413.1563 L673.8,413.1563 L673.8,412.5563 L673.8,412.2656 L674.175,411.9563 L674.4,411.9563 L674.625,411.9563 L675,412.2656 L675,412.5563 L675,414.3563 L670.2,414.3563 L669.9094,414.3563 L669.6,413.9813 L669.6,413.7562 L669.6,413.5313 L669.9094,413.1563 L670.2,413.1563 L670.2,413.1563 L670.2,409.5563 L670.2,409.5563 L669.9094,409.5563 L669.6,409.1813 L669.6,408.9563 L669.6,408.7313 L669.9094,408.3563 L670.2,408.3563 L675,408.3563 L675,410.1563 L675,410.4469 L674.625,410.7562 L674.4,410.7562 L674.175,410.7562 L673.8,410.4469 L673.8,410.1563 L673.8,409.5563 L671.4,409.5563 L671.4,410.7562 L672,410.7562 L672,410.4656 L672,410.4656 L672.375,410.1563 L672.6,410.1563 L672.825,410.1563 L673.2,410.4656 L673.2,410.7562 L673.2,411.9563 L673.2,412.2469 L672.825,412.5563 L672.825,412.5563 L672.6,412.5563 L672.375,412.5563 L672,412.2469 L672,412.2469 L672,411.9563 L671.4,411.9563 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="40.8" x="690.6" y="409.7742">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="7.2" lengthAdjust="spacing" textLength="60.6" x="680.7" y="418.8305">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="663.9" x2="742.5" y1="423.4125" y2="423.4125"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="25.2" x="666.9" y="432.6639">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="29.4" x="666.9" y="440.9654">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="18" x="666.9" y="449.267">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="20.4" x="666.9" y="457.5686">START</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="663.9" x2="742.5" y1="461.4188" y2="461.4188"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="34" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="91.8234" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="166.8" x="348.6" y="568.8"/><ellipse cx="387.75" cy="580.8562" fill="#B4A7E5" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M388.35,579.0563 L388.35,582.6563 L389.55,582.6563 L389.8406,582.6563 L390.15,583.0313 L390.15,583.2563 L390.15,583.4812 L389.8406,583.8562 L389.55,583.8562 L385.95,583.8562 L385.6594,583.8562 L385.35,583.4812 L385.35,583.2563 L385.35,583.0313 L385.6594,582.6563 L385.95,582.6563 L387.15,582.6563 L387.15,579.0563 L385.95,579.0563 L385.6594,579.0563 L385.35,578.6813 L385.35,578.4563 L385.35,578.2312 L385.6594,577.8562 L385.95,577.8562 L389.55,577.8562 L389.8406,577.8562 L390.15,578.2312 L390.15,578.4563 L390.15,578.6813 L389.8406,579.0563 L389.55,579.0563 L388.35,579.0563 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="46.2" x="418.65" y="579.2742">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="83.4" x="400.05" y="588.3305">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="349.2" x2="514.8" y1="592.9125" y2="592.9125"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="57" x="352.2" y="602.1639">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="69.6" x="352.2" y="610.4654">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="349.2" x2="514.8" y1="614.3156" y2="614.3156"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="159.6" x="352.2" y="623.567">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="90.6" x="352.2" y="631.8686">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="90" x="352.2" y="640.1701">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="90" x="352.2" y="648.4717">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="85.8" x="352.2" y="656.7732">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="44" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="83.5219" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="128.4" x="463.2" y="391.2"/><ellipse cx="488.67" cy="403.2562" fill="#ADD1B2" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M489.87,401.1563 Q489.9919,400.8563 490.1325,400.7063 Q490.2731,400.5563 490.4325,400.5563 Q490.7138,400.5563 490.8919,400.725 Q491.07,400.8938 491.07,401.2875 L491.07,402.225 Q491.07,402.6188 490.9013,402.7875 Q490.7325,402.9563 490.47,402.9563 Q490.2356,402.9563 490.0856,402.8531 Q489.9356,402.75 489.87,402.4781 Q489.8419,402.2906 489.7388,402.1875 Q489.5513,401.9906 489.2138,401.8781 Q488.8763,401.7562 488.5388,401.7562 Q488.1169,401.7562 487.7606,401.925 Q487.4138,402.0938 487.1419,402.4688 Q486.87,402.8438 486.87,403.3594 L486.87,403.9125 Q486.87,404.5313 487.3763,404.9437 Q487.8825,405.3563 488.7825,405.3563 Q489.3169,405.3563 489.6919,405.2344 Q489.9075,405.1688 490.1513,404.9531 Q490.3106,404.8313 490.395,404.7938 Q490.4794,404.7562 490.5825,404.7562 Q490.7794,404.7562 490.92,404.9156 Q491.07,405.0656 491.07,405.2813 Q491.07,405.4875 490.8638,405.7313 Q490.5638,406.0875 490.0856,406.2844 Q489.4575,406.5563 488.6888,406.5563 Q487.7888,406.5563 487.0669,406.2 Q486.4856,405.9188 486.0731,405.3094 Q485.67,404.7 485.67,403.9781 L485.67,403.3219 Q485.67,402.5719 486.0263,401.9156 Q486.3919,401.2594 487.02,400.9125 Q487.6575,400.5563 488.37,400.5563 Q488.8013,400.5563 489.1763,400.7063 Q489.5513,400.8563 489.87,401.1563 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="20.4" x="526.83" y="401.6742">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="7.2" lengthAdjust="spacing" textLength="72.6" x="500.73" y="410.7305">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="463.8" x2="591" y1="415.3125" y2="415.3125"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="91.8" x="466.8" y="424.5639">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="463.8" x2="591" y1="428.4141" y2="428.4141"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="121.2" x="466.8" y="437.6654">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="85.8" x="466.8" y="445.967">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="85.2" x="466.8" y="454.2686">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="92.4" x="466.8" y="462.5701">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="62.4" x="466.8" y="470.8717">stopped() «suspend»</text><!--MD5=[67a963a920e61d5a3e163bee231ae3ae]
class TrafficIntersectionController--><rect codeLine="57" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="186.5297" id="TrafficIntersectionController" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="190.8" x="136.8" y="521.4"/><ellipse cx="184.35" cy="531" fill="#B4A7E5" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M184.95,529.2 L184.95,532.8 L186.15,532.8 L186.4406,532.8 L186.75,533.175 L186.75,533.4 L186.75,533.625 L186.4406,534 L186.15,534 L182.55,534 L182.2594,534 L181.95,533.625 L181.95,533.4 L181.95,533.175 L182.2594,532.8 L182.55,532.8 L183.75,532.8 L183.75,529.2 L182.55,529.2 L182.2594,529.2 L181.95,528.825 L181.95,528.6 L181.95,528.375 L182.2594,528 L182.55,528 L186.15,528 L186.4406,528 L186.75,528.375 L186.75,528.6 L186.75,528.825 L186.4406,529.2 L186.15,529.2 L184.95,529.2 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="90.6" x="196.65" y="533.9461">TrafficIntersectionController</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="137.4" x2="327" y1="540.6" y2="540.6"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="58.2" x="140.4" y="549.8514">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="106.8" x="140.4" y="558.1529">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="84" x="140.4" y="566.4545">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="57.6" x="140.4" y="574.7561">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="79.8" x="140.4" y="583.0576">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="62.4" x="140.4" y="591.3592">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="116.4" x="140.4" y="599.6607">trafficLights: List&lt;TrafficLightController&gt;</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="137.4" x2="327" y1="603.5109" y2="603.5109"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="114" x="140.4" y="612.7623">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="89.4" x="140.4" y="621.0639">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="102" x="140.4" y="629.3654">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="101.4" x="140.4" y="637.667">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="183.6" x="140.4" y="645.9686">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="121.2" x="140.4" y="654.2701">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="54.6" x="140.4" y="662.5717">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="28.2" x="140.4" y="670.8732">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="87" x="140.4" y="679.1748">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="39.6" x="140.4" y="687.4764">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="39" x="140.4" y="695.7779">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="24.6" x="140.4" y="704.0795">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="81" fill="#FEFECE" filter="url(#f17ebaknjlbfkj)" height="244.6406" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="190.8" x="432" y="99.6"/><ellipse cx="483.75" cy="109.2" fill="#ADD1B2" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M484.95,107.1 Q485.0719,106.8 485.2125,106.65 Q485.3531,106.5 485.5125,106.5 Q485.7938,106.5 485.9719,106.6688 Q486.15,106.8375 486.15,107.2313 L486.15,108.1688 Q486.15,108.5625 485.9813,108.7313 Q485.8125,108.9 485.55,108.9 Q485.3156,108.9 485.1656,108.7969 Q485.0156,108.6938 484.95,108.4219 Q484.9219,108.2344 484.8187,108.1313 Q484.6312,107.9344 484.2938,107.8219 Q483.9562,107.7 483.6188,107.7 Q483.1969,107.7 482.8406,107.8687 Q482.4938,108.0375 482.2219,108.4125 Q481.95,108.7875 481.95,109.3031 L481.95,109.8563 Q481.95,110.475 482.4562,110.8875 Q482.9625,111.3 483.8625,111.3 Q484.3969,111.3 484.7719,111.1781 Q484.9875,111.1125 485.2313,110.8969 Q485.3906,110.775 485.475,110.7375 Q485.5594,110.7 485.6625,110.7 Q485.8594,110.7 486,110.8594 Q486.15,111.0094 486.15,111.225 Q486.15,111.4312 485.9437,111.675 Q485.6437,112.0313 485.1656,112.2281 Q484.5375,112.5 483.7687,112.5 Q482.8688,112.5 482.1469,112.1438 Q481.5656,111.8625 481.1531,111.2531 Q480.75,110.6438 480.75,109.9219 L480.75,109.2656 Q480.75,108.5156 481.1063,107.8594 Q481.4719,107.2031 482.1,106.8563 Q482.7375,106.5 483.45,106.5 Q483.8812,106.5 484.2562,106.65 Q484.6312,106.8 484.95,107.1 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" lengthAdjust="spacing" textLength="82.2" x="496.05" y="112.1461">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="432.6" x2="622.2" y1="118.8" y2="118.8"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="106.8" x="435.6" y="128.0514">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="84" x="435.6" y="136.3529">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="58.2" x="435.6" y="144.6545">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="62.4" x="435.6" y="152.9561">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="46.8" x="435.6" y="161.2576">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="57.6" x="435.6" y="169.5592">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="79.8" x="435.6" y="177.8607">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="59.4" x="435.6" y="186.1623">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="91.8" x="435.6" y="194.4639">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="432.6" x2="622.2" y1="198.3141" y2="198.3141"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="101.4" x="435.6" y="207.5654">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="54.6" x="435.6" y="215.867">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="114" x="435.6" y="224.1686">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="183.6" x="435.6" y="232.4701">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="87" x="435.6" y="240.7717">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="121.2" x="435.6" y="249.0732">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="89.4" x="435.6" y="257.3748">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="102" x="435.6" y="265.6764">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="18" x="435.6" y="273.9779">start()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="17.4" x="435.6" y="282.2795">stop()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="13.2" x="435.6" y="290.5811">off()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="17.4" x="435.6" y="298.8826">next()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="39.6" x="435.6" y="307.1842">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="39" x="435.6" y="315.4857">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="24.6" x="435.6" y="323.7873">switch()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="28.2" x="435.6" y="332.0889">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="121.2" x="435.6" y="340.3904">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="114" fill="#90EE90" filter="url(#f17ebaknjlbfkj)" height="133.3312" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:0.8999999999999999;" width="158.4" x="4.2" y="155.4"/><ellipse cx="34.05" cy="167.4562" fill="#ADD1B2" rx="6.6" ry="6.6" style="stroke:#A80036;stroke-width:0.6;"/><path d="M35.25,165.3563 Q35.3719,165.0563 35.5125,164.9063 Q35.6531,164.7563 35.8125,164.7563 Q36.0938,164.7563 36.2719,164.925 Q36.45,165.0938 36.45,165.4875 L36.45,166.425 Q36.45,166.8188 36.2813,166.9875 Q36.1125,167.1563 35.85,167.1563 Q35.6156,167.1563 35.4656,167.0531 Q35.3156,166.95 35.25,166.6781 Q35.2219,166.4906 35.1188,166.3875 Q34.9313,166.1906 34.5938,166.0781 Q34.2563,165.9562 33.9187,165.9562 Q33.4969,165.9562 33.1406,166.125 Q32.7937,166.2938 32.5219,166.6688 Q32.25,167.0438 32.25,167.5594 L32.25,168.1125 Q32.25,168.7313 32.7563,169.1437 Q33.2625,169.5563 34.1625,169.5563 Q34.6969,169.5563 35.0719,169.4344 Q35.2875,169.3688 35.5313,169.1531 Q35.6906,169.0313 35.775,168.9938 Q35.8594,168.9562 35.9625,168.9562 Q36.1594,168.9562 36.3,169.1156 Q36.45,169.2656 36.45,169.4813 Q36.45,169.6875 36.2438,169.9313 Q35.9438,170.2875 35.4656,170.4844 Q34.8375,170.7563 34.0688,170.7563 Q33.1687,170.7563 32.4469,170.4 Q31.8656,170.1188 31.4531,169.5094 Q31.05,168.9 31.05,168.1781 L31.05,167.5219 Q31.05,166.7719 31.4063,166.1156 Q31.7719,165.4594 32.4,165.1125 Q33.0375,164.7563 33.75,164.7563 Q34.1813,164.7563 34.5563,164.9063 Q34.9313,165.0563 35.25,165.3563 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="7.2" font-style="italic" lengthAdjust="spacing" textLength="43.8" x="71.25" y="165.8742">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="7.2" lengthAdjust="spacing" textLength="93.6" x="46.35" y="174.9305">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="4.8" x2="162" y1="179.5125" y2="179.5125"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="68.4" x="7.8" y="188.7639">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="69.6" x="7.8" y="197.0654">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="57" x="7.8" y="205.367">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="67.8" x="7.8" y="213.6686">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="0" x="9.6" y="221.9701"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="151.2" x="7.8" y="230.2717">val intersectionState: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="103.2" x="7.8" y="238.5732">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="109.8" x="7.8" y="246.8748">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="102.6" x="7.8" y="255.1764">val allowStop: StateFlow&lt;Boolean&gt;</text><line style="stroke:#A80036;stroke-width:0.8999999999999999;" x1="4.8" x2="162" y1="259.0266" y2="259.0266"/><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="73.8" x="7.8" y="268.2779">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="73.2" x="7.8" y="276.5795">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="6.6" lengthAdjust="spacing" textLength="58.8" x="7.8" y="284.8811">switch() «suspend»</text><!--MD5=[ba8e8ecedbdac8325cc7c1db76e1195f]
reverse link TrafficLightStates to TrafficLightController--><path codeLine="18" d="M280.8,66.168 C280.8,97.11 280.8,144.2268 280.8,178.4346 " fill="none" id="TrafficLightStates-backto-TrafficLightController" style="stroke:#A80036;stroke-width:0.6;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="280.8,63.042,278.4,68.442,280.8,66.042,283.2,68.442,280.8,63.042" style="stroke:#A80036;stroke-width:0.6;"/><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="53" d="M505.6326,474.7068 C491.2752,501.8868 472.4142,537.5922 457.3758,566.061 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="#A80036" points="455.9328,568.7928,460.5772,565.1391,457.3341,566.1402,456.333,562.8971,455.9328,568.7928" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="25.8" x="495" y="501.2971">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="54" d="M591.6138,432.9 C614.424,432.9 639.534,432.9 660.15,432.9 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:0.6;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="663.156,432.9,657.756,430.5,660.156,432.9,657.756,435.3,663.156,432.9" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="49.8" x="602.55" y="428.9971">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="55" d="M538.4892,474.7068 C546.858,505.8078 558.2316,548.0712 566.2536,577.8828 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:0.6;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="567.0684,580.9092,567.9836,575.0712,566.2893,578.0121,563.3483,576.3178,567.0684,580.9092" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="49.2" x="546.6" y="501.2971">states «uses»</text><!--MD5=[f99ab679abda8f782610770a06d7759b]
link TrafficIntersectionController to TrafficIntersectionContext--><path codeLine="79" d="M327.6126,614.7 C330.537,614.7 333.4614,614.7 336.3858,614.7 " fill="none" id="TrafficIntersectionController-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="none" points="336.4086,610.5,348.408,614.7,336.408,618.9,336.4086,610.5" style="stroke:#A80036;stroke-width:0.6;"/><!--MD5=[213e98c6e1b68eaf0278262acaf92988]
link TrafficIntersectionService to TrafficIntersectionController--><path codeLine="110" d="M435.4134,344.595 C394.9542,398.2524 347.9652,460.5702 309.369,511.7568 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionController" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="none" points="312.7176,514.2924,302.1396,521.3448,306.0108,509.235,312.7176,514.2924" style="stroke:#A80036;stroke-width:0.6;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="111" d="M527.4,351.6318 C527.4,351.6318 527.4,373.6194 527.4,383.1726 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="#A80036" points="527.4,390.9816,529.8,385.5816,527.4,387.9816,525,385.5816,527.4,390.9816" style="stroke:#A80036;stroke-width:0.6;"/><line style="stroke:#A80036;stroke-width:0.6;" x1="527.4" x2="527.4" y1="387.9816" y2="383.1816"/><polygon fill="#A80036" points="527.4,344.4318,525,348.0318,527.4,351.6318,529.8,348.0318,527.4,344.4318" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="90" x="528" y="371.0971">intersectionFSM «private»</text><!--MD5=[d24d6fffdedd5cdee822b0d6405ac7c3]
reverse link TrafficLightController to TrafficIntersectionService--><path codeLine="112" d="M340.6674,222 C368.0298,222 401.1198,222 431.7978,222 " fill="none" id="TrafficLightController-backto-TrafficIntersectionService" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="#A80036" points="337.53,222,342.93,224.4,340.53,222,342.93,219.6,337.53,222" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="72.6" x="348.45" y="218.0971">trafficLights «private»</text><!--MD5=[c54291f5f133e8dfbf9f069e7dae8179]
link TrafficIntersectionViewModel to TrafficLightController--><path codeLine="130" d="M170.037,222 C170.037,222 201.5868,222 216.0534,222 " fill="none" id="TrafficIntersectionViewModel-TrafficLightController" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="#A80036" points="223.9668,222,218.5668,219.6,220.9668,222,218.5668,224.4,223.9668,222" style="stroke:#A80036;stroke-width:0.6;"/><line style="stroke:#A80036;stroke-width:0.6;" x1="220.9668" x2="216.1668" y1="222" y2="222"/><polygon fill="#A80036" points="162.837,222,166.437,224.4,170.037,222,166.437,219.6,162.837,222" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="39.6" x="173.55" y="218.0971">trafficLights</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="13.2" x="206.1084" y="230.4606">1..n</text><!--MD5=[a0825e187c969bcbe7623a28eff8e879]
link TrafficIntersectionViewModel to TrafficIntersectionController--><path codeLine="131" d="M111.1161,295.5217 C111.1161,295.5217 168.3336,446.0646 194.1552,514.0014 " fill="none" id="TrafficIntersectionViewModel-TrafficIntersectionController" style="stroke:#A80036;stroke-width:0.6;"/><polygon fill="#A80036" points="196.9458,521.3448,197.2707,515.4444,195.8799,518.5405,192.7838,517.1498,196.9458,521.3448" style="stroke:#A80036;stroke-width:0.6;"/><line style="stroke:#A80036;stroke-width:0.6;" x1="195.8799" x2="194.1744" y1="518.5405" y2="514.0533"/><polygon fill="#A80036" points="108.558,288.7914,107.5936,293.0092,111.1161,295.5217,112.0805,291.3038,108.558,288.7914" style="stroke:#A80036;stroke-width:0.6;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacing" textLength="58.8" x="178.2" y="436.1971">trafficIntersection</text><!--MD5=[3122476c7a8ef3d213abb0e4644f73b1]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

interface TrafficLightController {
    name: String
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)
}

TrafficLightController .up.> TrafficLightStates

enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM .right.> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionController {
    amberTimeout: Long
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    trafficLights: List<TrafficLightController>
    get(name: String): TrafficLightController
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionController -right-|> TrafficIntersectionContext

class TrafficIntersectionService {
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightController
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionController
TrafficIntersectionService *- -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService -left-> TrafficLightController: trafficLights <<private>>

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String

    val intersectionState: StateFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel *-right-> "1..n" TrafficLightController: trafficLights
TrafficIntersectionViewModel *- - -> TrafficIntersectionController: trafficIntersection

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>