<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1159px" preserveAspectRatio="none" style="width:1636px;height:1159px;background:#FFFFFF;" version="1.1" viewBox="0 0 1636 1159" width="1636px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fmpzyjd3jmwq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="1331.5" y="941.5"/><ellipse cx="1346.5" cy="961.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1345,962.5938 L1345,964.5938 L1349,964.5938 L1349,963.5938 L1349,963.1094 L1349.625,962.5938 L1350,962.5938 L1350.375,962.5938 L1351,963.1094 L1351,963.5938 L1351,966.5938 L1343,966.5938 L1342.5156,966.5938 L1342,965.9688 L1342,965.5938 L1342,965.2188 L1342.5156,964.5938 L1343,964.5938 L1343,964.5938 L1343,958.5938 L1343,958.5938 L1342.5156,958.5938 L1342,957.9688 L1342,957.5938 L1342,957.2188 L1342.5156,956.5938 L1343,956.5938 L1351,956.5938 L1351,959.5938 L1351,960.0781 L1350.375,960.5938 L1350,960.5938 L1349.625,960.5938 L1349,960.0781 L1349,959.5938 L1349,958.5938 L1345,958.5938 L1345,960.5938 L1346,960.5938 L1346,960.1094 L1346,960.1094 L1346.625,959.5938 L1347,959.5938 L1347.375,959.5938 L1348,960.1094 L1348,960.5938 L1348,962.5938 L1348,963.0781 L1347.375,963.5938 L1347.375,963.5938 L1347,963.5938 L1346.625,963.5938 L1346,963.0781 L1346,963.0781 L1346,962.5938 L1345,962.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="1376" y="958.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="1360.5" y="974.0508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1332.5" x2="1457.5" y1="981.6875" y2="981.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="1337.5" y="997.1064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="1337.5" y="1010.9424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="1337.5" y="1024.7783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1332.5" x2="1457.5" y1="1031.1953" y2="1031.1953"/><!--MD5=[082ea4b1b4c949e9e678c41ae71c099b]
class TrafficLightEvents--><rect codeLine="8" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="83.8594" id="TrafficLightEvents" style="stroke:#A80036;stroke-width:1.5;" width="129" x="1493.5" y="948.5"/><ellipse cx="1508.5" cy="968.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1507,969.5938 L1507,971.5938 L1511,971.5938 L1511,970.5938 L1511,970.1094 L1511.625,969.5938 L1512,969.5938 L1512.375,969.5938 L1513,970.1094 L1513,970.5938 L1513,973.5938 L1505,973.5938 L1504.5156,973.5938 L1504,972.9688 L1504,972.5938 L1504,972.2188 L1504.5156,971.5938 L1505,971.5938 L1505,971.5938 L1505,965.5938 L1505,965.5938 L1504.5156,965.5938 L1504,964.9688 L1504,964.5938 L1504,964.2188 L1504.5156,963.5938 L1505,963.5938 L1513,963.5938 L1513,966.5938 L1513,967.0781 L1512.375,967.5938 L1512,967.5938 L1511.625,967.5938 L1511,967.0781 L1511,966.5938 L1511,965.5938 L1507,965.5938 L1507,967.5938 L1508,967.5938 L1508,967.1094 L1508,967.1094 L1508.625,966.5938 L1509,966.5938 L1509.375,966.5938 L1510,967.1094 L1510,967.5938 L1510,969.5938 L1510,970.0781 L1509.375,970.5938 L1509.375,970.5938 L1509,970.5938 L1508.625,970.5938 L1508,970.0781 L1508,970.0781 L1508,969.5938 L1507,969.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="1537" y="965.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="1522.5" y="981.0508">TrafficLightEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1494.5" x2="1621.5" y1="988.6875" y2="988.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27" x="1499.5" y="1004.1064">STOP</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="16" x="1499.5" y="1017.9424">GO</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1494.5" x2="1621.5" y1="1024.3594" y2="1024.3594"/><!--MD5=[a261c3b0f6dc39c3323e9647de972898]
class TrafficLightContext--><rect codeLine="12" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="153.0391" id="TrafficLightContext" style="stroke:#A80036;stroke-width:1.5;" width="270" x="1026" y="914"/><ellipse cx="1105.75" cy="934.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1106.75,931.0938 L1106.75,937.0938 L1108.75,937.0938 L1109.2344,937.0938 L1109.75,937.7188 L1109.75,938.0938 L1109.75,938.4688 L1109.2344,939.0938 L1108.75,939.0938 L1102.75,939.0938 L1102.2656,939.0938 L1101.75,938.4688 L1101.75,938.0938 L1101.75,937.7188 L1102.2656,937.0938 L1102.75,937.0938 L1104.75,937.0938 L1104.75,931.0938 L1102.75,931.0938 L1102.2656,931.0938 L1101.75,930.4688 L1101.75,930.0938 L1101.75,929.7188 L1102.2656,929.0938 L1102.75,929.0938 L1108.75,929.0938 L1109.2344,929.0938 L1109.75,929.7188 L1109.75,930.0938 L1109.75,930.4688 L1109.2344,931.0938 L1108.75,931.0938 L1106.75,931.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="1138.75" y="931.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="102" x="1126.25" y="946.5508">TrafficLightContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1027" x2="1295" y1="954.1875" y2="954.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="1032" y="969.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="1032" y="983.4424">amberTimeout: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1027" x2="1295" y1="989.8594" y2="989.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="1032" y="1005.2783">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="1032" y="1019.1143">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="1032" y="1032.9502">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="1032" y="1046.7861">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="1032" y="1060.6221">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[a5d8c30d72bb593ebcb9c3f9d7775a5d]
class TrafficLightEventHandler--><rect codeLine="22" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="131.0156" id="TrafficLightEventHandler" style="stroke:#A80036;stroke-width:1.5;" width="189" x="1066.5" y="566.5"/><ellipse cx="1091.4" cy="582.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1092.4,579.5 L1092.4,585.5 L1094.4,585.5 L1094.8844,585.5 L1095.4,586.125 L1095.4,586.5 L1095.4,586.875 L1094.8844,587.5 L1094.4,587.5 L1088.4,587.5 L1087.9156,587.5 L1087.4,586.875 L1087.4,586.5 L1087.4,586.125 L1087.9156,585.5 L1088.4,585.5 L1090.4,585.5 L1090.4,579.5 L1088.4,579.5 L1087.9156,579.5 L1087.4,578.875 L1087.4,578.5 L1087.4,578.125 L1087.9156,577.5 L1088.4,577.5 L1094.4,577.5 L1094.8844,577.5 L1095.4,578.125 L1095.4,578.5 L1095.4,578.875 L1094.8844,579.5 L1094.4,579.5 L1092.4,579.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="135" x="1107.6" y="587.4102">TrafficLightEventHandler</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1067.5" x2="1254.5" y1="598.5" y2="598.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="1072.5" y="613.9189">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="1072.5" y="627.7549">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="1072.5" y="641.5908">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="1072.5" y="655.4268">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="1072.5" y="669.2627">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1067.5" x2="1254.5" y1="675.6797" y2="675.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="1072.5" y="691.0986">changeAmberTimeout(value: Long)</text><!--MD5=[8f5d905706df63f012d7d74357fff60c]
class TrafficLightFSM--><rect codeLine="32" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="83.8594" id="TrafficLightFSM" style="stroke:#A80036;stroke-width:1.5;" width="118" x="1313" y="590"/><ellipse cx="1328.9" cy="610.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1330.9,606.5938 Q1331.1031,606.0938 1331.3375,605.8438 Q1331.5719,605.5938 1331.8375,605.5938 Q1332.3063,605.5938 1332.6031,605.875 Q1332.9,606.1563 1332.9,606.8125 L1332.9,608.375 Q1332.9,609.0313 1332.6188,609.3125 Q1332.3375,609.5938 1331.9,609.5938 Q1331.5094,609.5938 1331.2594,609.4219 Q1331.0094,609.25 1330.9,608.7969 Q1330.8531,608.4844 1330.6813,608.3125 Q1330.3688,607.9844 1329.8063,607.7969 Q1329.2438,607.5938 1328.6813,607.5938 Q1327.9781,607.5938 1327.3844,607.875 Q1326.8063,608.1563 1326.3531,608.7813 Q1325.9,609.4063 1325.9,610.2656 L1325.9,611.1875 Q1325.9,612.2188 1326.7438,612.9063 Q1327.5875,613.5938 1329.0875,613.5938 Q1329.9781,613.5938 1330.6031,613.3906 Q1330.9625,613.2813 1331.3688,612.9219 Q1331.6344,612.7188 1331.775,612.6563 Q1331.9156,612.5938 1332.0875,612.5938 Q1332.4156,612.5938 1332.65,612.8594 Q1332.9,613.1094 1332.9,613.4688 Q1332.9,613.8125 1332.5563,614.2188 Q1332.0563,614.8125 1331.2594,615.1406 Q1330.2125,615.5938 1328.9313,615.5938 Q1327.4313,615.5938 1326.2281,615 Q1325.2594,614.5313 1324.5719,613.5156 Q1323.9,612.5 1323.9,611.2969 L1323.9,610.2031 Q1323.9,608.9531 1324.4938,607.8594 Q1325.1031,606.7656 1326.15,606.1875 Q1327.2125,605.5938 1328.4,605.5938 Q1329.1188,605.5938 1329.7438,605.8438 Q1330.3688,606.0938 1330.9,606.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="1368.1" y="607.457">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="1343.1" y="622.5508">TrafficLightFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1314" x2="1430" y1="630.1875" y2="630.1875"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1314" x2="1430" y1="638.1875" y2="638.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="1319" y="653.6064">fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="1319" y="667.4424">fun stop() «suspend»</text><!--MD5=[24d80c7a7824efcf0b8bd16fe5b50cae]
class TrafficLightService--><rect codeLine="41" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="166.875" id="TrafficLightService" style="stroke:#A80036;stroke-width:1.5;" width="397" x="1067.5" y="134.5"/><ellipse cx="1192.25" cy="154.5938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1194.25,151.0938 Q1194.4531,150.5938 1194.6875,150.3438 Q1194.9219,150.0938 1195.1875,150.0938 Q1195.6563,150.0938 1195.9531,150.375 Q1196.25,150.6563 1196.25,151.3125 L1196.25,152.875 Q1196.25,153.5313 1195.9688,153.8125 Q1195.6875,154.0938 1195.25,154.0938 Q1194.8594,154.0938 1194.6094,153.9219 Q1194.3594,153.75 1194.25,153.2969 Q1194.2031,152.9844 1194.0313,152.8125 Q1193.7188,152.4844 1193.1563,152.2969 Q1192.5938,152.0938 1192.0313,152.0938 Q1191.3281,152.0938 1190.7344,152.375 Q1190.1563,152.6563 1189.7031,153.2813 Q1189.25,153.9063 1189.25,154.7656 L1189.25,155.6875 Q1189.25,156.7188 1190.0938,157.4063 Q1190.9375,158.0938 1192.4375,158.0938 Q1193.3281,158.0938 1193.9531,157.8906 Q1194.3125,157.7813 1194.7188,157.4219 Q1194.9844,157.2188 1195.125,157.1563 Q1195.2656,157.0938 1195.4375,157.0938 Q1195.7656,157.0938 1196,157.3594 Q1196.25,157.6094 1196.25,157.9688 Q1196.25,158.3125 1195.9063,158.7188 Q1195.4063,159.3125 1194.6094,159.6406 Q1193.5625,160.0938 1192.2813,160.0938 Q1190.7813,160.0938 1189.5781,159.5 Q1188.6094,159.0313 1187.9219,158.0156 Q1187.25,157 1187.25,155.7969 L1187.25,154.7031 Q1187.25,153.4531 1187.8438,152.3594 Q1188.4531,151.2656 1189.5,150.6875 Q1190.5625,150.0938 1191.75,150.0938 Q1192.4688,150.0938 1193.0938,150.3438 Q1193.7188,150.5938 1194.25,151.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="143" x="1210.75" y="151.957">«context-implementation»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="1232.25" y="167.0508">TrafficLightService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1068.5" x2="1463.5" y1="174.6875" y2="174.6875"/><line style="stroke:#A80036;stroke-width:1.5;" x1="1068.5" x2="1463.5" y1="182.6875" y2="182.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="1073.5" y="198.1064">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="224" x="1073.5" y="211.9424">setNotifyStopped(receiver: suspend () -&gt; Unit)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="385" x="1073.5" y="225.7783">setNotifyStateChange(receiver: suspend (newState: TrafficLightStates) -&gt; Unit)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="1073.5" y="239.6143">stopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="1073.5" y="253.4502">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="1073.5" y="267.2861">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="1073.5" y="281.1221">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="1073.5" y="294.958">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="56" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="111.5313" id="IntersectionStates" style="stroke:#A80036;stroke-width:1.5;" width="131" x="691.5" y="934.5"/><ellipse cx="706.5" cy="954.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M705,955.5938 L705,957.5938 L709,957.5938 L709,956.5938 L709,956.1094 L709.625,955.5938 L710,955.5938 L710.375,955.5938 L711,956.1094 L711,956.5938 L711,959.5938 L703,959.5938 L702.5156,959.5938 L702,958.9688 L702,958.5938 L702,958.2188 L702.5156,957.5938 L703,957.5938 L703,957.5938 L703,951.5938 L703,951.5938 L702.5156,951.5938 L702,950.9688 L702,950.5938 L702,950.2188 L702.5156,949.5938 L703,949.5938 L711,949.5938 L711,952.5938 L711,953.0781 L710.375,953.5938 L710,953.5938 L709.625,953.5938 L709,953.0781 L709,952.5938 L709,951.5938 L705,951.5938 L705,953.5938 L706,953.5938 L706,953.1094 L706,953.1094 L706.625,952.5938 L707,952.5938 L707.375,952.5938 L708,953.1094 L708,953.5938 L708,955.5938 L708,956.0781 L707.375,956.5938 L707.375,956.5938 L707,956.5938 L706.625,956.5938 L706,956.0781 L706,956.0781 L706,955.5938 L705,955.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="738" y="951.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="720.5" y="967.0508">IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="692.5" x2="821.5" y1="974.6875" y2="974.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="697.5" y="990.1064">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="697.5" y="1003.9424">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="33" x="697.5" y="1017.7783">GOING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="697.5" y="1031.6143">STOPPED</text><line style="stroke:#A80036;stroke-width:1.5;" x1="692.5" x2="821.5" y1="1038.0313" y2="1038.0313"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="63" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="111.5313" id="IntersectionEvents" style="stroke:#A80036;stroke-width:1.5;" width="133" x="857.5" y="934.5"/><ellipse cx="872.5" cy="954.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M871,955.5938 L871,957.5938 L875,957.5938 L875,956.5938 L875,956.1094 L875.625,955.5938 L876,955.5938 L876.375,955.5938 L877,956.1094 L877,956.5938 L877,959.5938 L869,959.5938 L868.5156,959.5938 L868,958.9688 L868,958.5938 L868,958.2188 L868.5156,957.5938 L869,957.5938 L869,957.5938 L869,951.5938 L869,951.5938 L868.5156,951.5938 L868,950.9688 L868,950.5938 L868,950.2188 L868.5156,949.5938 L869,949.5938 L877,949.5938 L877,952.5938 L877,953.0781 L876.375,953.5938 L876,953.5938 L875.625,953.5938 L875,953.0781 L875,952.5938 L875,951.5938 L871,951.5938 L871,953.5938 L872,953.5938 L872,953.1094 L872,953.1094 L872.625,952.5938 L873,952.5938 L873.375,952.5938 L874,953.1094 L874,953.5938 L874,955.5938 L874,956.0781 L873.375,956.5938 L873.375,956.5938 L873,956.5938 L872.625,956.5938 L872,956.0781 L872,956.0781 L872,955.5938 L871,955.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="903" y="951.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="886.5" y="967.0508">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="858.5" x2="989.5" y1="974.6875" y2="974.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="863.5" y="990.1064">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49" x="863.5" y="1003.9424">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="863.5" y="1017.7783">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="863.5" y="1031.6143">START</text><line style="stroke:#A80036;stroke-width:1.5;" x1="858.5" x2="989.5" y1="1038.0313" y2="1038.0313"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="70" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="153.0391" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.5;" width="278" x="378" y="914"/><ellipse cx="443.25" cy="934.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M444.25,931.0938 L444.25,937.0938 L446.25,937.0938 L446.7344,937.0938 L447.25,937.7188 L447.25,938.0938 L447.25,938.4688 L446.7344,939.0938 L446.25,939.0938 L440.25,939.0938 L439.7656,939.0938 L439.25,938.4688 L439.25,938.0938 L439.25,937.7188 L439.7656,937.0938 L440.25,937.0938 L442.25,937.0938 L442.25,931.0938 L440.25,931.0938 L439.7656,931.0938 L439.25,930.4688 L439.25,930.0938 L439.25,929.7188 L439.7656,929.0938 L440.25,929.0938 L446.25,929.0938 L446.7344,929.0938 L447.25,929.7188 L447.25,930.0938 L447.25,930.4688 L446.7344,931.0938 L446.25,931.0938 L444.25,931.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="494.75" y="931.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="139" x="463.75" y="946.5508">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="379" x2="655" y1="954.1875" y2="954.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="384" y="969.6064">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="384" y="983.4424">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="379" x2="655" y1="989.8594" y2="989.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="266" x="384" y="1005.2783">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="384" y="1019.1143">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="384" y="1032.9502">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="384" y="1046.7861">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="384" y="1060.6221">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="80" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="139.2031" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.5;" width="214" x="650" y="562.5"/><ellipse cx="692.45" cy="582.5938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M694.45,579.0938 Q694.6531,578.5938 694.8875,578.3438 Q695.1219,578.0938 695.3875,578.0938 Q695.8563,578.0938 696.1531,578.375 Q696.45,578.6563 696.45,579.3125 L696.45,580.875 Q696.45,581.5313 696.1688,581.8125 Q695.8875,582.0938 695.45,582.0938 Q695.0594,582.0938 694.8094,581.9219 Q694.5594,581.75 694.45,581.2969 Q694.4031,580.9844 694.2313,580.8125 Q693.9188,580.4844 693.3563,580.2969 Q692.7938,580.0938 692.2313,580.0938 Q691.5281,580.0938 690.9344,580.375 Q690.3563,580.6563 689.9031,581.2813 Q689.45,581.9063 689.45,582.7656 L689.45,583.6875 Q689.45,584.7188 690.2938,585.4063 Q691.1375,586.0938 692.6375,586.0938 Q693.5281,586.0938 694.1531,585.8906 Q694.5125,585.7813 694.9188,585.4219 Q695.1844,585.2188 695.325,585.1563 Q695.4656,585.0938 695.6375,585.0938 Q695.9656,585.0938 696.2,585.3594 Q696.45,585.6094 696.45,585.9688 Q696.45,586.3125 696.1063,586.7188 Q695.6063,587.3125 694.8094,587.6406 Q693.7625,588.0938 692.4813,588.0938 Q690.9813,588.0938 689.7781,587.5 Q688.8094,587.0313 688.1219,586.0156 Q687.45,585 687.45,583.7969 L687.45,582.7031 Q687.45,581.4531 688.0438,580.3594 Q688.6531,579.2656 689.7,578.6875 Q690.7625,578.0938 691.95,578.0938 Q692.6688,578.0938 693.2938,578.3438 Q693.9188,578.5938 694.45,579.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="756.05" y="579.957">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="712.55" y="595.0508">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="651" x2="863" y1="602.6875" y2="602.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="656" y="618.1064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="651" x2="863" y1="624.5234" y2="624.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="656" y="639.9424">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="656" y="653.7783">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="656" y="667.6143">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="656" y="681.4502">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="656" y="695.2861">stopped() «suspend»</text><!--MD5=[7edde04eb472bac7a7abbff093a59d44]
class TrafficIntersectionEventHandler--><rect codeLine="93" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="310.8828" id="TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:1.5;" width="336" x="7" y="835"/><ellipse cx="84.75" cy="851" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M85.75,848 L85.75,854 L87.75,854 L88.2344,854 L88.75,854.625 L88.75,855 L88.75,855.375 L88.2344,856 L87.75,856 L81.75,856 L81.2656,856 L80.75,855.375 L80.75,855 L80.75,854.625 L81.2656,854 L81.75,854 L83.75,854 L83.75,848 L81.75,848 L81.2656,848 L80.75,847.375 L80.75,847 L80.75,846.625 L81.2656,846 L81.75,846 L87.75,846 L88.2344,846 L88.75,846.625 L88.75,847 L88.75,847.375 L88.2344,848 L87.75,848 L85.75,848 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="172" x="105.25" y="855.9102">TrafficIntersectionEventHandler</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="342" y1="867" y2="867"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="13" y="882.4189">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="13" y="896.2549">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="13" y="910.0908">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="13" y="923.9268">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="13" y="937.7627">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="13" y="951.5986">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="212" x="13" y="965.4346">trafficLights: List&lt;TrafficLightEventHandler&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="342" y1="971.8516" y2="971.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="13" y="987.2705">get(name: String): TrafficLightEventHandler</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="13" y="1001.1064">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="13" y="1014.9424">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="13" y="1028.7783">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="324" x="13" y="1042.6143">addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="13" y="1056.4502">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="13" y="1070.2861">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="13" y="1084.1221">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="13" y="1097.958">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="13" y="1111.7939">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="13" y="1125.6299">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="13" y="1139.4658">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="117" fill="#FEFECE" filter="url(#f1fmpzyjd3jmwq)" height="421.5703" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:1.5;" width="336" x="589" y="7"/><ellipse cx="684.25" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M686.25,19.5 Q686.4531,19 686.6875,18.75 Q686.9219,18.5 687.1875,18.5 Q687.6563,18.5 687.9531,18.7813 Q688.25,19.0625 688.25,19.7188 L688.25,21.2813 Q688.25,21.9375 687.9688,22.2188 Q687.6875,22.5 687.25,22.5 Q686.8594,22.5 686.6094,22.3281 Q686.3594,22.1563 686.25,21.7031 Q686.2031,21.3906 686.0313,21.2188 Q685.7188,20.8906 685.1563,20.7031 Q684.5938,20.5 684.0313,20.5 Q683.3281,20.5 682.7344,20.7813 Q682.1563,21.0625 681.7031,21.6875 Q681.25,22.3125 681.25,23.1719 L681.25,24.0938 Q681.25,25.125 682.0938,25.8125 Q682.9375,26.5 684.4375,26.5 Q685.3281,26.5 685.9531,26.2969 Q686.3125,26.1875 686.7188,25.8281 Q686.9844,25.625 687.125,25.5625 Q687.2656,25.5 687.4375,25.5 Q687.7656,25.5 688,25.7656 Q688.25,26.0156 688.25,26.375 Q688.25,26.7188 687.9063,27.125 Q687.4063,27.7188 686.6094,28.0469 Q685.5625,28.5 684.2813,28.5 Q682.7813,28.5 681.5781,27.9063 Q680.6094,27.4375 679.9219,26.4219 Q679.25,25.4063 679.25,24.2031 L679.25,23.1094 Q679.25,21.8594 679.8438,20.7656 Q680.4531,19.6719 681.5,19.0938 Q682.5625,18.5 683.75,18.5 Q684.4688,18.5 685.0938,18.75 Q685.7188,19 686.25,19.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="704.75" y="27.9102">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="590" x2="924" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="595" y="54.4189">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="595" y="68.2549">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="595" y="82.0908">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="595" y="95.9268">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="212" x="595" y="109.7627">trafficLights: List&lt;TrafficLightEventHandler&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="595" y="123.5986">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="595" y="137.4346">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="595" y="151.2705">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="595" y="165.1064">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="595" y="178.9424">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="590" x2="924" y1="185.3594" y2="185.3594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="595" y="200.7783">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="595" y="214.6143">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="595" y="228.4502">get(name: String): TrafficLightEventHandler</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="324" x="595" y="242.2861">addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="595" y="256.1221">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="595" y="269.958">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="595" y="283.7939">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="595" y="297.6299">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="595" y="311.4658">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="595" y="325.3018">stop()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="595" y="339.1377">off()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="595" y="352.9736">next()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="595" y="366.8096">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="595" y="380.6455">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="595" y="394.4814">switch()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="595" y="408.3174">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="595" y="422.1533">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="151" fill="#90EE90" filter="url(#f1fmpzyjd3jmwq)" height="249.8906" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:1.5;" width="264" x="43" y="507"/><ellipse cx="92.75" cy="527.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M94.75,523.5938 Q94.9531,523.0938 95.1875,522.8438 Q95.4219,522.5938 95.6875,522.5938 Q96.1563,522.5938 96.4531,522.875 Q96.75,523.1563 96.75,523.8125 L96.75,525.375 Q96.75,526.0313 96.4688,526.3125 Q96.1875,526.5938 95.75,526.5938 Q95.3594,526.5938 95.1094,526.4219 Q94.8594,526.25 94.75,525.7969 Q94.7031,525.4844 94.5313,525.3125 Q94.2188,524.9844 93.6563,524.7969 Q93.0938,524.5938 92.5313,524.5938 Q91.8281,524.5938 91.2344,524.875 Q90.6563,525.1563 90.2031,525.7813 Q89.75,526.4063 89.75,527.2656 L89.75,528.1875 Q89.75,529.2188 90.5938,529.9063 Q91.4375,530.5938 92.9375,530.5938 Q93.8281,530.5938 94.4531,530.3906 Q94.8125,530.2813 95.2188,529.9219 Q95.4844,529.7188 95.625,529.6563 Q95.7656,529.5938 95.9375,529.5938 Q96.2656,529.5938 96.5,529.8594 Q96.75,530.1094 96.75,530.4688 Q96.75,530.8125 96.4063,531.2188 Q95.9063,531.8125 95.1094,532.1406 Q94.0625,532.5938 92.7813,532.5938 Q91.2813,532.5938 90.0781,532 Q89.1094,531.5313 88.4219,530.5156 Q87.75,529.5 87.75,528.2969 L87.75,527.2031 Q87.75,525.9531 88.3438,524.8594 Q88.9531,523.7656 90,523.1875 Q91.0625,522.5938 92.25,522.5938 Q92.9688,522.5938 93.5938,522.8438 Q94.2188,523.0938 94.75,523.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="73" x="154.75" y="524.457">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="113.25" y="539.5508">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="44" x2="306" y1="547.1875" y2="547.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="49" y="562.6064">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="49" y="576.4424">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="49" y="590.2783">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="49" y="604.1143">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="229" x="49" y="617.9502">val trafficLights: List&lt;TrafficLightEventHandler&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="52" y="631.7861"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="252" x="49" y="645.6221">val intersectionState: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="49" y="659.458">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="49" y="673.2939">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="49" y="687.1299">val allowStop: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="229" x="49" y="700.9658">val trafficLights: List&lt;TrafficLightEventHandler&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="44" x2="306" y1="707.3828" y2="707.3828"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="49" y="722.8018">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="49" y="736.6377">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="49" y="750.4736">switch() «suspend»</text><!--MD5=[b1d46488418bc0cd55cf54b5fc017696]
class ViewModel--><rect codeLine="171" fill="#008000" filter="url(#f1fmpzyjd3jmwq)" height="56.1875" id="ViewModel" style="stroke:#A80036;stroke-width:1.5;" width="91" x="129.5" y="190"/><ellipse cx="144.5" cy="210.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M146.5,206.5938 Q146.7031,206.0938 146.9375,205.8438 Q147.1719,205.5938 147.4375,205.5938 Q147.9063,205.5938 148.2031,205.875 Q148.5,206.1563 148.5,206.8125 L148.5,208.375 Q148.5,209.0313 148.2188,209.3125 Q147.9375,209.5938 147.5,209.5938 Q147.1094,209.5938 146.8594,209.4219 Q146.6094,209.25 146.5,208.7969 Q146.4531,208.4844 146.2813,208.3125 Q145.9688,207.9844 145.4063,207.7969 Q144.8438,207.5938 144.2813,207.5938 Q143.5781,207.5938 142.9844,207.875 Q142.4063,208.1563 141.9531,208.7813 Q141.5,209.4063 141.5,210.2656 L141.5,211.1875 Q141.5,212.2188 142.3438,212.9063 Q143.1875,213.5938 144.6875,213.5938 Q145.5781,213.5938 146.2031,213.3906 Q146.5625,213.2813 146.9688,212.9219 Q147.2344,212.7188 147.375,212.6563 Q147.5156,212.5938 147.6875,212.5938 Q148.0156,212.5938 148.25,212.8594 Q148.5,213.1094 148.5,213.4688 Q148.5,213.8125 148.1563,214.2188 Q147.6563,214.8125 146.8594,215.1406 Q145.8125,215.5938 144.5313,215.5938 Q143.0313,215.5938 141.8281,215 Q140.8594,214.5313 140.1719,213.5156 Q139.5,212.5 139.5,211.2969 L139.5,210.2031 Q139.5,208.9531 140.0938,207.8594 Q140.7031,206.7656 141.75,206.1875 Q142.8125,205.5938 144,205.5938 Q144.7188,205.5938 145.3438,205.8438 Q145.9688,206.0938 146.5,206.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="56" x="160" y="207.457">«android»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="158.5" y="222.5508">ViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="130.5" x2="219.5" y1="230.1875" y2="230.1875"/><line style="stroke:#A80036;stroke-width:1.5;" x1="130.5" x2="219.5" y1="238.1875" y2="238.1875"/><!--MD5=[8d736074daedf82f88efcc1957014a1f]
link TrafficLightEventHandler to TrafficLightContext--><path codeLine="30" d="M1161,697.559 C1161,752.272 1161,831.512 1161,893.635 " fill="none" id="TrafficLightEventHandler-to-TrafficLightContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="1168,893.987,1161,913.987,1154,893.987,1168,893.987" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[f5a4d25a21e2db1a9bef5b5bdfa80daf]
link TrafficLightFSM to TrafficLightStates--><path codeLine="37" d="M1374.66,674.243 C1378.84,739.037 1386.95,864.65 1391.56,936.206 " fill="none" id="TrafficLightFSM-to-TrafficLightStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1391.89,941.263,1395.3027,932.0243,1391.5683,936.2734,1387.3193,932.539,1391.89,941.263" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="1383" y="801.4951">«uses»</text><!--MD5=[ef55fa34c35daebc710b7e66915eb99f]
link TrafficLightFSM to TrafficLightEvents--><path codeLine="38" d="M1393.52,674.243 C1428.56,741.409 1497.7,873.926 1534.18,943.84 " fill="none" id="TrafficLightFSM-to-TrafficLightEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1536.53,948.353,1535.9092,938.5237,1534.2154,943.921,1528.8181,942.2271,1536.53,948.353" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="1460" y="801.4951">«uses»</text><!--MD5=[7d975c74983153482517d07fdba291a6]
link TrafficLightFSM to TrafficLightContext--><path codeLine="39" d="M1347.59,674.243 C1313.66,731.569 1251.55,836.502 1208.36,909.485 " fill="none" id="TrafficLightFSM-to-TrafficLightContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1205.8,913.808,1213.827,908.1012,1208.3472,909.5055,1206.943,904.0257,1205.8,913.808" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="1280" y="801.4951">context</text><!--MD5=[f2d21969ec6ca24805aa2b6c8aba1483]
link TrafficLightService to TrafficLightEventHandler--><path codeLine="52" d="M1244.88,301.879 C1226.74,373.036 1200.72,475.151 1182.48,546.713 " fill="none" id="TrafficLightService-to-TrafficLightEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="1189.16,548.842,1177.44,566.494,1175.6,545.385,1189.16,548.842" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b02eea57f08a8734f953d301797f548e]
link TrafficLightService to TrafficLightFSM--><path codeLine="53" d="M1290.3104,313.5004 C1290.3104,313.5004 1341.09,510.857 1358.19,577.339 " fill="none" id="TrafficLightService-TrafficLightFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1361.44,589.971,1363.071,580.2581,1360.194,585.1287,1355.3234,582.2518,1361.44,589.971" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1360.194" x2="1358.205" y1="585.1287" y2="577.3815"/><polygon fill="#A80036" points="1287.32,301.879,1284.9414,308.6865,1290.3104,313.5004,1292.689,306.6929,1287.32,301.879" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="89" d="M710.726,701.737 C670.753,761.113 612.961,846.958 570.907,909.425 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="567.907,913.882,576.252,908.6513,570.6999,909.7348,569.6165,904.1826,567.907,913.882" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="653" y="801.4951">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="90" d="M801.693,701.651 C817.717,727.785 835.213,758.209 849,787 C871.25,833.464 891.223,888.392 904.953,929.31 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="906.596,934.229,907.5385,924.4253,905.0119,929.4866,899.9506,926.96,906.596,934.229" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="858" y="801.4951">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="91" d="M757,701.737 C757,767.665 757,866.227 757,929.184 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="757,934.408,761,925.408,757,929.408,753,925.408,757,934.408" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="758" y="801.4951">states «uses»</text><!--MD5=[bf504e590ef5f0ed45f1c6c906ad0fbf]
link TrafficIntersectionEventHandler to TrafficIntersectionContext--><path codeLine="115" d="M343.328,990.5 C348.194,990.5 353.059,990.5 357.924,990.5 " fill="none" id="TrafficIntersectionEventHandler-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="357.927,983.5,377.927,990.5,357.927,997.5,357.927,983.5" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[7b984e9d12bd2ad1569c6c891f886256]
link TrafficIntersectionService to TrafficIntersectionEventHandler--><path codeLine="147" d="M598.35,429.033 C505.849,551.494 390.677,703.969 303.822,818.955 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="309.4,823.184,291.76,834.924,298.229,814.746,309.4,823.184" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="148" d="M757,441.224 C757,441.224 757,518.064 757,549.34 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="757,562.355,761,553.355,757,557.355,753,553.355,757,562.355" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="757" x2="757" y1="557.355" y2="549.355"/><polygon fill="#A80036" points="757,429.224,753,435.224,757,441.224,761,435.224,757,429.224" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="758" y="473.4951">intersectionFSM «private»</text><!--MD5=[f96f6775ec67c35e7f6bb021a13357d7]
link TrafficIntersectionService to TrafficLightEventHandler--><path codeLine="149" d="M925.115,390.444 C984.554,451.06 1048.02,515.785 1094.14,562.811 " fill="none" id="TrafficIntersectionService-to-TrafficLightEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1097.7,566.45,1094.2575,557.2224,1094.2004,562.8789,1088.5438,562.8218,1097.7,566.45" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="1009" y="473.4951">trafficLights «private»</text><!--MD5=[642468606f4d2d9c0bbf80f925485bcd]
link TrafficIntersectionViewModel to TrafficIntersectionEventHandler--><path codeLine="169" d="M175,757.186 C175,780.543 175,805.267 175,829.535 " fill="none" id="TrafficIntersectionViewModel-to-TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="175,834.706,179,825.706,175,829.706,171,825.706,175,834.706" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="176" y="801.4951">trafficIntersection</text><!--MD5=[098a41ab95969f63653f37d909efe300]
reverse link ViewModel to TrafficIntersectionViewModel--><path codeLine="170" d="M175,266.112 C175,324.358 175,425.728 175,506.863 " fill="none" id="ViewModel-backto-TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="168,266.033,175,246.032,182,266.032,168,266.033" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[84a648d853ca3d95f70b086ee087aa0d]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

enum TrafficLightEvents <<fsm-event>> {
    STOP
    GO
}
interface TrafficLightContext <<fsm-context>> {
    name: String
    amberTimeout: Long
    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

interface TrafficLightEventHandler {
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)
}
TrafficLightEventHandler -|> TrafficLightContext

class TrafficLightFSM <<fsm>> {
    fun start() <<suspend>>
    fun stop() <<suspend>>
}

TrafficLightFSM ..> TrafficLightStates: <<uses>>
TrafficLightFSM ..> TrafficLightEvents: <<uses>>
TrafficLightFSM - -> TrafficLightContext: context

class TrafficLightService <<context-implementation>> {
    changeAmberTimeout(value: Long)
    setNotifyStopped(receiver: suspend () -> Unit)
    setNotifyStateChange(receiver: suspend (newState: TrafficLightStates) -> Unit)
    stopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

TrafficLightService - -|> TrafficLightEventHandler
TrafficLightService *- -> TrafficLightFSM


enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM ..> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionEventHandler {
    amberTimeout: Long
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    trafficLights: List<TrafficLightEventHandler>
    get(name: String): TrafficLightEventHandler
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionEventHandler -|> TrafficIntersectionContext

class TrafficIntersectionService {
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    trafficLights: List<TrafficLightEventHandler>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightEventHandler
    addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionEventHandler
TrafficIntersectionService *- -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService - -> TrafficLightEventHandler: trafficLights <<private>>

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String
    val trafficLights: List<TrafficLightEventHandler>

    val intersectionState: StateFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>
    val trafficLights: List<TrafficLightEventHandler>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel - -> TrafficIntersectionEventHandler: trafficIntersection
TrafficIntersectionViewModel -up-|> ViewModel
class ViewModel <<android>> #green {
}

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>