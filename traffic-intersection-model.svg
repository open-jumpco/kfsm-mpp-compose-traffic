<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1193px" preserveAspectRatio="none" style="width:1292px;height:1193px;background:#FFFFFF;" version="1.1" viewBox="0 0 1292 1193" width="1292px" zoomAndPan="magnify"><defs><filter height="300%" id="fame9rd678jyp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="429.5" y="7"/><ellipse cx="444.5" cy="27.0938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M443,28.0938 L443,30.0938 L447,30.0938 L447,29.0938 L447,28.6094 L447.625,28.0938 L448,28.0938 L448.375,28.0938 L449,28.6094 L449,29.0938 L449,32.0938 L441,32.0938 L440.5156,32.0938 L440,31.4688 L440,31.0938 L440,30.7188 L440.5156,30.0938 L441,30.0938 L441,30.0938 L441,24.0938 L441,24.0938 L440.5156,24.0938 L440,23.4688 L440,23.0938 L440,22.7188 L440.5156,22.0938 L441,22.0938 L449,22.0938 L449,25.0938 L449,25.5781 L448.375,26.0938 L448,26.0938 L447.625,26.0938 L447,25.5781 L447,25.0938 L447,24.0938 L443,24.0938 L443,26.0938 L444,26.0938 L444,25.6094 L444,25.6094 L444.625,25.0938 L445,25.0938 L445.375,25.0938 L446,25.6094 L446,26.0938 L446,28.0938 L446,28.5781 L445.375,29.0938 L445.375,29.0938 L445,29.0938 L444.625,29.0938 L444,28.5781 L444,28.5781 L444,28.0938 L443,28.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="474" y="24.457">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="458.5" y="39.5508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="430.5" x2="555.5" y1="47.1875" y2="47.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="435.5" y="62.6064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="435.5" y="76.4424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="435.5" y="90.2783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="430.5" x2="555.5" y1="96.6953" y2="96.6953"/><!--MD5=[d85e1abf3caa9c226551ac440a773ac6]
class TrafficLightController--><rect codeLine="8" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="158.6875" id="TrafficLightController" style="stroke:#A80036;stroke-width:1.5;" width="218" x="384" y="290.5"/><ellipse cx="431.75" cy="306.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M432.75,303.5 L432.75,309.5 L434.75,309.5 L435.2344,309.5 L435.75,310.125 L435.75,310.5 L435.75,310.875 L435.2344,311.5 L434.75,311.5 L428.75,311.5 L428.2656,311.5 L427.75,310.875 L427.75,310.5 L427.75,310.125 L428.2656,309.5 L428.75,309.5 L430.75,309.5 L430.75,303.5 L428.75,303.5 L428.2656,303.5 L427.75,302.875 L427.75,302.5 L427.75,302.125 L428.2656,301.5 L428.75,301.5 L434.75,301.5 L435.2344,301.5 L435.75,302.125 L435.75,302.5 L435.75,302.875 L435.2344,303.5 L434.75,303.5 L432.75,303.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="114" x="452.25" y="311.4102">TrafficLightController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="385" x2="601" y1="322.5" y2="322.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="390" y="337.9189">name: String «inherited»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="390" y="351.7549">currentState: TrafficLightStates</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="390" y="365.5908">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="390" y="379.4268">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="390" y="393.2627">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="390" y="407.0986">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206" x="390" y="420.9346">state: ReceiveChannel&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="385" x2="601" y1="427.3516" y2="427.3516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="390" y="442.7705">changeAmberTimeout(value: Long)</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="21" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="111.5313" id="IntersectionStates" style="stroke:#A80036;stroke-width:1.5;" width="131" x="934.5" y="968.5"/><ellipse cx="949.5" cy="988.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M948,989.5938 L948,991.5938 L952,991.5938 L952,990.5938 L952,990.1094 L952.625,989.5938 L953,989.5938 L953.375,989.5938 L954,990.1094 L954,990.5938 L954,993.5938 L946,993.5938 L945.5156,993.5938 L945,992.9688 L945,992.5938 L945,992.2188 L945.5156,991.5938 L946,991.5938 L946,991.5938 L946,985.5938 L946,985.5938 L945.5156,985.5938 L945,984.9688 L945,984.5938 L945,984.2188 L945.5156,983.5938 L946,983.5938 L954,983.5938 L954,986.5938 L954,987.0781 L953.375,987.5938 L953,987.5938 L952.625,987.5938 L952,987.0781 L952,986.5938 L952,985.5938 L948,985.5938 L948,987.5938 L949,987.5938 L949,987.1094 L949,987.1094 L949.625,986.5938 L950,986.5938 L950.375,986.5938 L951,987.1094 L951,987.5938 L951,989.5938 L951,990.0781 L950.375,990.5938 L950.375,990.5938 L950,990.5938 L949.625,990.5938 L949,990.0781 L949,990.0781 L949,989.5938 L948,989.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="981" y="985.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="963.5" y="1001.0508">IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="1064.5" y1="1008.6875" y2="1008.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="940.5" y="1024.1064">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="940.5" y="1037.9424">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="33" x="940.5" y="1051.7783">GOING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="940.5" y="1065.6143">STOPPED</text><line style="stroke:#A80036;stroke-width:1.5;" x1="935.5" x2="1064.5" y1="1072.0313" y2="1072.0313"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="28" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="111.5313" id="IntersectionEvents" style="stroke:#A80036;stroke-width:1.5;" width="133" x="1145.5" y="665.5"/><ellipse cx="1160.5" cy="685.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1159,686.5938 L1159,688.5938 L1163,688.5938 L1163,687.5938 L1163,687.1094 L1163.625,686.5938 L1164,686.5938 L1164.375,686.5938 L1165,687.1094 L1165,687.5938 L1165,690.5938 L1157,690.5938 L1156.5156,690.5938 L1156,689.9688 L1156,689.5938 L1156,689.2188 L1156.5156,688.5938 L1157,688.5938 L1157,688.5938 L1157,682.5938 L1157,682.5938 L1156.5156,682.5938 L1156,681.9688 L1156,681.5938 L1156,681.2188 L1156.5156,680.5938 L1157,680.5938 L1165,680.5938 L1165,683.5938 L1165,684.0781 L1164.375,684.5938 L1164,684.5938 L1163.625,684.5938 L1163,684.0781 L1163,683.5938 L1163,682.5938 L1159,682.5938 L1159,684.5938 L1160,684.5938 L1160,684.1094 L1160,684.1094 L1160.625,683.5938 L1161,683.5938 L1161.375,683.5938 L1162,684.1094 L1162,684.5938 L1162,686.5938 L1162,687.0781 L1161.375,687.5938 L1161.375,687.5938 L1161,687.5938 L1160.625,687.5938 L1160,687.0781 L1160,687.0781 L1160,686.5938 L1159,686.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="1191" y="682.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="1174.5" y="698.0508">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1146.5" x2="1277.5" y1="705.6875" y2="705.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="1151.5" y="721.1064">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49" x="1151.5" y="734.9424">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="1151.5" y="748.7783">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="1151.5" y="762.6143">START</text><line style="stroke:#A80036;stroke-width:1.5;" x1="1146.5" x2="1277.5" y1="769.0313" y2="769.0313"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="35" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="153.0391" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.5;" width="278" x="621" y="948"/><ellipse cx="686.25" cy="968.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M687.25,965.0938 L687.25,971.0938 L689.25,971.0938 L689.7344,971.0938 L690.25,971.7188 L690.25,972.0938 L690.25,972.4688 L689.7344,973.0938 L689.25,973.0938 L683.25,973.0938 L682.7656,973.0938 L682.25,972.4688 L682.25,972.0938 L682.25,971.7188 L682.7656,971.0938 L683.25,971.0938 L685.25,971.0938 L685.25,965.0938 L683.25,965.0938 L682.7656,965.0938 L682.25,964.4688 L682.25,964.0938 L682.25,963.7188 L682.7656,963.0938 L683.25,963.0938 L689.25,963.0938 L689.7344,963.0938 L690.25,963.7188 L690.25,964.0938 L690.25,964.4688 L689.7344,965.0938 L689.25,965.0938 L687.25,965.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="737.75" y="965.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="139" x="706.75" y="980.5508">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="622" x2="898" y1="988.1875" y2="988.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="627" y="1003.6064">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="627" y="1017.4424">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="622" x2="898" y1="1023.8594" y2="1023.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="266" x="627" y="1039.2783">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="627" y="1053.1143">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="627" y="1066.9502">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="627" y="1080.7861">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="627" y="1094.6221">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="45" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="139.2031" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.5;" width="214" x="812" y="652"/><ellipse cx="854.45" cy="672.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M856.45,668.5938 Q856.6531,668.0938 856.8875,667.8438 Q857.1219,667.5938 857.3875,667.5938 Q857.8563,667.5938 858.1531,667.875 Q858.45,668.1563 858.45,668.8125 L858.45,670.375 Q858.45,671.0313 858.1688,671.3125 Q857.8875,671.5938 857.45,671.5938 Q857.0594,671.5938 856.8094,671.4219 Q856.5594,671.25 856.45,670.7969 Q856.4031,670.4844 856.2313,670.3125 Q855.9188,669.9844 855.3563,669.7969 Q854.7938,669.5938 854.2313,669.5938 Q853.5281,669.5938 852.9344,669.875 Q852.3563,670.1563 851.9031,670.7813 Q851.45,671.4063 851.45,672.2656 L851.45,673.1875 Q851.45,674.2188 852.2938,674.9063 Q853.1375,675.5938 854.6375,675.5938 Q855.5281,675.5938 856.1531,675.3906 Q856.5125,675.2813 856.9188,674.9219 Q857.1844,674.7188 857.325,674.6563 Q857.4656,674.5938 857.6375,674.5938 Q857.9656,674.5938 858.2,674.8594 Q858.45,675.1094 858.45,675.4688 Q858.45,675.8125 858.1063,676.2188 Q857.6063,676.8125 856.8094,677.1406 Q855.7625,677.5938 854.4813,677.5938 Q852.9813,677.5938 851.7781,677 Q850.8094,676.5313 850.1219,675.5156 Q849.45,674.5 849.45,673.2969 L849.45,672.2031 Q849.45,670.9531 850.0438,669.8594 Q850.6531,668.7656 851.7,668.1875 Q852.7625,667.5938 853.95,667.5938 Q854.6688,667.5938 855.2938,667.8438 Q855.9188,668.0938 856.45,668.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="918.05" y="669.457">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="874.55" y="684.5508">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="813" x2="1025" y1="692.1875" y2="692.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="818" y="707.6064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="813" x2="1025" y1="714.0234" y2="714.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="818" y="729.4424">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="818" y="743.2783">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="818" y="757.1143">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="818" y="770.9502">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="818" y="784.7861">stopped() «suspend»</text><!--MD5=[67a963a920e61d5a3e163bee231ae3ae]
class TrafficIntersectionController--><rect codeLine="58" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="310.8828" id="TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.5;" width="318" x="268" y="869"/><ellipse cx="347.25" cy="885" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M348.25,882 L348.25,888 L350.25,888 L350.7344,888 L351.25,888.625 L351.25,889 L351.25,889.375 L350.7344,890 L350.25,890 L344.25,890 L343.7656,890 L343.25,889.375 L343.25,889 L343.25,888.625 L343.7656,888 L344.25,888 L346.25,888 L346.25,882 L344.25,882 L343.7656,882 L343.25,881.375 L343.25,881 L343.25,880.625 L343.7656,880 L344.25,880 L350.25,880 L350.7344,880 L351.25,880.625 L351.25,881 L351.25,881.375 L350.7344,882 L350.25,882 L348.25,882 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="151" x="367.75" y="889.9102">TrafficIntersectionController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="269" x2="585" y1="901" y2="901"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="274" y="916.4189">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="207" x="274" y="930.2549">state: ReceiveChannel&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="274" y="944.0908">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="274" y="957.9268">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="274" y="971.7627">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="274" y="985.5986">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="194" x="274" y="999.4346">trafficLights: List&lt;TrafficLightController&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="269" x2="585" y1="1005.8516" y2="1005.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="274" y="1021.2705">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="274" y="1035.1064">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="274" y="1048.9424">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="274" y="1062.7783">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="274" y="1076.6143">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="274" y="1090.4502">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="274" y="1104.2861">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="274" y="1118.1221">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="274" y="1131.958">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="274" y="1145.7939">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="274" y="1159.6299">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="274" y="1173.4658">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="82" fill="#FEFECE" filter="url(#fame9rd678jyp)" height="407.7344" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:1.5;" width="318" x="760" y="166"/><ellipse cx="846.25" cy="182" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M848.25,178.5 Q848.4531,178 848.6875,177.75 Q848.9219,177.5 849.1875,177.5 Q849.6563,177.5 849.9531,177.7813 Q850.25,178.0625 850.25,178.7188 L850.25,180.2813 Q850.25,180.9375 849.9688,181.2188 Q849.6875,181.5 849.25,181.5 Q848.8594,181.5 848.6094,181.3281 Q848.3594,181.1563 848.25,180.7031 Q848.2031,180.3906 848.0313,180.2188 Q847.7188,179.8906 847.1563,179.7031 Q846.5938,179.5 846.0313,179.5 Q845.3281,179.5 844.7344,179.7813 Q844.1563,180.0625 843.7031,180.6875 Q843.25,181.3125 843.25,182.1719 L843.25,183.0938 Q843.25,184.125 844.0938,184.8125 Q844.9375,185.5 846.4375,185.5 Q847.3281,185.5 847.9531,185.2969 Q848.3125,185.1875 848.7188,184.8281 Q848.9844,184.625 849.125,184.5625 Q849.2656,184.5 849.4375,184.5 Q849.7656,184.5 850,184.7656 Q850.25,185.0156 850.25,185.375 Q850.25,185.7188 849.9063,186.125 Q849.4063,186.7188 848.6094,187.0469 Q847.5625,187.5 846.2813,187.5 Q844.7813,187.5 843.5781,186.9063 Q842.6094,186.4375 841.9219,185.4219 Q841.25,184.4063 841.25,183.2031 L841.25,182.1094 Q841.25,180.8594 841.8438,179.7656 Q842.4531,178.6719 843.5,178.0938 Q844.5625,177.5 845.75,177.5 Q846.4688,177.5 847.0938,177.75 Q847.7188,178 848.25,178.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="866.75" y="186.9102">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="761" x2="1077" y1="198" y2="198"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="207" x="766" y="213.4189">state: ReceiveChannel&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="766" y="227.2549">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="766" y="241.0908">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="766" y="254.9268">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="766" y="268.7627">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="766" y="282.5986">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="766" y="296.4346">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="766" y="310.2705">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="766" y="324.1064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="761" x2="1077" y1="330.5234" y2="330.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="766" y="345.9424">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="766" y="359.7783">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="766" y="373.6143">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="766" y="387.4502">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="766" y="401.2861">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="766" y="415.1221">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="766" y="428.958">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="766" y="442.7939">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="766" y="456.6299">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="766" y="470.4658">stop()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="766" y="484.3018">off()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="766" y="498.1377">next()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="766" y="511.9736">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="766" y="525.8096">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="766" y="539.6455">switch()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="766" y="553.4814">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="766" y="567.3174">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="115" fill="#90EE90" filter="url(#fame9rd678jyp)" height="222.2188" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:1.5;" width="274" x="7" y="259"/><ellipse cx="61.75" cy="279.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M63.75,275.5938 Q63.9531,275.0938 64.1875,274.8438 Q64.4219,274.5938 64.6875,274.5938 Q65.1563,274.5938 65.4531,274.875 Q65.75,275.1563 65.75,275.8125 L65.75,277.375 Q65.75,278.0313 65.4688,278.3125 Q65.1875,278.5938 64.75,278.5938 Q64.3594,278.5938 64.1094,278.4219 Q63.8594,278.25 63.75,277.7969 Q63.7031,277.4844 63.5313,277.3125 Q63.2188,276.9844 62.6563,276.7969 Q62.0938,276.5938 61.5313,276.5938 Q60.8281,276.5938 60.2344,276.875 Q59.6563,277.1563 59.2031,277.7813 Q58.75,278.4063 58.75,279.2656 L58.75,280.1875 Q58.75,281.2188 59.5938,281.9063 Q60.4375,282.5938 61.9375,282.5938 Q62.8281,282.5938 63.4531,282.3906 Q63.8125,282.2813 64.2188,281.9219 Q64.4844,281.7188 64.625,281.6563 Q64.7656,281.5938 64.9375,281.5938 Q65.2656,281.5938 65.5,281.8594 Q65.75,282.1094 65.75,282.4688 Q65.75,282.8125 65.4063,283.2188 Q64.9063,283.8125 64.1094,284.1406 Q63.0625,284.5938 61.7813,284.5938 Q60.2813,284.5938 59.0781,284 Q58.1094,283.5313 57.4219,282.5156 Q56.75,281.5 56.75,280.2969 L56.75,279.2031 Q56.75,277.9531 57.3438,276.8594 Q57.9531,275.7656 59,275.1875 Q60.0625,274.5938 61.25,274.5938 Q61.9688,274.5938 62.5938,274.8438 Q63.2188,275.0938 63.75,275.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="73" x="123.75" y="276.457">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="82.25" y="291.5508">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="280" y1="299.1875" y2="299.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="13" y="314.6064">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="13" y="328.4424">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="13" y="342.2783">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="13" y="356.1143">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="16" y="369.9502"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="262" x="13" y="383.7861">val intersectionState: SharedFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="13" y="397.6221">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="13" y="411.458">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="13" y="425.2939">val allowStop: StateFlow&lt;Boolean&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="280" y1="431.7109" y2="431.7109"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="13" y="447.1299">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="13" y="460.9658">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="13" y="474.8018">switch() «suspend»</text><!--MD5=[ba8e8ecedbdac8325cc7c1db76e1195f]
reverse link TrafficLightStates to TrafficLightController--><path codeLine="19" d="M493,110.07 C493,159.51 493,233.856 493,290.22 " fill="none" id="TrafficLightStates-backto-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="493,105.07,489,114.07,493,110.07,497,114.07,493,105.07" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="54" d="M882.721,791.178 C858.792,836.478 827.357,895.987 802.293,943.435 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="799.888,947.988,807.6287,941.8986,802.2235,943.567,800.5551,938.1618,799.888,947.988" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="865" y="835.4951">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="55" d="M1026.02,721.5 C1064.04,721.5 1105.89,721.5 1140.25,721.5 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="1145.26,721.5,1136.26,717.5,1140.26,721.5,1136.26,725.5,1145.26,721.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="1044.25" y="714.9951">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="56" d="M937.482,791.178 C951.43,843.013 970.386,913.452 983.756,963.138 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="985.114,968.182,986.6394,958.452,983.8155,963.3536,978.9139,960.5296,985.114,968.182" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="951" y="835.4951">states «uses»</text><!--MD5=[f99ab679abda8f782610770a06d7759b]
link TrafficIntersectionController to TrafficIntersectionContext--><path codeLine="80" d="M586.021,1024.5 C590.895,1024.5 595.769,1024.5 600.643,1024.5 " fill="none" id="TrafficIntersectionController-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="600.681,1017.5,620.68,1024.5,600.68,1031.5,600.681,1017.5" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[213e98c6e1b68eaf0278262acaf92988]
link TrafficIntersectionService to TrafficIntersectionController--><path codeLine="111" d="M765.689,574.325 C698.257,663.754 619.942,767.617 555.615,852.928 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="561.196,857.154,543.566,868.908,550.018,848.725,561.196,857.154" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="112" d="M919,586.053 C919,586.053 919,622.699 919,638.621 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="919,651.636,923,642.636,919,646.636,915,642.636,919,651.636" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="919" x2="919" y1="646.636" y2="638.636"/><polygon fill="#A80036" points="919,574.053,915,580.053,919,586.053,923,580.053,919,574.053" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="920" y="618.4951">intersectionFSM «private»</text><!--MD5=[d24d6fffdedd5cdee822b0d6405ac7c3]
reverse link TrafficLightController to TrafficIntersectionService--><path codeLine="113" d="M607.243,370 C654.119,370 709.191,370 759.901,370 " fill="none" id="TrafficLightController-backto-TrafficIntersectionService" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="602.152,370,611.152,374,607.152,370,611.152,366,602.152,370" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="620.5" y="363.4951">trafficLights «private»</text><!--MD5=[c54291f5f133e8dfbf9f069e7dae8179]
link TrafficIntersectionViewModel to TrafficLightController--><path codeLine="131" d="M293.183,370 C293.183,370 346.075,370 370.709,370 " fill="none" id="TrafficIntersectionViewModel-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="383.83,370,374.83,366,378.83,370,374.83,374,383.83,370" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="378.83" x2="370.83" y1="370" y2="370"/><polygon fill="#A80036" points="281.183,370,287.183,374,293.183,370,287.183,366,281.183,370" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="299.5" y="363.4951">trafficLights</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="354.1316" y="384.0289">1..n</text><!--MD5=[a0825e187c969bcbe7623a28eff8e879]
link TrafficIntersectionViewModel to TrafficIntersectionController--><path codeLine="132" d="M196.6217,492.3282 C196.6217,492.3282 305.477,743.311 354.637,856.657 " fill="none" id="TrafficIntersectionViewModel-TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="359.951,868.908,360.0392,859.0595,357.9613,864.3209,352.6999,862.243,359.951,868.908" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="357.9613" x2="354.778" y1="864.3209" y2="856.9815"/><polygon fill="#A80036" points="191.847,481.319,190.5646,488.4152,196.6217,492.3282,197.9041,485.232,191.847,481.319" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="324" y="726.9951">trafficIntersection</text><!--MD5=[7706b25ef8dbd9c56e3cfc614ec1b387]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

interface TrafficLightController {
    name: String <<inherited>>
    currentState: TrafficLightStates
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: ReceiveChannel<Long>
    state: ReceiveChannel<TrafficLightStates>
    changeAmberTimeout(value: Long)
}

TrafficLightController .up.> TrafficLightStates

enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM .right.> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionController {
    amberTimeout: Long
    state: ReceiveChannel<IntersectionStates>
    stopped: ReceiveChannel<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    trafficLights: List<TrafficLightController>
    get(name: String): TrafficLightController
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionController -right-|> TrafficIntersectionContext

class TrafficIntersectionService {
    state: ReceiveChannel<IntersectionStates>
    stopped: ReceiveChannel<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightController
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionController
TrafficIntersectionService *- -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService -left-> TrafficLightController: trafficLights <<private>>

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String

    val intersectionState: SharedFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel *-right-> "1..n" TrafficLightController: trafficLights
TrafficIntersectionViewModel *- - -> TrafficIntersectionController: trafficIntersection

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>