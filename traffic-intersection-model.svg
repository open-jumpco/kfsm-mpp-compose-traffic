<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1049px" preserveAspectRatio="none" style="width:949px;height:1049px;background:#FFFFFF;" version="1.1" viewBox="0 0 949 1049" width="949px" zoomAndPan="magnify"><defs><filter height="300%" id="fidigchudh7mb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="758" y="909.5"/><ellipse cx="773" cy="929.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M771.5,930.5938 L771.5,932.5938 L775.5,932.5938 L775.5,931.5938 L775.5,931.1094 L776.125,930.5938 L776.5,930.5938 L776.875,930.5938 L777.5,931.1094 L777.5,931.5938 L777.5,934.5938 L769.5,934.5938 L769.0156,934.5938 L768.5,933.9688 L768.5,933.5938 L768.5,933.2188 L769.0156,932.5938 L769.5,932.5938 L769.5,932.5938 L769.5,926.5938 L769.5,926.5938 L769.0156,926.5938 L768.5,925.9688 L768.5,925.5938 L768.5,925.2188 L769.0156,924.5938 L769.5,924.5938 L777.5,924.5938 L777.5,927.5938 L777.5,928.0781 L776.875,928.5938 L776.5,928.5938 L776.125,928.5938 L775.5,928.0781 L775.5,927.5938 L775.5,926.5938 L771.5,926.5938 L771.5,928.5938 L772.5,928.5938 L772.5,928.1094 L772.5,928.1094 L773.125,927.5938 L773.5,927.5938 L773.875,927.5938 L774.5,928.1094 L774.5,928.5938 L774.5,930.5938 L774.5,931.0781 L773.875,931.5938 L773.875,931.5938 L773.5,931.5938 L773.125,931.5938 L772.5,931.0781 L772.5,931.0781 L772.5,930.5938 L771.5,930.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="802.5" y="926.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="787" y="942.0508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="759" x2="884" y1="949.6875" y2="949.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="764" y="965.1064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="764" y="978.9424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="764" y="992.7783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="759" x2="884" y1="999.1953" y2="999.1953"/><!--MD5=[d85e1abf3caa9c226551ac440a773ac6]
class TrafficLightController--><rect codeLine="8" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="144.8516" id="TrafficLightController" style="stroke:#A80036;stroke-width:1.5;" width="189" x="727" y="576"/><ellipse cx="761.35" cy="592" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M762.35,589 L762.35,595 L764.35,595 L764.8344,595 L765.35,595.625 L765.35,596 L765.35,596.375 L764.8344,597 L764.35,597 L758.35,597 L757.8656,597 L757.35,596.375 L757.35,596 L757.35,595.625 L757.8656,595 L758.35,595 L760.35,595 L760.35,589 L758.35,589 L757.8656,589 L757.35,588.375 L757.35,588 L757.35,587.625 L757.8656,587 L758.35,587 L764.35,587 L764.8344,587 L765.35,587.625 L765.35,588 L765.35,588.375 L764.8344,589 L764.35,589 L762.35,589 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="114" x="779.65" y="596.9102">TrafficLightController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="728" x2="915" y1="608" y2="608"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="733" y="623.4189">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="733" y="637.2549">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="733" y="651.0908">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="733" y="664.9268">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="733" y="678.7627">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="733" y="692.5986">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="728" x2="915" y1="699.0156" y2="699.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="733" y="714.4346">changeAmberTimeout(value: Long)</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="20" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="111.5313" id="IntersectionStates" style="stroke:#A80036;stroke-width:1.5;" width="131" x="7" y="902.5"/><ellipse cx="22" cy="922.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M20.5,923.5938 L20.5,925.5938 L24.5,925.5938 L24.5,924.5938 L24.5,924.1094 L25.125,923.5938 L25.5,923.5938 L25.875,923.5938 L26.5,924.1094 L26.5,924.5938 L26.5,927.5938 L18.5,927.5938 L18.0156,927.5938 L17.5,926.9688 L17.5,926.5938 L17.5,926.2188 L18.0156,925.5938 L18.5,925.5938 L18.5,925.5938 L18.5,919.5938 L18.5,919.5938 L18.0156,919.5938 L17.5,918.9688 L17.5,918.5938 L17.5,918.2188 L18.0156,917.5938 L18.5,917.5938 L26.5,917.5938 L26.5,920.5938 L26.5,921.0781 L25.875,921.5938 L25.5,921.5938 L25.125,921.5938 L24.5,921.0781 L24.5,920.5938 L24.5,919.5938 L20.5,919.5938 L20.5,921.5938 L21.5,921.5938 L21.5,921.1094 L21.5,921.1094 L22.125,920.5938 L22.5,920.5938 L22.875,920.5938 L23.5,921.1094 L23.5,921.5938 L23.5,923.5938 L23.5,924.0781 L22.875,924.5938 L22.875,924.5938 L22.5,924.5938 L22.125,924.5938 L21.5,924.0781 L21.5,924.0781 L21.5,923.5938 L20.5,923.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="53.5" y="919.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="36" y="935.0508">IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="137" y1="942.6875" y2="942.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="13" y="958.1064">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="13" y="971.9424">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="33" x="13" y="985.7783">GOING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="13" y="999.6143">STOPPED</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="137" y1="1006.0313" y2="1006.0313"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="27" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="111.5313" id="IntersectionEvents" style="stroke:#A80036;stroke-width:1.5;" width="133" x="173" y="902.5"/><ellipse cx="188" cy="922.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M186.5,923.5938 L186.5,925.5938 L190.5,925.5938 L190.5,924.5938 L190.5,924.1094 L191.125,923.5938 L191.5,923.5938 L191.875,923.5938 L192.5,924.1094 L192.5,924.5938 L192.5,927.5938 L184.5,927.5938 L184.0156,927.5938 L183.5,926.9688 L183.5,926.5938 L183.5,926.2188 L184.0156,925.5938 L184.5,925.5938 L184.5,925.5938 L184.5,919.5938 L184.5,919.5938 L184.0156,919.5938 L183.5,918.9688 L183.5,918.5938 L183.5,918.2188 L184.0156,917.5938 L184.5,917.5938 L192.5,917.5938 L192.5,920.5938 L192.5,921.0781 L191.875,921.5938 L191.5,921.5938 L191.125,921.5938 L190.5,921.0781 L190.5,920.5938 L190.5,919.5938 L186.5,919.5938 L186.5,921.5938 L187.5,921.5938 L187.5,921.1094 L187.5,921.1094 L188.125,920.5938 L188.5,920.5938 L188.875,920.5938 L189.5,921.1094 L189.5,921.5938 L189.5,923.5938 L189.5,924.0781 L188.875,924.5938 L188.875,924.5938 L188.5,924.5938 L188.125,924.5938 L187.5,924.0781 L187.5,924.0781 L187.5,923.5938 L186.5,923.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="218.5" y="919.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="202" y="935.0508">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="174" x2="305" y1="942.6875" y2="942.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="179" y="958.1064">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49" x="179" y="971.9424">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="179" y="985.7783">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="179" y="999.6143">START</text><line style="stroke:#A80036;stroke-width:1.5;" x1="174" x2="305" y1="1006.0313" y2="1006.0313"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="34" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="153.0391" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.5;" width="278" x="356.5" y="882"/><ellipse cx="421.75" cy="902.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M422.75,899.0938 L422.75,905.0938 L424.75,905.0938 L425.2344,905.0938 L425.75,905.7188 L425.75,906.0938 L425.75,906.4688 L425.2344,907.0938 L424.75,907.0938 L418.75,907.0938 L418.2656,907.0938 L417.75,906.4688 L417.75,906.0938 L417.75,905.7188 L418.2656,905.0938 L418.75,905.0938 L420.75,905.0938 L420.75,899.0938 L418.75,899.0938 L418.2656,899.0938 L417.75,898.4688 L417.75,898.0938 L417.75,897.7188 L418.2656,897.0938 L418.75,897.0938 L424.75,897.0938 L425.2344,897.0938 L425.75,897.7188 L425.75,898.0938 L425.75,898.4688 L425.2344,899.0938 L424.75,899.0938 L422.75,899.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="473.25" y="899.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="139" x="442.25" y="914.5508">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="357.5" x2="633.5" y1="922.1875" y2="922.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="362.5" y="937.6064">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="362.5" y="951.4424">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="357.5" x2="633.5" y1="957.8594" y2="957.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="266" x="362.5" y="973.2783">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="362.5" y="987.1143">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="362.5" y="1000.9502">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="362.5" y="1014.7861">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="362.5" y="1028.6221">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="44" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="139.2031" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.5;" width="214" x="124.5" y="579"/><ellipse cx="166.95" cy="599.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M168.95,595.5938 Q169.1531,595.0938 169.3875,594.8438 Q169.6219,594.5938 169.8875,594.5938 Q170.3563,594.5938 170.6531,594.875 Q170.95,595.1563 170.95,595.8125 L170.95,597.375 Q170.95,598.0313 170.6688,598.3125 Q170.3875,598.5938 169.95,598.5938 Q169.5594,598.5938 169.3094,598.4219 Q169.0594,598.25 168.95,597.7969 Q168.9031,597.4844 168.7313,597.3125 Q168.4188,596.9844 167.8563,596.7969 Q167.2938,596.5938 166.7313,596.5938 Q166.0281,596.5938 165.4344,596.875 Q164.8563,597.1563 164.4031,597.7813 Q163.95,598.4063 163.95,599.2656 L163.95,600.1875 Q163.95,601.2188 164.7938,601.9063 Q165.6375,602.5938 167.1375,602.5938 Q168.0281,602.5938 168.6531,602.3906 Q169.0125,602.2813 169.4188,601.9219 Q169.6844,601.7188 169.825,601.6563 Q169.9656,601.5938 170.1375,601.5938 Q170.4656,601.5938 170.7,601.8594 Q170.95,602.1094 170.95,602.4688 Q170.95,602.8125 170.6063,603.2188 Q170.1063,603.8125 169.3094,604.1406 Q168.2625,604.5938 166.9813,604.5938 Q165.4813,604.5938 164.2781,604 Q163.3094,603.5313 162.6219,602.5156 Q161.95,601.5 161.95,600.2969 L161.95,599.2031 Q161.95,597.9531 162.5438,596.8594 Q163.1531,595.7656 164.2,595.1875 Q165.2625,594.5938 166.45,594.5938 Q167.1688,594.5938 167.7938,594.8438 Q168.4188,595.0938 168.95,595.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="230.55" y="596.457">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="187.05" y="611.5508">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="125.5" x2="337.5" y1="619.1875" y2="619.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="130.5" y="634.6064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="125.5" x2="337.5" y1="641.0234" y2="641.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="130.5" y="656.4424">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="130.5" y="670.2783">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="130.5" y="684.1143">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="130.5" y="697.9502">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="130.5" y="711.7861">stopped() «suspend»</text><!--MD5=[67a963a920e61d5a3e163bee231ae3ae]
class TrafficIntersectionController--><rect codeLine="57" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="310.8828" id="TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.5;" width="318" x="373.5" y="493"/><ellipse cx="452.75" cy="509" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M453.75,506 L453.75,512 L455.75,512 L456.2344,512 L456.75,512.625 L456.75,513 L456.75,513.375 L456.2344,514 L455.75,514 L449.75,514 L449.2656,514 L448.75,513.375 L448.75,513 L448.75,512.625 L449.2656,512 L449.75,512 L451.75,512 L451.75,506 L449.75,506 L449.2656,506 L448.75,505.375 L448.75,505 L448.75,504.625 L449.2656,504 L449.75,504 L455.75,504 L456.2344,504 L456.75,504.625 L456.75,505 L456.75,505.375 L456.2344,506 L455.75,506 L453.75,506 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="151" x="473.25" y="513.9102">TrafficIntersectionController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="374.5" x2="690.5" y1="525" y2="525"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="379.5" y="540.4189">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="379.5" y="554.2549">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="379.5" y="568.0908">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="379.5" y="581.9268">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="379.5" y="595.7627">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="379.5" y="609.5986">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="194" x="379.5" y="623.4346">trafficLights: List&lt;TrafficLightController&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="374.5" x2="690.5" y1="629.8516" y2="629.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="379.5" y="645.2705">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="379.5" y="659.1064">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="379.5" y="672.9424">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="379.5" y="686.7783">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="379.5" y="700.6143">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="379.5" y="714.4502">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="379.5" y="728.2861">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="379.5" y="742.1221">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="379.5" y="755.958">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="379.5" y="769.7939">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="379.5" y="783.6299">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="379.5" y="797.4658">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="81" fill="#FEFECE" filter="url(#fidigchudh7mb)" height="407.7344" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:1.5;" width="318" x="301.5" y="7"/><ellipse cx="387.75" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M389.75,19.5 Q389.9531,19 390.1875,18.75 Q390.4219,18.5 390.6875,18.5 Q391.1563,18.5 391.4531,18.7813 Q391.75,19.0625 391.75,19.7188 L391.75,21.2813 Q391.75,21.9375 391.4688,22.2188 Q391.1875,22.5 390.75,22.5 Q390.3594,22.5 390.1094,22.3281 Q389.8594,22.1563 389.75,21.7031 Q389.7031,21.3906 389.5313,21.2188 Q389.2188,20.8906 388.6563,20.7031 Q388.0938,20.5 387.5313,20.5 Q386.8281,20.5 386.2344,20.7813 Q385.6563,21.0625 385.2031,21.6875 Q384.75,22.3125 384.75,23.1719 L384.75,24.0938 Q384.75,25.125 385.5938,25.8125 Q386.4375,26.5 387.9375,26.5 Q388.8281,26.5 389.4531,26.2969 Q389.8125,26.1875 390.2188,25.8281 Q390.4844,25.625 390.625,25.5625 Q390.7656,25.5 390.9375,25.5 Q391.2656,25.5 391.5,25.7656 Q391.75,26.0156 391.75,26.375 Q391.75,26.7188 391.4063,27.125 Q390.9063,27.7188 390.1094,28.0469 Q389.0625,28.5 387.7813,28.5 Q386.2813,28.5 385.0781,27.9063 Q384.1094,27.4375 383.4219,26.4219 Q382.75,25.4063 382.75,24.2031 L382.75,23.1094 Q382.75,21.8594 383.3438,20.7656 Q383.9531,19.6719 385,19.0938 Q386.0625,18.5 387.25,18.5 Q387.9688,18.5 388.5938,18.75 Q389.2188,19 389.75,19.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="408.25" y="27.9102">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="302.5" x2="618.5" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="307.5" y="54.4189">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="307.5" y="68.2549">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="307.5" y="82.0908">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="307.5" y="95.9268">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="307.5" y="109.7627">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="307.5" y="123.5986">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="307.5" y="137.4346">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="307.5" y="151.2705">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="307.5" y="165.1064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="302.5" x2="618.5" y1="171.5234" y2="171.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="307.5" y="186.9424">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="307.5" y="200.7783">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="307.5" y="214.6143">get(name: String): TrafficLightController</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="307.5" y="228.4502">addTrafficLight(name: String, trafficLight: TrafficLightController)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="307.5" y="242.2861">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="307.5" y="256.1221">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="307.5" y="269.958">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="307.5" y="283.7939">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="307.5" y="297.6299">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="307.5" y="311.4658">stop()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="307.5" y="325.3018">off()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="307.5" y="339.1377">next()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="307.5" y="352.9736">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="307.5" y="366.8096">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="307.5" y="380.6455">switch()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="307.5" y="394.4814">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="307.5" y="408.3174">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="114" fill="#90EE90" filter="url(#fidigchudh7mb)" height="222.2188" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:1.5;" width="264" x="671.5" y="100"/><ellipse cx="721.25" cy="120.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M723.25,116.5938 Q723.4531,116.0938 723.6875,115.8438 Q723.9219,115.5938 724.1875,115.5938 Q724.6563,115.5938 724.9531,115.875 Q725.25,116.1563 725.25,116.8125 L725.25,118.375 Q725.25,119.0313 724.9688,119.3125 Q724.6875,119.5938 724.25,119.5938 Q723.8594,119.5938 723.6094,119.4219 Q723.3594,119.25 723.25,118.7969 Q723.2031,118.4844 723.0313,118.3125 Q722.7188,117.9844 722.1563,117.7969 Q721.5938,117.5938 721.0313,117.5938 Q720.3281,117.5938 719.7344,117.875 Q719.1563,118.1563 718.7031,118.7813 Q718.25,119.4063 718.25,120.2656 L718.25,121.1875 Q718.25,122.2188 719.0938,122.9063 Q719.9375,123.5938 721.4375,123.5938 Q722.3281,123.5938 722.9531,123.3906 Q723.3125,123.2813 723.7188,122.9219 Q723.9844,122.7188 724.125,122.6563 Q724.2656,122.5938 724.4375,122.5938 Q724.7656,122.5938 725,122.8594 Q725.25,123.1094 725.25,123.4688 Q725.25,123.8125 724.9063,124.2188 Q724.4063,124.8125 723.6094,125.1406 Q722.5625,125.5938 721.2813,125.5938 Q719.7813,125.5938 718.5781,125 Q717.6094,124.5313 716.9219,123.5156 Q716.25,122.5 716.25,121.2969 L716.25,120.2031 Q716.25,118.9531 716.8438,117.8594 Q717.4531,116.7656 718.5,116.1875 Q719.5625,115.5938 720.75,115.5938 Q721.4688,115.5938 722.0938,115.8438 Q722.7188,116.0938 723.25,116.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="73" x="783.25" y="117.457">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="741.75" y="132.5508">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="672.5" x2="934.5" y1="140.1875" y2="140.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="677.5" y="155.6064">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="677.5" y="169.4424">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="677.5" y="183.2783">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="677.5" y="197.1143">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="680.5" y="210.9502"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="252" x="677.5" y="224.7861">val intersectionState: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="677.5" y="238.6221">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="677.5" y="252.458">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="677.5" y="266.2939">val allowStop: StateFlow&lt;Boolean&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="672.5" x2="934.5" y1="272.7109" y2="272.7109"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="677.5" y="288.1299">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="677.5" y="301.9658">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="677.5" y="315.8018">switch() «suspend»</text><!--MD5=[bc2fd2b436fc94e4eab5352d1c8cc0e4]
link TrafficLightController to TrafficLightStates--><path codeLine="18" d="M821.5,721.324 C821.5,777.176 821.5,853.424 821.5,904 " fill="none" id="TrafficLightController-to-TrafficLightStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="821.5,909.118,825.5,900.118,821.5,904.118,817.5,900.118,821.5,909.118" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="53" d="M285.217,718.326 C306.7,745.347 331.907,776.433 355.5,804 C376.426,828.451 399.772,854.505 421.309,878.074 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="424.75,881.835,421.6246,872.4952,421.3744,878.1465,415.723,877.8962,424.75,881.835" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="398.5" y="848.4951">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="54" d="M233.285,718.238 C234.679,771.888 236.596,845.699 237.931,897.098 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="238.067,902.313,241.8317,893.212,237.937,897.3147,233.8344,893.42,238.067,902.313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="238.5" y="848.4951">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="55" d="M196.015,718.238 C168.207,772.105 129.907,846.296 103.3604,897.72 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="100.9894,902.313,108.673,896.1516,103.2836,897.8704,101.5648,892.481,100.9894,902.313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="134.5" y="848.4951">states «uses»</text><!--MD5=[f99ab679abda8f782610770a06d7759b]
link TrafficIntersectionController to TrafficIntersectionContext--><path codeLine="79" d="M513.892,804.402 C511.538,823.993 509.187,843.565 506.991,861.849 " fill="none" id="TrafficIntersectionController-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="513.92,862.855,504.585,881.877,500.02,861.185,513.92,862.855" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[213e98c6e1b68eaf0278262acaf92988]
link TrafficIntersectionService to TrafficIntersectionController--><path codeLine="110" d="M475.207,415.154 C477.325,431.388 479.742,447.496 482.5,463 C483.099,466.369 483.732,469.767 484.393,473.185 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="491.28,471.922,488.476,492.925,477.57,474.758,491.28,471.922" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="111" d="M330.7195,425.6489 C330.7195,425.6489 323.606,438.998 320.5,445 C300.202,484.221 280.18,529.068 264.283,566.573 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="259.056,578.991,266.2348,572.2482,260.9961,574.3828,258.8616,569.1441,259.056,578.991" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="260.9961" x2="264.0995" y1="574.3828" y2="567.0095"/><polygon fill="#A80036" points="336.436,415.098,330.0608,418.4679,330.7195,425.6489,337.0947,422.279,336.436,415.098" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="321.5" y="459.4951">intersectionFSM «private»</text><!--MD5=[5a10fe9a7b46e29ac4c7cf70982de1b2]
link TrafficIntersectionService to TrafficLightController--><path codeLine="112" d="M486.593,415.158 C495.434,433.043 506.841,449.46 521.5,463 C583.333,520.113 636.704,449.061 708.5,493 C739.298,511.848 764.309,542.53 782.898,571.604 " fill="none" id="TrafficIntersectionService-to-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="785.593,575.88,784.1748,566.1338,782.9256,571.651,777.4084,570.4017,785.593,575.88" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="522.5" y="459.4951">trafficLights «private»</text><!--MD5=[c54291f5f133e8dfbf9f069e7dae8179]
link TrafficIntersectionViewModel to TrafficLightController--><path codeLine="130" d="M808.5498,334.1658 C808.5498,334.1658 815.319,497.955 817.991,562.591 " fill="none" id="TrafficIntersectionViewModel-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="818.544,575.984,822.1687,566.8264,818.3374,570.9883,814.1755,567.157,818.544,575.984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="818.3374" x2="818.007" y1="570.9883" y2="562.995"/><polygon fill="#A80036" points="808.054,322.176,804.3053,328.3362,808.5498,334.1658,812.2985,328.0056,808.054,322.176" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="814.5" y="459.4951">trafficLights</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="795.1048" y="565.2017">1..n</text><!--MD5=[a0825e187c969bcbe7623a28eff8e879]
link TrafficIntersectionViewModel to TrafficIntersectionController--><path codeLine="131" d="M728.5997,332.3643 C728.5997,332.3643 666.493,432.171 635.814,481.474 " fill="none" id="TrafficIntersectionViewModel-TrafficIntersectionController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="628.896,492.591,637.0473,487.0632,631.5378,488.3459,630.2551,482.8364,628.896,492.591" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="631.5378" x2="635.764" y1="488.3459" y2="481.553"/><polygon fill="#A80036" points="734.94,322.176,728.3738,325.1567,728.5997,332.3643,735.1659,329.3836,734.94,322.176" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="653.5" y="459.4951">trafficIntersection</text><!--MD5=[faa62f615a816a8b85a52a4494d88ab0]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

interface TrafficLightController {
    name: String
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)
}

TrafficLightController ..> TrafficLightStates

enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM ..> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionController {
    amberTimeout: Long
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    trafficLights: List<TrafficLightController>
    get(name: String): TrafficLightController
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionController -|> TrafficIntersectionContext

class TrafficIntersectionService {
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightController
    addTrafficLight(name: String, trafficLight: TrafficLightController)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionController
TrafficIntersectionService *- -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService - -> TrafficLightController: trafficLights <<private>>

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String

    val intersectionState: StateFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel *- -> "1..n" TrafficLightController: trafficLights
TrafficIntersectionViewModel *- -> TrafficIntersectionController: trafficIntersection

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>