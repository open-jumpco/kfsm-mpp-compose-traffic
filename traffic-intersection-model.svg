<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1049px" preserveAspectRatio="none" style="width:1098px;height:1049px;background:#FFFFFF;" version="1.1" viewBox="0 0 1098 1049" width="1098px" zoomAndPan="magnify"><defs><filter height="300%" id="f1popnx1m2z2tf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="775" y="909.5"/><ellipse cx="790" cy="929.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M788.5,930.5938 L788.5,932.5938 L792.5,932.5938 L792.5,931.5938 L792.5,931.1094 L793.125,930.5938 L793.5,930.5938 L793.875,930.5938 L794.5,931.1094 L794.5,931.5938 L794.5,934.5938 L786.5,934.5938 L786.0156,934.5938 L785.5,933.9688 L785.5,933.5938 L785.5,933.2188 L786.0156,932.5938 L786.5,932.5938 L786.5,932.5938 L786.5,926.5938 L786.5,926.5938 L786.0156,926.5938 L785.5,925.9688 L785.5,925.5938 L785.5,925.2188 L786.0156,924.5938 L786.5,924.5938 L794.5,924.5938 L794.5,927.5938 L794.5,928.0781 L793.875,928.5938 L793.5,928.5938 L793.125,928.5938 L792.5,928.0781 L792.5,927.5938 L792.5,926.5938 L788.5,926.5938 L788.5,928.5938 L789.5,928.5938 L789.5,928.1094 L789.5,928.1094 L790.125,927.5938 L790.5,927.5938 L790.875,927.5938 L791.5,928.1094 L791.5,928.5938 L791.5,930.5938 L791.5,931.0781 L790.875,931.5938 L790.875,931.5938 L790.5,931.5938 L790.125,931.5938 L789.5,931.0781 L789.5,931.0781 L789.5,930.5938 L788.5,930.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="819.5" y="926.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="804" y="942.0508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="776" x2="901" y1="949.6875" y2="949.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="781" y="965.1064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="781" y="978.9424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="781" y="992.7783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="776" x2="901" y1="999.1953" y2="999.1953"/><!--MD5=[a5d8c30d72bb593ebcb9c3f9d7775a5d]
class TrafficLightEventHandler--><rect codeLine="8" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="144.8516" id="TrafficLightEventHandler" style="stroke:#A80036;stroke-width:1.5;" width="189" x="744" y="576"/><ellipse cx="768.9" cy="592" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M769.9,589 L769.9,595 L771.9,595 L772.3844,595 L772.9,595.625 L772.9,596 L772.9,596.375 L772.3844,597 L771.9,597 L765.9,597 L765.4156,597 L764.9,596.375 L764.9,596 L764.9,595.625 L765.4156,595 L765.9,595 L767.9,595 L767.9,589 L765.9,589 L765.4156,589 L764.9,588.375 L764.9,588 L764.9,587.625 L765.4156,587 L765.9,587 L771.9,587 L772.3844,587 L772.9,587.625 L772.9,588 L772.9,588.375 L772.3844,589 L771.9,589 L769.9,589 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="135" x="785.1" y="596.9102">TrafficLightEventHandler</text><line style="stroke:#A80036;stroke-width:1.5;" x1="745" x2="932" y1="608" y2="608"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="750" y="623.4189">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="750" y="637.2549">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="750" y="651.0908">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="750" y="664.9268">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="750" y="678.7627">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="750" y="692.5986">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="745" x2="932" y1="699.0156" y2="699.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="750" y="714.4346">changeAmberTimeout(value: Long)</text><!--MD5=[9749051c974da246c300c6b23f53e7a6]
class IntersectionStates--><rect codeLine="20" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="111.5313" id="IntersectionStates" style="stroke:#A80036;stroke-width:1.5;" width="131" x="7" y="902.5"/><ellipse cx="22" cy="922.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M20.5,923.5938 L20.5,925.5938 L24.5,925.5938 L24.5,924.5938 L24.5,924.1094 L25.125,923.5938 L25.5,923.5938 L25.875,923.5938 L26.5,924.1094 L26.5,924.5938 L26.5,927.5938 L18.5,927.5938 L18.0156,927.5938 L17.5,926.9688 L17.5,926.5938 L17.5,926.2188 L18.0156,925.5938 L18.5,925.5938 L18.5,925.5938 L18.5,919.5938 L18.5,919.5938 L18.0156,919.5938 L17.5,918.9688 L17.5,918.5938 L17.5,918.2188 L18.0156,917.5938 L18.5,917.5938 L26.5,917.5938 L26.5,920.5938 L26.5,921.0781 L25.875,921.5938 L25.5,921.5938 L25.125,921.5938 L24.5,921.0781 L24.5,920.5938 L24.5,919.5938 L20.5,919.5938 L20.5,921.5938 L21.5,921.5938 L21.5,921.1094 L21.5,921.1094 L22.125,920.5938 L22.5,920.5938 L22.875,920.5938 L23.5,921.1094 L23.5,921.5938 L23.5,923.5938 L23.5,924.0781 L22.875,924.5938 L22.875,924.5938 L22.5,924.5938 L22.125,924.5938 L21.5,924.0781 L21.5,924.0781 L21.5,923.5938 L20.5,923.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="53.5" y="919.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="36" y="935.0508">IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="137" y1="942.6875" y2="942.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="13" y="958.1064">STOPPING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="13" y="971.9424">WAITING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="33" x="13" y="985.7783">GOING</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="13" y="999.6143">STOPPED</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="137" y1="1006.0313" y2="1006.0313"/><!--MD5=[335fb609bd3f47ab478c9b95fb231727]
class IntersectionEvents--><rect codeLine="27" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="111.5313" id="IntersectionEvents" style="stroke:#A80036;stroke-width:1.5;" width="133" x="173" y="902.5"/><ellipse cx="188" cy="922.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M186.5,923.5938 L186.5,925.5938 L190.5,925.5938 L190.5,924.5938 L190.5,924.1094 L191.125,923.5938 L191.5,923.5938 L191.875,923.5938 L192.5,924.1094 L192.5,924.5938 L192.5,927.5938 L184.5,927.5938 L184.0156,927.5938 L183.5,926.9688 L183.5,926.5938 L183.5,926.2188 L184.0156,925.5938 L184.5,925.5938 L184.5,925.5938 L184.5,919.5938 L184.5,919.5938 L184.0156,919.5938 L183.5,918.9688 L183.5,918.5938 L183.5,918.2188 L184.0156,917.5938 L184.5,917.5938 L192.5,917.5938 L192.5,920.5938 L192.5,921.0781 L191.875,921.5938 L191.5,921.5938 L191.125,921.5938 L190.5,921.0781 L190.5,920.5938 L190.5,919.5938 L186.5,919.5938 L186.5,921.5938 L187.5,921.5938 L187.5,921.1094 L187.5,921.1094 L188.125,920.5938 L188.5,920.5938 L188.875,920.5938 L189.5,921.1094 L189.5,921.5938 L189.5,923.5938 L189.5,924.0781 L188.875,924.5938 L188.875,924.5938 L188.5,924.5938 L188.125,924.5938 L187.5,924.0781 L187.5,924.0781 L187.5,923.5938 L186.5,923.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="218.5" y="919.957">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="202" y="935.0508">IntersectionEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="174" x2="305" y1="942.6875" y2="942.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="179" y="958.1064">SWITCH,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49" x="179" y="971.9424">STOPPED,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="179" y="985.7783">STOP,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="179" y="999.6143">START</text><line style="stroke:#A80036;stroke-width:1.5;" x1="174" x2="305" y1="1006.0313" y2="1006.0313"/><!--MD5=[9868cacd5d1749ce2e997e727c15cdbd]
class TrafficIntersectionContext--><rect codeLine="34" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="153.0391" id="TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.5;" width="278" x="358.5" y="882"/><ellipse cx="423.75" cy="902.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M424.75,899.0938 L424.75,905.0938 L426.75,905.0938 L427.2344,905.0938 L427.75,905.7188 L427.75,906.0938 L427.75,906.4688 L427.2344,907.0938 L426.75,907.0938 L420.75,907.0938 L420.2656,907.0938 L419.75,906.4688 L419.75,906.0938 L419.75,905.7188 L420.2656,905.0938 L420.75,905.0938 L422.75,905.0938 L422.75,899.0938 L420.75,899.0938 L420.2656,899.0938 L419.75,898.4688 L419.75,898.0938 L419.75,897.7188 L420.2656,897.0938 L420.75,897.0938 L426.75,897.0938 L427.2344,897.0938 L427.75,897.7188 L427.75,898.0938 L427.75,898.4688 L427.2344,899.0938 L426.75,899.0938 L424.75,899.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="475.25" y="899.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="139" x="444.25" y="914.5508">TrafficIntersectionContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="359.5" x2="635.5" y1="922.1875" y2="922.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="364.5" y="937.6064">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="364.5" y="951.4424">val cycleWaitTime: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="359.5" x2="635.5" y1="957.8594" y2="957.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="266" x="364.5" y="973.2783">suspend fun stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="364.5" y="987.1143">suspend fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="364.5" y="1000.9502">suspend fun stop() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="364.5" y="1014.7861">suspend fun next() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="364.5" y="1028.6221">suspend fun off() «suspend»</text><!--MD5=[c56cb48cb5367e6a067e96aa34014d4b]
class TrafficIntersectionFSM--><rect codeLine="44" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="139.2031" id="TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.5;" width="214" x="123.5" y="579"/><ellipse cx="165.95" cy="599.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M167.95,595.5938 Q168.1531,595.0938 168.3875,594.8438 Q168.6219,594.5938 168.8875,594.5938 Q169.3563,594.5938 169.6531,594.875 Q169.95,595.1563 169.95,595.8125 L169.95,597.375 Q169.95,598.0313 169.6688,598.3125 Q169.3875,598.5938 168.95,598.5938 Q168.5594,598.5938 168.3094,598.4219 Q168.0594,598.25 167.95,597.7969 Q167.9031,597.4844 167.7313,597.3125 Q167.4188,596.9844 166.8563,596.7969 Q166.2938,596.5938 165.7313,596.5938 Q165.0281,596.5938 164.4344,596.875 Q163.8563,597.1563 163.4031,597.7813 Q162.95,598.4063 162.95,599.2656 L162.95,600.1875 Q162.95,601.2188 163.7938,601.9063 Q164.6375,602.5938 166.1375,602.5938 Q167.0281,602.5938 167.6531,602.3906 Q168.0125,602.2813 168.4188,601.9219 Q168.6844,601.7188 168.825,601.6563 Q168.9656,601.5938 169.1375,601.5938 Q169.4656,601.5938 169.7,601.8594 Q169.95,602.1094 169.95,602.4688 Q169.95,602.8125 169.6063,603.2188 Q169.1063,603.8125 168.3094,604.1406 Q167.2625,604.5938 165.9813,604.5938 Q164.4813,604.5938 163.2781,604 Q162.3094,603.5313 161.6219,602.5156 Q160.95,601.5 160.95,600.2969 L160.95,599.2031 Q160.95,597.9531 161.5438,596.8594 Q162.1531,595.7656 163.2,595.1875 Q164.2625,594.5938 165.45,594.5938 Q166.1688,594.5938 166.7938,594.8438 Q167.4188,595.0938 167.95,595.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="229.55" y="596.457">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="186.05" y="611.5508">TrafficIntersectionFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="124.5" x2="336.5" y1="619.1875" y2="619.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="129.5" y="634.6064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="124.5" x2="336.5" y1="641.0234" y2="641.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="129.5" y="656.4424">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="129.5" y="670.2783">startIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="129.5" y="684.1143">stopIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="129.5" y="697.9502">switchIntersection() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="129.5" y="711.7861">stopped() «suspend»</text><!--MD5=[7edde04eb472bac7a7abbff093a59d44]
class TrafficIntersectionEventHandler--><rect codeLine="57" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="310.8828" id="TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:1.5;" width="336" x="372.5" y="493"/><ellipse cx="450.25" cy="509" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M451.25,506 L451.25,512 L453.25,512 L453.7344,512 L454.25,512.625 L454.25,513 L454.25,513.375 L453.7344,514 L453.25,514 L447.25,514 L446.7656,514 L446.25,513.375 L446.25,513 L446.25,512.625 L446.7656,512 L447.25,512 L449.25,512 L449.25,506 L447.25,506 L446.7656,506 L446.25,505.375 L446.25,505 L446.25,504.625 L446.7656,504 L447.25,504 L453.25,504 L453.7344,504 L454.25,504.625 L454.25,505 L454.25,505.375 L453.7344,506 L453.25,506 L451.25,506 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="172" x="470.75" y="513.9102">TrafficIntersectionEventHandler</text><line style="stroke:#A80036;stroke-width:1.5;" x1="373.5" x2="707.5" y1="525" y2="525"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="378.5" y="540.4189">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="378.5" y="554.2549">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="378.5" y="568.0908">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="378.5" y="581.9268">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="378.5" y="595.7627">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="378.5" y="609.5986">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="212" x="378.5" y="623.4346">trafficLights: List&lt;TrafficLightEventHandler&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="373.5" x2="707.5" y1="629.8516" y2="629.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="378.5" y="645.2705">get(name: String): TrafficLightEventHandler</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="378.5" y="659.1064">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="378.5" y="672.9424">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="378.5" y="686.7783">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="324" x="378.5" y="700.6143">addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="378.5" y="714.4502">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="378.5" y="728.2861">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="378.5" y="742.1221">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="378.5" y="755.958">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="378.5" y="769.7939">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="378.5" y="783.6299">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="378.5" y="797.4658">switch()</text><!--MD5=[09381f51bdf889138526ece6de7cd791]
class TrafficIntersectionService--><rect codeLine="81" fill="#FEFECE" filter="url(#f1popnx1m2z2tf)" height="407.7344" id="TrafficIntersectionService" style="stroke:#A80036;stroke-width:1.5;" width="336" x="309.5" y="7"/><ellipse cx="404.75" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M406.75,19.5 Q406.9531,19 407.1875,18.75 Q407.4219,18.5 407.6875,18.5 Q408.1563,18.5 408.4531,18.7813 Q408.75,19.0625 408.75,19.7188 L408.75,21.2813 Q408.75,21.9375 408.4688,22.2188 Q408.1875,22.5 407.75,22.5 Q407.3594,22.5 407.1094,22.3281 Q406.8594,22.1563 406.75,21.7031 Q406.7031,21.3906 406.5313,21.2188 Q406.2188,20.8906 405.6563,20.7031 Q405.0938,20.5 404.5313,20.5 Q403.8281,20.5 403.2344,20.7813 Q402.6563,21.0625 402.2031,21.6875 Q401.75,22.3125 401.75,23.1719 L401.75,24.0938 Q401.75,25.125 402.5938,25.8125 Q403.4375,26.5 404.9375,26.5 Q405.8281,26.5 406.4531,26.2969 Q406.8125,26.1875 407.2188,25.8281 Q407.4844,25.625 407.625,25.5625 Q407.7656,25.5 407.9375,25.5 Q408.2656,25.5 408.5,25.7656 Q408.75,26.0156 408.75,26.375 Q408.75,26.7188 408.4063,27.125 Q407.9063,27.7188 407.1094,28.0469 Q406.0625,28.5 404.7813,28.5 Q403.2813,28.5 402.0781,27.9063 Q401.1094,27.4375 400.4219,26.4219 Q399.75,25.4063 399.75,24.2031 L399.75,23.1094 Q399.75,21.8594 400.3438,20.7656 Q400.9531,19.6719 402,19.0938 Q403.0625,18.5 404.25,18.5 Q404.9688,18.5 405.5938,18.75 Q406.2188,19 406.75,19.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="425.25" y="27.9102">TrafficIntersectionService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="310.5" x2="644.5" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="315.5" y="54.4189">state: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="315.5" y="68.2549">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="315.5" y="82.0908">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="315.5" y="95.9268">listOrder: List&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="315.5" y="109.7627">cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="315.5" y="123.5986">currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="315.5" y="137.4346">current: TrafficLightContext</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="315.5" y="151.2705">cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="315.5" y="165.1064">currentState: IntersectionStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="310.5" x2="644.5" y1="171.5234" y2="171.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="315.5" y="186.9424">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="315.5" y="200.7783">setupIntersection()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="315.5" y="214.6143">get(name: String): TrafficLightEventHandler</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="324" x="315.5" y="228.4502">addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="315.5" y="242.2861">startTrafficLight(name: String)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="315.5" y="256.1221">stateChanged(toState: IntersectionStates)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="315.5" y="269.958">changeCycleTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="170" x="315.5" y="283.7939">changeCycleWaitTime(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="30" x="315.5" y="297.6299">start()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="315.5" y="311.4658">stop()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="22" x="315.5" y="325.3018">off()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="29" x="315.5" y="339.1377">next()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="315.5" y="352.9736">startSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="315.5" y="366.8096">stopSystem()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="315.5" y="380.6455">switch()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="47" x="315.5" y="394.4814">stopped()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="315.5" y="408.3174">allowedEvents(): Set&lt;IntersectionEvents&gt;</text><!--MD5=[ce902affe73128e0a9c1460ddb6351ac]
class TrafficIntersectionViewModel--><rect codeLine="114" fill="#90EE90" filter="url(#f1popnx1m2z2tf)" height="222.2188" id="TrafficIntersectionViewModel" style="stroke:#A80036;stroke-width:1.5;" width="264" x="693.5" y="100"/><ellipse cx="743.25" cy="120.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M745.25,116.5938 Q745.4531,116.0938 745.6875,115.8438 Q745.9219,115.5938 746.1875,115.5938 Q746.6563,115.5938 746.9531,115.875 Q747.25,116.1563 747.25,116.8125 L747.25,118.375 Q747.25,119.0313 746.9688,119.3125 Q746.6875,119.5938 746.25,119.5938 Q745.8594,119.5938 745.6094,119.4219 Q745.3594,119.25 745.25,118.7969 Q745.2031,118.4844 745.0313,118.3125 Q744.7188,117.9844 744.1563,117.7969 Q743.5938,117.5938 743.0313,117.5938 Q742.3281,117.5938 741.7344,117.875 Q741.1563,118.1563 740.7031,118.7813 Q740.25,119.4063 740.25,120.2656 L740.25,121.1875 Q740.25,122.2188 741.0938,122.9063 Q741.9375,123.5938 743.4375,123.5938 Q744.3281,123.5938 744.9531,123.3906 Q745.3125,123.2813 745.7188,122.9219 Q745.9844,122.7188 746.125,122.6563 Q746.2656,122.5938 746.4375,122.5938 Q746.7656,122.5938 747,122.8594 Q747.25,123.1094 747.25,123.4688 Q747.25,123.8125 746.9063,124.2188 Q746.4063,124.8125 745.6094,125.1406 Q744.5625,125.5938 743.2813,125.5938 Q741.7813,125.5938 740.5781,125 Q739.6094,124.5313 738.9219,123.5156 Q738.25,122.5 738.25,121.2969 L738.25,120.2031 Q738.25,118.9531 738.8438,117.8594 Q739.4531,116.7656 740.5,116.1875 Q741.5625,115.5938 742.75,115.5938 Q743.4688,115.5938 744.0938,115.8438 Q744.7188,116.0938 745.25,116.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="73" x="805.25" y="117.457">«viewmodel»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="763.75" y="132.5508">TrafficIntersectionViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="694.5" x2="956.5" y1="140.1875" y2="140.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="699.5" y="155.6064">val amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="116" x="699.5" y="169.4424">val cycleWaitTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="699.5" y="183.2783">val cycleTime: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="699.5" y="197.1143">val currentName: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="702.5" y="210.9502"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="252" x="699.5" y="224.7861">val intersectionState: StateFlow&lt;IntersectionStates&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="699.5" y="238.6221">val allowStart: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="699.5" y="252.458">val allowSwitch: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="699.5" y="266.2939">val allowStop: StateFlow&lt;Boolean&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="694.5" x2="956.5" y1="272.7109" y2="272.7109"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="699.5" y="288.1299">startSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="699.5" y="301.9658">stopSystem() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="699.5" y="315.8018">switch() «suspend»</text><!--MD5=[b1d46488418bc0cd55cf54b5fc017696]
class ViewModel--><rect codeLine="133" fill="#008000" filter="url(#f1popnx1m2z2tf)" height="56.1875" id="ViewModel" style="stroke:#A80036;stroke-width:1.5;" width="91" x="993" y="183"/><ellipse cx="1008" cy="203.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1010,199.5938 Q1010.2031,199.0938 1010.4375,198.8438 Q1010.6719,198.5938 1010.9375,198.5938 Q1011.4063,198.5938 1011.7031,198.875 Q1012,199.1563 1012,199.8125 L1012,201.375 Q1012,202.0313 1011.7188,202.3125 Q1011.4375,202.5938 1011,202.5938 Q1010.6094,202.5938 1010.3594,202.4219 Q1010.1094,202.25 1010,201.7969 Q1009.9531,201.4844 1009.7813,201.3125 Q1009.4688,200.9844 1008.9063,200.7969 Q1008.3438,200.5938 1007.7813,200.5938 Q1007.0781,200.5938 1006.4844,200.875 Q1005.9063,201.1563 1005.4531,201.7813 Q1005,202.4063 1005,203.2656 L1005,204.1875 Q1005,205.2188 1005.8438,205.9063 Q1006.6875,206.5938 1008.1875,206.5938 Q1009.0781,206.5938 1009.7031,206.3906 Q1010.0625,206.2813 1010.4688,205.9219 Q1010.7344,205.7188 1010.875,205.6563 Q1011.0156,205.5938 1011.1875,205.5938 Q1011.5156,205.5938 1011.75,205.8594 Q1012,206.1094 1012,206.4688 Q1012,206.8125 1011.6563,207.2188 Q1011.1563,207.8125 1010.3594,208.1406 Q1009.3125,208.5938 1008.0313,208.5938 Q1006.5313,208.5938 1005.3281,208 Q1004.3594,207.5313 1003.6719,206.5156 Q1003,205.5 1003,204.2969 L1003,203.2031 Q1003,201.9531 1003.5938,200.8594 Q1004.2031,199.7656 1005.25,199.1875 Q1006.3125,198.5938 1007.5,198.5938 Q1008.2188,198.5938 1008.8438,198.8438 Q1009.4688,199.0938 1010,199.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="56" x="1023.5" y="200.457">«android»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="1022" y="215.5508">ViewModel</text><line style="stroke:#A80036;stroke-width:1.5;" x1="994" x2="1083" y1="223.1875" y2="223.1875"/><line style="stroke:#A80036;stroke-width:1.5;" x1="994" x2="1083" y1="231.1875" y2="231.1875"/><!--MD5=[e1ae8d81e56d504b2232d14ffa3664e6]
link TrafficLightEventHandler to TrafficLightStates--><path codeLine="18" d="M838.5,721.324 C838.5,777.176 838.5,853.424 838.5,904 " fill="none" id="TrafficLightEventHandler-to-TrafficLightStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="838.5,909.118,842.5,900.118,838.5,904.118,834.5,900.118,838.5,909.118" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[02c58767cbaebf5fe961d047052ec028]
link TrafficIntersectionFSM to TrafficIntersectionContext--><path codeLine="53" d="M283.761,718.071 C305.29,745.2 330.649,776.428 354.5,804 C375.761,828.578 399.573,854.67 421.575,878.236 " fill="none" id="TrafficIntersectionFSM-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="425.09,881.996,421.8666,872.6896,421.6758,878.3432,416.0221,878.1523,425.09,881.996" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="398.5" y="848.4951">context</text><!--MD5=[9468340d7453291c53dc9c139c20e995]
link TrafficIntersectionFSM to IntersectionEvents--><path codeLine="54" d="M232.509,718.238 C234.076,771.888 236.233,845.699 237.735,897.098 " fill="none" id="TrafficIntersectionFSM-to-IntersectionEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="237.887,902.313,241.6231,893.2003,237.7413,897.3151,233.6264,893.4334,237.887,902.313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="237.5" y="848.4951">events «uses»</text><!--MD5=[fe4ec4b482b722450bc85149b58e4a7c]
link TrafficIntersectionFSM to IntersectionStates--><path codeLine="55" d="M195.238,718.238 C167.605,772.105 129.546,846.296 103.1663,897.72 " fill="none" id="TrafficIntersectionFSM-to-IntersectionStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="100.8103,902.313,108.478,896.1318,103.093,897.8645,101.3603,892.4795,100.8103,902.313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="134.5" y="848.4951">states «uses»</text><!--MD5=[bf504e590ef5f0ed45f1c6c906ad0fbf]
link TrafficIntersectionEventHandler to TrafficIntersectionContext--><path codeLine="79" d="M518.874,804.402 C516.139,823.993 513.406,843.565 510.854,861.849 " fill="none" id="TrafficIntersectionEventHandler-to-TrafficIntersectionContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="517.756,863.037,508.058,881.877,503.89,861.102,517.756,863.037" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[7b984e9d12bd2ad1569c6c891f886256]
link TrafficIntersectionService to TrafficIntersectionEventHandler--><path codeLine="110" d="M492.998,415.023 C494.939,431.286 497.099,447.436 499.5,463 C499.992,466.192 500.508,469.412 501.043,472.652 " fill="none" id="TrafficIntersectionService-to-TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="508.008,471.846,504.566,492.754,494.219,474.262,508.008,471.846" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a0c4c6e1b7e6bd88c7aa08379bf65076]
link TrafficIntersectionService to TrafficIntersectionFSM--><path codeLine="111" d="M349.4712,425.7088 C349.4712,425.7088 341.851,439.064 338.5,445 C316.054,484.762 292.061,529.504 272.405,566.799 " fill="none" id="TrafficIntersectionService-TrafficIntersectionFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="266.183,578.631,273.912,572.5268,268.51,574.2055,266.8313,568.8035,266.183,578.631" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="268.51" x2="272.234" y1="574.2055" y2="567.1245"/><polygon fill="#A80036" points="355.446,415.302,348.9897,418.5138,349.4712,425.7088,355.9275,422.497,355.446,415.302" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="339.5" y="459.4951">intersectionFSM «private»</text><!--MD5=[f96f6775ec67c35e7f6bb021a13357d7]
link TrafficIntersectionService to TrafficLightEventHandler--><path codeLine="112" d="M501.037,415.1 C509.689,432.996 520.94,449.431 535.5,463 C598.044,521.283 652.526,448.464 725.5,493 C756.322,511.81 781.336,542.486 799.921,571.566 " fill="none" id="TrafficIntersectionService-to-TrafficLightEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="802.616,575.843,801.2017,566.0962,799.9502,571.6129,794.4335,570.3615,802.616,575.843" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="536.5" y="459.4951">trafficLights «private»</text><!--MD5=[cc2dd5b70b00694c4ef57b4f239bfc7e]
link TrafficIntersectionViewModel to TrafficLightEventHandler--><path codeLine="130" d="M829.1464,334.1707 C829.1464,334.1707 834.036,497.955 835.965,562.591 " fill="none" id="TrafficIntersectionViewModel-TrafficLightEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="836.365,575.984,840.0942,566.8685,836.2156,570.9862,832.0978,567.1076,836.365,575.984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.2156" x2="835.977" y1="570.9862" y2="562.99"/><polygon fill="#A80036" points="828.789,322.176,824.9695,328.2925,829.1464,334.1707,832.9659,328.0542,828.789,322.176" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="833.5" y="459.4951">trafficLights</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="813.0105" y="565.2017">1..n</text><!--MD5=[642468606f4d2d9c0bbf80f925485bcd]
link TrafficIntersectionViewModel to TrafficIntersectionEventHandler--><path codeLine="131" d="M746.8273,332.2172 C746.8273,332.2172 681.415,432.171 649.151,481.474 " fill="none" id="TrafficIntersectionViewModel-TrafficIntersectionEventHandler" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="641.876,492.591,650.1516,487.251,644.6142,488.4074,643.4578,482.87,641.876,492.591" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="644.6142" x2="648.9945" y1="488.4074" y2="481.713"/><polygon fill="#A80036" points="753.398,322.176,746.7656,325.0064,746.8273,332.2172,753.4598,329.3868,753.398,322.176" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="667.5" y="459.4951">trafficIntersection</text><!--MD5=[41e7f14ec2c21c1a00393e97e83aea7b]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

interface TrafficLightEventHandler {
    name: String
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)
}

TrafficLightEventHandler ..> TrafficLightStates

enum IntersectionStates <<fsm-state>> {
    STOPPING
    WAITING
    GOING
    STOPPED
}

enum IntersectionEvents <<fsm-event>> {
    SWITCH,
    STOPPED,
    STOP,
    START
}

interface TrafficIntersectionContext <<fsm-context>> {
    val cycleTime: Long
    val cycleWaitTime: Long
    suspend fun stateChanged(toState: IntersectionStates)
    suspend fun start() <<suspend>>
    suspend fun stop() <<suspend>>
    suspend fun next() <<suspend>>
    suspend fun off() <<suspend>>
}

class TrafficIntersectionFSM <<fsm>> {
    currentState: IntersectionStates
    allowedEvents(): Set<IntersectionEvents>
    startIntersection() <<suspend>>
    stopIntersection() <<suspend>>
    switchIntersection() <<suspend>>
    stopped() <<suspend>>
}

TrafficIntersectionFSM - -> TrafficIntersectionContext: context
TrafficIntersectionFSM ..> IntersectionEvents: events <<uses>>
TrafficIntersectionFSM ..> IntersectionStates: states <<uses>>

interface TrafficIntersectionEventHandler {
    amberTimeout: Long
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    currentName: String
    current: TrafficLightContext
    listOrder: List<String>
    trafficLights: List<TrafficLightEventHandler>
    get(name: String): TrafficLightEventHandler
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    changeAmberTimeout(value: Long)
    addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)
    allowedEvents(): Set<IntersectionEvents>
    setupIntersection()
    stopped()
    startTrafficLight(name: String)
    startSystem()
    stopSystem()
    switch()
}

TrafficIntersectionEventHandler -|> TrafficIntersectionContext

class TrafficIntersectionService {
    state: StateFlow<IntersectionStates>
    stopped: SharedFlow<Long>
    amberTimeout: Long
    changeAmberTimeout(value: Long)
    setupIntersection()
    listOrder: List<String>
    cycleTime: Long
        currentName: String
        current: TrafficLightContext
        cycleWaitTime: Long
        currentState: IntersectionStates
    get(name: String): TrafficLightEventHandler
    addTrafficLight(name: String, trafficLight: TrafficLightEventHandler)
    startTrafficLight(name: String)
    stateChanged(toState: IntersectionStates)
    changeCycleTime(value: Long)
    changeCycleWaitTime(value: Long)
    start()
    stop()
    off()
    next()
    startSystem()
    stopSystem()
    switch()
    stopped()
    allowedEvents(): Set<IntersectionEvents>
}

TrafficIntersectionService - -|> TrafficIntersectionEventHandler
TrafficIntersectionService *- -> TrafficIntersectionFSM: intersectionFSM <<private>>
TrafficIntersectionService - -> TrafficLightEventHandler: trafficLights <<private>>

class TrafficIntersectionViewModel <<viewmodel>> #lightgreen {
    val amberTimeout: Long
    val cycleWaitTime: Long
    val cycleTime: Long
    val currentName: String

    val intersectionState: StateFlow<IntersectionStates>
    val allowStart: StateFlow<Boolean>
    val allowSwitch: StateFlow<Boolean>
    val allowStop: StateFlow<Boolean>

    startSystem() <<suspend>>
    stopSystem() <<suspend>>
    switch() <<suspend>>
}

TrafficIntersectionViewModel *- -> "1..n" TrafficLightEventHandler: trafficLights
TrafficIntersectionViewModel *- -> TrafficIntersectionEventHandler: trafficIntersection

class ViewModel <<android>> #green {
}

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>