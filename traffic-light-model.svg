<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="852px" preserveAspectRatio="none" style="width:575px;height:852px;background:#FFFFFF;" version="1.1" viewBox="0 0 575 852" width="575px" zoomAndPan="magnify"><defs><filter height="300%" id="fhenc2vmbxkb6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#fhenc2vmbxkb6)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="270.5" y="741"/><ellipse cx="285.5" cy="761.0938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M284,762.0938 L284,764.0938 L288,764.0938 L288,763.0938 L288,762.6094 L288.625,762.0938 L289,762.0938 L289.375,762.0938 L290,762.6094 L290,763.0938 L290,766.0938 L282,766.0938 L281.5156,766.0938 L281,765.4688 L281,765.0938 L281,764.7188 L281.5156,764.0938 L282,764.0938 L282,764.0938 L282,758.0938 L282,758.0938 L281.5156,758.0938 L281,757.4688 L281,757.0938 L281,756.7188 L281.5156,756.0938 L282,756.0938 L290,756.0938 L290,759.0938 L290,759.5781 L289.375,760.0938 L289,760.0938 L288.625,760.0938 L288,759.5781 L288,759.0938 L288,758.0938 L284,758.0938 L284,760.0938 L285,760.0938 L285,759.6094 L285,759.6094 L285.625,759.0938 L286,759.0938 L286.375,759.0938 L287,759.6094 L287,760.0938 L287,762.0938 L287,762.5781 L286.375,763.0938 L286.375,763.0938 L286,763.0938 L285.625,763.0938 L285,762.5781 L285,762.5781 L285,762.0938 L284,762.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="315" y="758.457">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="299.5" y="773.5508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="271.5" x2="396.5" y1="781.1875" y2="781.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="276.5" y="796.6064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="276.5" y="810.4424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="276.5" y="824.2783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="271.5" x2="396.5" y1="830.6953" y2="830.6953"/><!--MD5=[082ea4b1b4c949e9e678c41ae71c099b]
class TrafficLightEvents--><rect codeLine="8" fill="#FEFECE" filter="url(#fhenc2vmbxkb6)" height="83.8594" id="TrafficLightEvents" style="stroke:#A80036;stroke-width:1.5;" width="129" x="432.5" y="748"/><ellipse cx="447.5" cy="768.0938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M446,769.0938 L446,771.0938 L450,771.0938 L450,770.0938 L450,769.6094 L450.625,769.0938 L451,769.0938 L451.375,769.0938 L452,769.6094 L452,770.0938 L452,773.0938 L444,773.0938 L443.5156,773.0938 L443,772.4688 L443,772.0938 L443,771.7188 L443.5156,771.0938 L444,771.0938 L444,771.0938 L444,765.0938 L444,765.0938 L443.5156,765.0938 L443,764.4688 L443,764.0938 L443,763.7188 L443.5156,763.0938 L444,763.0938 L452,763.0938 L452,766.0938 L452,766.5781 L451.375,767.0938 L451,767.0938 L450.625,767.0938 L450,766.5781 L450,766.0938 L450,765.0938 L446,765.0938 L446,767.0938 L447,767.0938 L447,766.6094 L447,766.6094 L447.625,766.0938 L448,766.0938 L448.375,766.0938 L449,766.6094 L449,767.0938 L449,769.0938 L449,769.5781 L448.375,770.0938 L448.375,770.0938 L448,770.0938 L447.625,770.0938 L447,769.5781 L447,769.5781 L447,769.0938 L446,769.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="476" y="765.457">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="461.5" y="780.5508">TrafficLightEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="433.5" x2="560.5" y1="788.1875" y2="788.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27" x="438.5" y="803.6064">STOP</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="16" x="438.5" y="817.4424">GO</text><line style="stroke:#A80036;stroke-width:1.5;" x1="433.5" x2="560.5" y1="823.8594" y2="823.8594"/><!--MD5=[a261c3b0f6dc39c3323e9647de972898]
class TrafficLightContext--><rect codeLine="12" fill="#FEFECE" filter="url(#fhenc2vmbxkb6)" height="153.0391" id="TrafficLightContext" style="stroke:#A80036;stroke-width:1.5;" width="270" x="7" y="510"/><ellipse cx="86.75" cy="530.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M87.75,527.0938 L87.75,533.0938 L89.75,533.0938 L90.2344,533.0938 L90.75,533.7188 L90.75,534.0938 L90.75,534.4688 L90.2344,535.0938 L89.75,535.0938 L83.75,535.0938 L83.2656,535.0938 L82.75,534.4688 L82.75,534.0938 L82.75,533.7188 L83.2656,533.0938 L83.75,533.0938 L85.75,533.0938 L85.75,527.0938 L83.75,527.0938 L83.2656,527.0938 L82.75,526.4688 L82.75,526.0938 L82.75,525.7188 L83.2656,525.0938 L83.75,525.0938 L89.75,525.0938 L90.2344,525.0938 L90.75,525.7188 L90.75,526.0938 L90.75,526.4688 L90.2344,527.0938 L89.75,527.0938 L87.75,527.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="119.75" y="527.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="102" x="107.25" y="542.5508">TrafficLightContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="276" y1="550.1875" y2="550.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="13" y="565.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="13" y="579.4424">amberTimeout: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="276" y1="585.8594" y2="585.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="13" y="601.2783">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="13" y="615.1143">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="13" y="628.9502">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="13" y="642.7861">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="13" y="656.6221">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[d85e1abf3caa9c226551ac440a773ac6]
class TrafficLightController--><rect codeLine="22" fill="#FEFECE" filter="url(#fhenc2vmbxkb6)" height="131.0156" id="TrafficLightController" style="stroke:#A80036;stroke-width:1.5;" width="189" x="128.5" y="318"/><ellipse cx="162.85" cy="334" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M163.85,331 L163.85,337 L165.85,337 L166.3344,337 L166.85,337.625 L166.85,338 L166.85,338.375 L166.3344,339 L165.85,339 L159.85,339 L159.3656,339 L158.85,338.375 L158.85,338 L158.85,337.625 L159.3656,337 L159.85,337 L161.85,337 L161.85,331 L159.85,331 L159.3656,331 L158.85,330.375 L158.85,330 L158.85,329.625 L159.3656,329 L159.85,329 L165.85,329 L166.3344,329 L166.85,329.625 L166.85,330 L166.85,330.375 L166.3344,331 L165.85,331 L163.85,331 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="114" x="181.15" y="338.9102">TrafficLightController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="129.5" x2="316.5" y1="350" y2="350"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="134.5" y="365.4189">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="134.5" y="379.2549">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="134.5" y="393.0908">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="134.5" y="406.9268">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="134.5" y="420.7627">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="129.5" x2="316.5" y1="427.1797" y2="427.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="134.5" y="442.5986">changeAmberTimeout(value: Long)</text><!--MD5=[8f5d905706df63f012d7d74357fff60c]
class TrafficLightFSM--><rect codeLine="32" fill="#FEFECE" filter="url(#fhenc2vmbxkb6)" height="83.8594" id="TrafficLightFSM" style="stroke:#A80036;stroke-width:1.5;" width="118" x="357" y="544.5"/><ellipse cx="372.9" cy="564.5938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M374.9,561.0938 Q375.1031,560.5938 375.3375,560.3438 Q375.5719,560.0938 375.8375,560.0938 Q376.3063,560.0938 376.6031,560.375 Q376.9,560.6563 376.9,561.3125 L376.9,562.875 Q376.9,563.5313 376.6188,563.8125 Q376.3375,564.0938 375.9,564.0938 Q375.5094,564.0938 375.2594,563.9219 Q375.0094,563.75 374.9,563.2969 Q374.8531,562.9844 374.6813,562.8125 Q374.3688,562.4844 373.8063,562.2969 Q373.2438,562.0938 372.6813,562.0938 Q371.9781,562.0938 371.3844,562.375 Q370.8063,562.6563 370.3531,563.2813 Q369.9,563.9063 369.9,564.7656 L369.9,565.6875 Q369.9,566.7188 370.7438,567.4063 Q371.5875,568.0938 373.0875,568.0938 Q373.9781,568.0938 374.6031,567.8906 Q374.9625,567.7813 375.3688,567.4219 Q375.6344,567.2188 375.775,567.1563 Q375.9156,567.0938 376.0875,567.0938 Q376.4156,567.0938 376.65,567.3594 Q376.9,567.6094 376.9,567.9688 Q376.9,568.3125 376.5563,568.7188 Q376.0563,569.3125 375.2594,569.6406 Q374.2125,570.0938 372.9313,570.0938 Q371.4313,570.0938 370.2281,569.5 Q369.2594,569.0313 368.5719,568.0156 Q367.9,567 367.9,565.7969 L367.9,564.7031 Q367.9,563.4531 368.4938,562.3594 Q369.1031,561.2656 370.15,560.6875 Q371.2125,560.0938 372.4,560.0938 Q373.1188,560.0938 373.7438,560.3438 Q374.3688,560.5938 374.9,561.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="412.1" y="561.957">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="387.1" y="577.0508">TrafficLightFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="358" x2="474" y1="584.6875" y2="584.6875"/><line style="stroke:#A80036;stroke-width:1.5;" x1="358" x2="474" y1="592.6875" y2="592.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="363" y="608.1064">fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="363" y="621.9424">fun stop() «suspend»</text><!--MD5=[24d80c7a7824efcf0b8bd16fe5b50cae]
class TrafficLightService--><rect codeLine="41" fill="#FEFECE" filter="url(#fhenc2vmbxkb6)" height="249.8906" id="TrafficLightService" style="stroke:#A80036;stroke-width:1.5;" width="270" x="212" y="7"/><ellipse cx="273.25" cy="27.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M275.25,23.5938 Q275.4531,23.0938 275.6875,22.8438 Q275.9219,22.5938 276.1875,22.5938 Q276.6563,22.5938 276.9531,22.875 Q277.25,23.1563 277.25,23.8125 L277.25,25.375 Q277.25,26.0313 276.9688,26.3125 Q276.6875,26.5938 276.25,26.5938 Q275.8594,26.5938 275.6094,26.4219 Q275.3594,26.25 275.25,25.7969 Q275.2031,25.4844 275.0313,25.3125 Q274.7188,24.9844 274.1563,24.7969 Q273.5938,24.5938 273.0313,24.5938 Q272.3281,24.5938 271.7344,24.875 Q271.1563,25.1563 270.7031,25.7813 Q270.25,26.4063 270.25,27.2656 L270.25,28.1875 Q270.25,29.2188 271.0938,29.9063 Q271.9375,30.5938 273.4375,30.5938 Q274.3281,30.5938 274.9531,30.3906 Q275.3125,30.2813 275.7188,29.9219 Q275.9844,29.7188 276.125,29.6563 Q276.2656,29.5938 276.4375,29.5938 Q276.7656,29.5938 277,29.8594 Q277.25,30.1094 277.25,30.4688 Q277.25,30.8125 276.9063,31.2188 Q276.4063,31.8125 275.6094,32.1406 Q274.5625,32.5938 273.2813,32.5938 Q271.7813,32.5938 270.5781,32 Q269.6094,31.5313 268.9219,30.5156 Q268.25,29.5 268.25,28.2969 L268.25,27.2031 Q268.25,25.9531 268.8438,24.8594 Q269.4531,23.7656 270.5,23.1875 Q271.5625,22.5938 272.75,22.5938 Q273.4688,22.5938 274.0938,22.8438 Q274.7188,23.0938 275.25,23.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="143" x="291.75" y="24.457">«context-implementation»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="313.25" y="39.5508">TrafficLightService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="213" x2="481" y1="47.1875" y2="47.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="218" y="62.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="218" y="76.4424">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="218" y="90.2783">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="218" y="104.1143">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="218" y="117.9502">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="218" y="131.7861">stopped: SharedFlow&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="218" y="145.6221">state: StateFlow&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="213" x2="481" y1="152.0391" y2="152.0391"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="218" y="167.458">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="221" y="181.2939"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="218" y="195.1299">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="218" y="208.9658">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="218" y="222.8018">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="218" y="236.6377">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="218" y="250.4736">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[e90295f2306cf9f2d48d2dd155fc66d8]
link TrafficLightController to TrafficLightContext--><path codeLine="30" d="M196.925,449.204 C191.584,462.459 185.857,476.67 180.191,490.731 " fill="none" id="TrafficLightController-to-TrafficLightContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="186.511,493.774,172.543,509.707,173.526,488.541,186.511,493.774" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[f5a4d25a21e2db1a9bef5b5bdfa80daf]
link TrafficLightFSM to TrafficLightStates--><path codeLine="37" d="M399.208,628.763 C386.614,659.71 369.273,702.324 355.639,735.827 " fill="none" id="TrafficLightFSM-to-TrafficLightStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="353.655,740.7017,360.7518,733.8726,355.5393,736.0703,353.3416,730.8578,353.655,740.7017" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="373" y="707.4951">«uses»</text><!--MD5=[ef55fa34c35daebc710b7e66915eb99f]
link TrafficLightFSM to TrafficLightEvents--><path codeLine="38" d="M432.587,628.763 C445.91,661.905 464.611,708.427 478.433,742.8106 " fill="none" id="TrafficLightFSM-to-TrafficLightEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="480.435,747.7924,480.7902,737.9499,478.5704,743.1531,473.3673,740.9333,480.435,747.7924" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="464" y="707.4951">«uses»</text><!--MD5=[4f773506094c7b19ae20184ee571cf4e]
reverse link TrafficLightContext to TrafficLightFSM--><path codeLine="39" d="M282.627,586.5 C308.786,586.5 334.767,586.5 356.754,586.5 " fill="none" id="TrafficLightContext-backto-TrafficLightFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="277.395,586.5,286.395,590.5,282.395,586.5,286.395,582.5,277.395,586.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="295.5" y="579.9951">context</text><!--MD5=[a14a1606ab3e0ad97f005eafd1d1dbee]
link TrafficLightService to TrafficLightController--><path codeLine="58" d="M285.363,257.019 C278.176,271.481 270.982,285.956 264.168,299.667 " fill="none" id="TrafficLightService-to-TrafficLightController" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="270.317,303.022,255.147,317.817,257.78,296.791,270.317,303.022" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b02eea57f08a8734f953d301797f548e]
link TrafficLightService to TrafficLightFSM--><path codeLine="59" d="M367.7539,269.109 C367.7539,269.109 397.963,467.211 407.735,531.301 " fill="none" id="TrafficLightService-TrafficLightFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="409.713,544.271,412.3114,534.7711,408.9597,539.3281,404.4027,535.9764,409.713,544.271" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="408.9597" x2="407.753" y1="539.3281" y2="531.4195"/><polygon fill="#A80036" points="365.946,257.246,362.8956,263.7802,367.7539,269.109,370.8043,262.5749,365.946,257.246" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="396" y="388.9951">fsm</text><!--MD5=[c9e39892c13622e6a146cd5ee7067884]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

enum TrafficLightEvents <<fsm-event>> {
    STOP
    GO
}
interface TrafficLightContext <<fsm-context>> {
    name: String
    amberTimeout: Long
    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

interface TrafficLightController {
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)
}
TrafficLightController -down-|> TrafficLightContext

class TrafficLightFSM <<fsm>> {
    fun start() <<suspend>>
    fun stop() <<suspend>>
}

TrafficLightFSM ..> TrafficLightStates: <<uses>>
TrafficLightFSM ..> TrafficLightEvents: <<uses>>
TrafficLightFSM -left-> TrafficLightContext: context

class TrafficLightService <<context-implementation>> {
    name: String
    amberTimeout: Long
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: SharedFlow<Long>
    state: StateFlow<TrafficLightStates>
    changeAmberTimeout(value: Long)

    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

TrafficLightService - -|> TrafficLightController
TrafficLightService *- -> TrafficLightFSM: fsm

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>