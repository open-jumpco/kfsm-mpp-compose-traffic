<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="663px" preserveAspectRatio="none" style="width:740px;height:663px;background:#FFFFFF;" version="1.1" viewBox="0 0 740 663" width="740px" zoomAndPan="magnify"><defs><filter height="300%" id="fl2t8y2cju5ji" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[c317431f81cdf0e8053db5837ef6c822]
class TrafficLightStates--><rect codeLine="2" fill="#FEFECE" filter="url(#fl2t8y2cju5ji)" height="97.6953" id="TrafficLightStates" style="stroke:#A80036;stroke-width:1.5;" width="127" x="599.5" y="362.5"/><ellipse cx="614.5" cy="382.5938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M613,383.5938 L613,385.5938 L617,385.5938 L617,384.5938 L617,384.1094 L617.625,383.5938 L618,383.5938 L618.375,383.5938 L619,384.1094 L619,384.5938 L619,387.5938 L611,387.5938 L610.5156,387.5938 L610,386.9688 L610,386.5938 L610,386.2188 L610.5156,385.5938 L611,385.5938 L611,385.5938 L611,379.5938 L611,379.5938 L610.5156,379.5938 L610,378.9688 L610,378.5938 L610,378.2188 L610.5156,377.5938 L611,377.5938 L619,377.5938 L619,380.5938 L619,381.0781 L618.375,381.5938 L618,381.5938 L617.625,381.5938 L617,381.0781 L617,380.5938 L617,379.5938 L613,379.5938 L613,381.5938 L614,381.5938 L614,381.1094 L614,381.1094 L614.625,380.5938 L615,380.5938 L615.375,380.5938 L616,381.1094 L616,381.5938 L616,383.5938 L616,384.0781 L615.375,384.5938 L615.375,384.5938 L615,384.5938 L614.625,384.5938 L614,384.0781 L614,384.0781 L614,383.5938 L613,383.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="64" x="644" y="379.957">«fsm-state»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="95" x="628.5" y="395.0508">TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="600.5" x2="725.5" y1="402.6875" y2="402.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="605.5" y="418.1064">RED</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="36" x="605.5" y="431.9424">AMBER</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="605.5" y="445.7783">GREEN</text><line style="stroke:#A80036;stroke-width:1.5;" x1="600.5" x2="725.5" y1="452.1953" y2="452.1953"/><!--MD5=[082ea4b1b4c949e9e678c41ae71c099b]
class TrafficLightEvents--><rect codeLine="8" fill="#FEFECE" filter="url(#fl2t8y2cju5ji)" height="83.8594" id="TrafficLightEvents" style="stroke:#A80036;stroke-width:1.5;" width="129" x="374.5" y="566"/><ellipse cx="389.5" cy="586.0938" fill="#EB937F" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M388,587.0938 L388,589.0938 L392,589.0938 L392,588.0938 L392,587.6094 L392.625,587.0938 L393,587.0938 L393.375,587.0938 L394,587.6094 L394,588.0938 L394,591.0938 L386,591.0938 L385.5156,591.0938 L385,590.4688 L385,590.0938 L385,589.7188 L385.5156,589.0938 L386,589.0938 L386,589.0938 L386,583.0938 L386,583.0938 L385.5156,583.0938 L385,582.4688 L385,582.0938 L385,581.7188 L385.5156,581.0938 L386,581.0938 L394,581.0938 L394,584.0938 L394,584.5781 L393.375,585.0938 L393,585.0938 L392.625,585.0938 L392,584.5781 L392,584.0938 L392,583.0938 L388,583.0938 L388,585.0938 L389,585.0938 L389,584.6094 L389,584.6094 L389.625,584.0938 L390,584.0938 L390.375,584.0938 L391,584.6094 L391,585.0938 L391,587.0938 L391,587.5781 L390.375,588.0938 L390.375,588.0938 L390,588.0938 L389.625,588.0938 L389,587.5781 L389,587.5781 L389,587.0938 L388,587.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68" x="418" y="583.457">«fsm-event»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="403.5" y="598.5508">TrafficLightEvents</text><line style="stroke:#A80036;stroke-width:1.5;" x1="375.5" x2="502.5" y1="606.1875" y2="606.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="27" x="380.5" y="621.6064">STOP</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="16" x="380.5" y="635.4424">GO</text><line style="stroke:#A80036;stroke-width:1.5;" x1="375.5" x2="502.5" y1="641.8594" y2="641.8594"/><!--MD5=[a261c3b0f6dc39c3323e9647de972898]
class TrafficLightContext--><rect codeLine="12" fill="#FEFECE" filter="url(#fl2t8y2cju5ji)" height="153.0391" id="TrafficLightContext" style="stroke:#A80036;stroke-width:1.5;" width="270" x="7" y="335"/><ellipse cx="86.75" cy="355.0938" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M87.75,352.0938 L87.75,358.0938 L89.75,358.0938 L90.2344,358.0938 L90.75,358.7188 L90.75,359.0938 L90.75,359.4688 L90.2344,360.0938 L89.75,360.0938 L83.75,360.0938 L83.2656,360.0938 L82.75,359.4688 L82.75,359.0938 L82.75,358.7188 L83.2656,358.0938 L83.75,358.0938 L85.75,358.0938 L85.75,352.0938 L83.75,352.0938 L83.2656,352.0938 L82.75,351.4688 L82.75,351.0938 L82.75,350.7188 L83.2656,350.0938 L83.75,350.0938 L89.75,350.0938 L90.2344,350.0938 L90.75,350.7188 L90.75,351.0938 L90.75,351.4688 L90.2344,352.0938 L89.75,352.0938 L87.75,352.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="77" x="119.75" y="352.457">«fsm-context»</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="102" x="107.25" y="367.5508">TrafficLightContext</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="276" y1="375.1875" y2="375.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="13" y="390.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="13" y="404.4424">amberTimeout: Long</text><line style="stroke:#A80036;stroke-width:1.5;" x1="8" x2="276" y1="410.8594" y2="410.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="13" y="426.2783">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="13" y="440.1143">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="13" y="453.9502">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="13" y="467.7861">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="13" y="481.6221">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[d85e1abf3caa9c226551ac440a773ac6]
class TrafficLightController--><rect codeLine="22" fill="#FEFECE" filter="url(#fl2t8y2cju5ji)" height="144.8516" id="TrafficLightController" style="stroke:#A80036;stroke-width:1.5;" width="218" x="38" y="59.5"/><ellipse cx="85.75" cy="75.5" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M86.75,72.5 L86.75,78.5 L88.75,78.5 L89.2344,78.5 L89.75,79.125 L89.75,79.5 L89.75,79.875 L89.2344,80.5 L88.75,80.5 L82.75,80.5 L82.2656,80.5 L81.75,79.875 L81.75,79.5 L81.75,79.125 L82.2656,78.5 L82.75,78.5 L84.75,78.5 L84.75,72.5 L82.75,72.5 L82.2656,72.5 L81.75,71.875 L81.75,71.5 L81.75,71.125 L82.2656,70.5 L82.75,70.5 L88.75,70.5 L89.2344,70.5 L89.75,71.125 L89.75,71.5 L89.75,71.875 L89.2344,72.5 L88.75,72.5 L86.75,72.5 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="114" x="106.25" y="80.4102">TrafficLightController</text><line style="stroke:#A80036;stroke-width:1.5;" x1="39" x2="255" y1="91.5" y2="91.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="44" y="106.9189">currentState: TrafficLightStates</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="44" y="120.7549">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="44" y="134.5908">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="44" y="148.4268">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="44" y="162.2627">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206" x="44" y="176.0986">state: ReceiveChannel&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="39" x2="255" y1="182.5156" y2="182.5156"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="44" y="197.9346">changeAmberTimeout(value: Long)</text><!--MD5=[8f5d905706df63f012d7d74357fff60c]
class TrafficLightFSM--><rect codeLine="33" fill="#FEFECE" filter="url(#fl2t8y2cju5ji)" height="97.6953" id="TrafficLightFSM" style="stroke:#A80036;stroke-width:1.5;" width="164" x="357" y="362.5"/><ellipse cx="393.6" cy="382.5938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M395.6,379.0938 Q395.8031,378.5938 396.0375,378.3438 Q396.2719,378.0938 396.5375,378.0938 Q397.0063,378.0938 397.3031,378.375 Q397.6,378.6563 397.6,379.3125 L397.6,380.875 Q397.6,381.5313 397.3188,381.8125 Q397.0375,382.0938 396.6,382.0938 Q396.2094,382.0938 395.9594,381.9219 Q395.7094,381.75 395.6,381.2969 Q395.5531,380.9844 395.3813,380.8125 Q395.0688,380.4844 394.5063,380.2969 Q393.9438,380.0938 393.3813,380.0938 Q392.6781,380.0938 392.0844,380.375 Q391.5063,380.6563 391.0531,381.2813 Q390.6,381.9063 390.6,382.7656 L390.6,383.6875 Q390.6,384.7188 391.4438,385.4063 Q392.2875,386.0938 393.7875,386.0938 Q394.6781,386.0938 395.3031,385.8906 Q395.6625,385.7813 396.0688,385.4219 Q396.3344,385.2188 396.475,385.1563 Q396.6156,385.0938 396.7875,385.0938 Q397.1156,385.0938 397.35,385.3594 Q397.6,385.6094 397.6,385.9688 Q397.6,386.3125 397.2563,386.7188 Q396.7563,387.3125 395.9594,387.6406 Q394.9125,388.0938 393.6313,388.0938 Q392.1313,388.0938 390.9281,387.5 Q389.9594,387.0313 389.2719,386.0156 Q388.6,385 388.6,383.7969 L388.6,382.7031 Q388.6,381.4531 389.1938,380.3594 Q389.8031,379.2656 390.85,378.6875 Q391.9125,378.0938 393.1,378.0938 Q393.8188,378.0938 394.4438,378.3438 Q395.0688,378.5938 395.6,379.0938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="34" x="437.4" y="379.957">«fsm»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="412.4" y="395.0508">TrafficLightFSM</text><line style="stroke:#A80036;stroke-width:1.5;" x1="358" x2="520" y1="402.6875" y2="402.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="363" y="418.1064">currentState: TrafficLightStates</text><line style="stroke:#A80036;stroke-width:1.5;" x1="358" x2="520" y1="424.5234" y2="424.5234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="363" y="439.9424">fun start() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="363" y="453.7783">fun stop() «suspend»</text><!--MD5=[24d80c7a7824efcf0b8bd16fe5b50cae]
class TrafficLightService--><rect codeLine="43" fill="#FEFECE" filter="url(#fl2t8y2cju5ji)" height="249.8906" id="TrafficLightService" style="stroke:#A80036;stroke-width:1.5;" width="270" x="293" y="7"/><ellipse cx="354.25" cy="27.0938" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M356.25,23.5938 Q356.4531,23.0938 356.6875,22.8438 Q356.9219,22.5938 357.1875,22.5938 Q357.6563,22.5938 357.9531,22.875 Q358.25,23.1563 358.25,23.8125 L358.25,25.375 Q358.25,26.0313 357.9688,26.3125 Q357.6875,26.5938 357.25,26.5938 Q356.8594,26.5938 356.6094,26.4219 Q356.3594,26.25 356.25,25.7969 Q356.2031,25.4844 356.0313,25.3125 Q355.7188,24.9844 355.1563,24.7969 Q354.5938,24.5938 354.0313,24.5938 Q353.3281,24.5938 352.7344,24.875 Q352.1563,25.1563 351.7031,25.7813 Q351.25,26.4063 351.25,27.2656 L351.25,28.1875 Q351.25,29.2188 352.0938,29.9063 Q352.9375,30.5938 354.4375,30.5938 Q355.3281,30.5938 355.9531,30.3906 Q356.3125,30.2813 356.7188,29.9219 Q356.9844,29.7188 357.125,29.6563 Q357.2656,29.5938 357.4375,29.5938 Q357.7656,29.5938 358,29.8594 Q358.25,30.1094 358.25,30.4688 Q358.25,30.8125 357.9063,31.2188 Q357.4063,31.8125 356.6094,32.1406 Q355.5625,32.5938 354.2813,32.5938 Q352.7813,32.5938 351.5781,32 Q350.6094,31.5313 349.9219,30.5156 Q349.25,29.5 349.25,28.2969 L349.25,27.2031 Q349.25,25.9531 349.8438,24.8594 Q350.4531,23.7656 351.5,23.1875 Q352.5625,22.5938 353.75,22.5938 Q354.4688,22.5938 355.0938,22.8438 Q355.7188,23.0938 356.25,23.5938 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="143" x="372.75" y="24.457">«context-implementation»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="394.25" y="39.5508">TrafficLightService</text><line style="stroke:#A80036;stroke-width:1.5;" x1="294" x2="562" y1="47.1875" y2="47.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="299" y="62.6064">name: String</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="299" y="76.4424">amberTimeout: Long</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="299" y="90.2783">amber: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="299" y="104.1143">red: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="299" y="117.9502">green: StateFlow&lt;Boolean&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="299" y="131.7861">stopped: ReceiveChannel&lt;Long&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206" x="299" y="145.6221">state: ReceiveChannel&lt;TrafficLightStates&gt;</text><line style="stroke:#A80036;stroke-width:1.5;" x1="294" x2="562" y1="152.0391" y2="152.0391"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="299" y="167.458">changeAmberTimeout(value: Long)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="302" y="181.2939"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="299" y="195.1299">setStopped() «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="299" y="208.9658">switchRed(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="299" y="222.8018">switchAmber(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="299" y="236.6377">switchGreen(on: Boolean) «suspend»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="258" x="299" y="250.4736">stateChanged(toState: TrafficLightStates) «suspend»</text><!--MD5=[e90295f2306cf9f2d48d2dd155fc66d8]
link TrafficLightController to TrafficLightContext--><path codeLine="31" d="M145.706,204.824 C145.103,238.272 144.378,278.543 143.729,314.551 " fill="none" id="TrafficLightController-to-TrafficLightContext" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="150.727,314.738,143.367,334.609,136.729,314.486,150.727,314.738" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[f5a4d25a21e2db1a9bef5b5bdfa80daf]
link TrafficLightFSM to TrafficLightStates--><path codeLine="39" d="M521.137,411.5 C545.167,411.5 571.174,411.5 594.278,411.5 " fill="none" id="TrafficLightFSM-to-TrafficLightStates" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="599.468,411.5,590.468,407.5,594.468,411.5,590.468,415.5,599.468,411.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="539.25" y="404.9951">«uses»</text><!--MD5=[ef55fa34c35daebc710b7e66915eb99f]
link TrafficLightFSM to TrafficLightEvents--><path codeLine="40" d="M439,460.579 C439,491.099 439,530.387 439,560.5818 " fill="none" id="TrafficLightFSM-to-TrafficLightEvents" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="439,565.7274,443,556.7274,439,560.7274,435,556.7274,439,565.7274" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="440" y="532.4951">«uses»</text><!--MD5=[4f773506094c7b19ae20184ee571cf4e]
reverse link TrafficLightContext to TrafficLightFSM--><path codeLine="41" d="M282.15,411.5 C307.779,411.5 333.741,411.5 356.97,411.5 " fill="none" id="TrafficLightContext-backto-TrafficLightFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="277.03,411.5,286.03,415.5,282.03,411.5,286.03,407.5,277.03,411.5" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="295.5" y="404.9951">context</text><!--MD5=[7e950ff0d6619f997f3686b3c3ce733c]
reverse link TrafficLightController to TrafficLightService--><path codeLine="60" d="M276.502,132 C281.931,132 287.359,132 292.788,132 " fill="none" id="TrafficLightController-backto-TrafficLightService" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="276.217,139,256.217,132,276.217,125,276.217,139" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[b02eea57f08a8734f953d301797f548e]
link TrafficLightService to TrafficLightFSM--><path codeLine="61" d="M433.3957,269.1306 C433.3957,269.1306 435.633,325.571 436.561,348.964 " fill="none" id="TrafficLightService-TrafficLightFSM" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="437.086,362.208,440.7268,353.0568,436.8882,357.2119,432.7331,353.3733,437.086,362.208" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="436.8882" x2="436.5705" y1="357.2119" y2="349.218"/><polygon fill="#A80036" points="432.921,257.14,429.1615,263.2935,433.3957,269.1306,437.1552,262.9771,432.921,257.14" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="435" y="301.4951">fsm</text><!--MD5=[bc5d13d48a5a069b0384f3a274b75477]
@startuml

enum TrafficLightStates <<fsm-state>> {
    RED
    AMBER
    GREEN
}

enum TrafficLightEvents <<fsm-event>> {
    STOP
    GO
}
interface TrafficLightContext <<fsm-context>> {
    name: String
    amberTimeout: Long
    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

interface TrafficLightController {
    currentState: TrafficLightStates
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: ReceiveChannel<Long>
    state: ReceiveChannel<TrafficLightStates>
    changeAmberTimeout(value: Long)
}
TrafficLightController -down-|> TrafficLightContext

class TrafficLightFSM <<fsm>> {
    currentState: TrafficLightStates
    fun start() <<suspend>>
    fun stop() <<suspend>>
}

TrafficLightFSM .right.> TrafficLightStates: <<uses>>
TrafficLightFSM .down.> TrafficLightEvents: <<uses>>
TrafficLightFSM -left-> TrafficLightContext: context

class TrafficLightService <<context-implementation>> {
    name: String
    amberTimeout: Long
    amber: StateFlow<Boolean>
    red: StateFlow<Boolean>
    green: StateFlow<Boolean>
    stopped: ReceiveChannel<Long>
    state: ReceiveChannel<TrafficLightStates>
    changeAmberTimeout(value: Long)

    setStopped() <<suspend>>
    switchRed(on: Boolean) <<suspend>>
    switchAmber(on: Boolean) <<suspend>>
    switchGreen(on: Boolean) <<suspend>>
    stateChanged(toState: TrafficLightStates) <<suspend>>
}

TrafficLightService -left- -|> TrafficLightController
TrafficLightService *- -> TrafficLightFSM: fsm

@enduml

PlantUML version 1.2021.7(Sun May 23 14:40:07 CAT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: ZA
--></g></svg>